import{u as ki,a as ns,b as de,R as Te,c as Ti,D as Ii,d as Mi,A as $i,U as Oi,e as Fi,B as Pi,f as Hi,g as Li,h as Ui,i as Wi,j as zi,k as Vi,l as Zi,m as Gi,n as Bi,o as qi,p as Ki,C as Yi,G as Qi,q as oe,r as ce,s as e,t as c,v as Ms,w as Xi,x as Ji,y as se,z as $s,E as Je,P as We,F as ft,M as ea,H as pe,I as vs,X as bs,J as ta,L as W,S as ye,K as je,N as we,O as Se,Q as Ee,T as te,V as Os,W as Fs,Y as Ps,Z as tt,_ as sa,$ as Fe,a0 as Mt,a1 as $t,a2 as na,a3 as ia,a4 as aa,a5 as ra,a6 as la,a7 as oa,a8 as ca,a9 as da}from"./chunks/globals-D8PkUKNZ.js";import{D as ua,R as ma,A as ha,U as xa,a as ga,B as fa,b as pa,c as _a,d as va,e as ba,f as ya,g as ja,h as wa,i as Sa,j as Ea,k as Na,l as Ca,C as Aa,G as Ra,m as ze,T as Da,n as ys,o as js,p as ws,S as Hs,q as Ls,r as Us,s as Ws}from"./chunks/tooltip-8zu5sLAA.js";import{c as zs,O as Vs,P as Zs,W as ka,C as Gs,T as Ta,D as Ia,a as Bs,R as qs,b as Ma,d as $a,e as pt,f as _t,g as vt,h as bt,i as yt,j as Ot,k as Ft,L as kt}from"./chunks/loader-circle-CPmrdKrG.js";import{P as jt,a as wt,C as Oa,b as St}from"./chunks/popover-BsEXfnyz.js";function Ks(){const{admin:s}=ns();return{queries:s?{GET_RATE_SHEET:Ra,CREATE_RATE_SHEET:Aa,UPDATE_RATE_SHEET:Ca,DELETE_RATE_SHEET:Na,DELETE_RATE_SHEET_SERVICE:Ea,ADD_SHARED_ZONE:Sa,UPDATE_SHARED_ZONE:wa,DELETE_SHARED_ZONE:ja,ADD_SHARED_SURCHARGE:ya,UPDATE_SHARED_SURCHARGE:ba,DELETE_SHARED_SURCHARGE:va,BATCH_UPDATE_SURCHARGES:_a,UPDATE_SERVICE_RATE:pa,BATCH_UPDATE_SERVICE_RATES:fa,UPDATE_SERVICE_ZONE_IDS:ga,UPDATE_SERVICE_SURCHARGE_IDS:xa,ADD_WEIGHT_RANGE:ha,REMOVE_WEIGHT_RANGE:ma,DELETE_SERVICE_RATE:ua}:{GET_RATE_SHEET:Qi,CREATE_RATE_SHEET:Yi,UPDATE_RATE_SHEET:Ki,DELETE_RATE_SHEET:qi,DELETE_RATE_SHEET_SERVICE:Bi,ADD_SHARED_ZONE:Gi,UPDATE_SHARED_ZONE:Zi,DELETE_SHARED_ZONE:Vi,ADD_SHARED_SURCHARGE:zi,UPDATE_SHARED_SURCHARGE:Wi,DELETE_SHARED_SURCHARGE:Ui,BATCH_UPDATE_SURCHARGES:Li,UPDATE_SERVICE_RATE:Hi,BATCH_UPDATE_SERVICE_RATES:Pi,UPDATE_SERVICE_ZONE_IDS:Fi,UPDATE_SERVICE_SURCHARGE_IDS:Oi,ADD_WEIGHT_RANGE:$i,REMOVE_WEIGHT_RANGE:Mi,DELETE_SERVICE_RATE:Ii},wrapVars:a=>s?{variables:{input:a}}:{data:a},admin:s}}function Fa({id:s}={}){const{graphqlRequest:i,admin:t}=ns(),{queries:a}=Ks(),[n,u]=Te.useState(s||"new"),l=Ti({queryKey:[t?"admin_rate_sheet":"rate-sheets",n],queryFn:()=>i(ce(a.GET_RATE_SHEET),{variables:{id:n}}),enabled:n!=="new",onError:oe});function _(h){u(h)}return{query:l,rateSheetId:n,setRateSheetId:_}}function Pa(){const s=ki(),{graphqlRequest:i,admin:t}=ns(),{queries:a,wrapVars:n}=Ks(),u=t?"admin_rate_sheet":"rate-sheets",d=()=>{s.invalidateQueries([u]),s.invalidateQueries(t?["admin_account_carrier_connections"]:["user-connections"])},l=de(O=>i(ce(a.CREATE_RATE_SHEET),n(O)),{onSuccess:d,onError:oe}),_=de(O=>i(ce(a.UPDATE_RATE_SHEET),n(O)),{onSuccess:d,onError:oe}),h=de(O=>i(ce(a.DELETE_RATE_SHEET),n(O)),{onSuccess:d,onError:oe}),y=de(O=>i(ce(a.DELETE_RATE_SHEET_SERVICE),n(O)),{onSuccess:d,onError:oe}),w=de(O=>i(ce(a.ADD_SHARED_ZONE),n(O)),{onSuccess:d,onError:oe}),b=de(O=>i(ce(a.UPDATE_SHARED_ZONE),n(O)),{onSuccess:d,onError:oe}),S=de(O=>i(ce(a.DELETE_SHARED_ZONE),n(O)),{onSuccess:d,onError:oe}),$=de(O=>i(ce(a.ADD_SHARED_SURCHARGE),n(O)),{onSuccess:d,onError:oe}),T=de(O=>i(ce(a.UPDATE_SHARED_SURCHARGE),n(O)),{onSuccess:d,onError:oe}),E=de(O=>i(ce(a.DELETE_SHARED_SURCHARGE),n(O)),{onSuccess:d,onError:oe}),V=de(O=>i(ce(a.BATCH_UPDATE_SURCHARGES),n(O)),{onSuccess:d,onError:oe}),Z=de(O=>i(ce(a.UPDATE_SERVICE_RATE),n(O)),{onSuccess:d,onError:oe}),I=de(O=>i(ce(a.BATCH_UPDATE_SERVICE_RATES),n(O)),{onSuccess:d,onError:oe}),C=de(O=>i(ce(a.ADD_WEIGHT_RANGE),n(O)),{onSuccess:d,onError:oe}),r=de(O=>i(ce(a.REMOVE_WEIGHT_RANGE),n(O)),{onSuccess:d,onError:oe}),f=de(O=>i(ce(a.DELETE_SERVICE_RATE),n(O)),{onSuccess:d,onError:oe}),R=de(O=>i(ce(a.UPDATE_SERVICE_ZONE_IDS),n(O)),{onSuccess:d,onError:oe}),B=de(O=>i(ce(a.UPDATE_SERVICE_SURCHARGE_IDS),n(O)),{onSuccess:d,onError:oe});return{createRateSheet:l,updateRateSheet:_,deleteRateSheet:h,deleteRateSheetService:y,addSharedZone:w,updateSharedZone:b,deleteSharedZone:S,addSharedSurcharge:$,updateSharedSurcharge:T,deleteSharedSurcharge:E,batchUpdateSurcharges:V,updateServiceRate:Z,batchUpdateServiceRates:I,addWeightRange:C,removeWeightRange:r,deleteServiceRate:f,updateServiceZoneIds:R,updateServiceSurchargeIds:B}}var Ha=Symbol("radix.slottable");function La(s){const i=({children:t})=>e.jsx(e.Fragment,{children:t});return i.displayName=`${s}.Slottable`,i.__radixId=Ha,i}var Ys="AlertDialog",[Ua]=Xi(Ys,[zs]),Pe=zs(),Qs=s=>{const{__scopeAlertDialog:i,...t}=s,a=Pe(i);return e.jsx(qs,{...a,...t,modal:!0})};Qs.displayName=Ys;var Wa="AlertDialogTrigger",za=c.forwardRef((s,i)=>{const{__scopeAlertDialog:t,...a}=s,n=Pe(t);return e.jsx(Ma,{...n,...a,ref:i})});za.displayName=Wa;var Va="AlertDialogPortal",Xs=s=>{const{__scopeAlertDialog:i,...t}=s,a=Pe(i);return e.jsx(Zs,{...a,...t})};Xs.displayName=Va;var Za="AlertDialogOverlay",Js=c.forwardRef((s,i)=>{const{__scopeAlertDialog:t,...a}=s,n=Pe(t);return e.jsx(Vs,{...n,...a,ref:i})});Js.displayName=Za;var et="AlertDialogContent",[Ga,Ba]=Ua(et),qa=La("AlertDialogContent"),en=c.forwardRef((s,i)=>{const{__scopeAlertDialog:t,children:a,...n}=s,u=Pe(t),d=c.useRef(null),l=Ms(i,d),_=c.useRef(null);return e.jsx(ka,{contentName:et,titleName:tn,docsSlug:"alert-dialog",children:e.jsx(Ga,{scope:t,cancelRef:_,children:e.jsxs(Gs,{role:"alertdialog",...u,...n,ref:l,onOpenAutoFocus:Ji(n.onOpenAutoFocus,h=>{var y;h.preventDefault(),(y=_.current)==null||y.focus({preventScroll:!0})}),onPointerDownOutside:h=>h.preventDefault(),onInteractOutside:h=>h.preventDefault(),children:[e.jsx(qa,{children:a}),e.jsx(Ya,{contentRef:d})]})})})});en.displayName=et;var tn="AlertDialogTitle",sn=c.forwardRef((s,i)=>{const{__scopeAlertDialog:t,...a}=s,n=Pe(t);return e.jsx(Ta,{...n,...a,ref:i})});sn.displayName=tn;var nn="AlertDialogDescription",an=c.forwardRef((s,i)=>{const{__scopeAlertDialog:t,...a}=s,n=Pe(t);return e.jsx(Ia,{...n,...a,ref:i})});an.displayName=nn;var Ka="AlertDialogAction",rn=c.forwardRef((s,i)=>{const{__scopeAlertDialog:t,...a}=s,n=Pe(t);return e.jsx(Bs,{...n,...a,ref:i})});rn.displayName=Ka;var ln="AlertDialogCancel",on=c.forwardRef((s,i)=>{const{__scopeAlertDialog:t,...a}=s,{cancelRef:n}=Ba(ln,t),u=Pe(t),d=Ms(i,n);return e.jsx(Bs,{...u,...a,ref:d})});on.displayName=ln;var Ya=({contentRef:s})=>{const i=`\`${et}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${et}\` by passing a \`${nn}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${et}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return c.useEffect(()=>{var a;document.getElementById((a=s.current)==null?void 0:a.getAttribute("aria-describedby"))||console.warn(i)},[i,s]),null},Qa=Qs,Xa=Xs,cn=Js,dn=en,un=rn,mn=on,hn=sn,xn=an;const Tt=Qa,Ja=Xa,gn=c.forwardRef(({className:s,...i},t)=>e.jsx(cn,{className:se("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...i,ref:t}));gn.displayName=cn.displayName;const ct=c.forwardRef(({className:s,...i},t)=>e.jsxs(Ja,{children:[e.jsx(gn,{}),e.jsx(dn,{ref:t,className:se("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-neutral-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:border-neutral-800 dark:bg-neutral-950",s),...i})]}));ct.displayName=dn.displayName;const dt=({className:s,...i})=>e.jsx("div",{className:se("flex flex-col space-y-2 text-center sm:text-left",s),...i});dt.displayName="AlertDialogHeader";const ut=({className:s,...i})=>e.jsx("div",{className:se("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...i});ut.displayName="AlertDialogFooter";const mt=c.forwardRef(({className:s,...i},t)=>e.jsx(hn,{ref:t,className:se("text-lg font-semibold",s),...i}));mt.displayName=hn.displayName;const ht=c.forwardRef(({className:s,...i},t)=>e.jsx(xn,{ref:t,className:se("text-sm text-neutral-500 dark:text-neutral-400",s),...i}));ht.displayName=xn.displayName;const xt=c.forwardRef(({className:s,...i},t)=>e.jsx(un,{ref:t,className:se($s(),s),...i}));xt.displayName=un.displayName;const gt=c.forwardRef(({className:s,...i},t)=>e.jsx(mn,{ref:t,className:se($s({variant:"outline"}),s),...i}));gt.displayName=mn.displayName;var Ss=1,er=.9,tr=.8,sr=.17,Qt=.1,Xt=.999,nr=.9999,ir=.99,ar=/[\\\/_+.#"@\[\(\{&]/,rr=/[\\\/_+.#"@\[\(\{&]/g,lr=/[\s-]/,fn=/[\s-]/g;function ts(s,i,t,a,n,u,d){if(u===i.length)return n===s.length?Ss:ir;var l=`${n},${u}`;if(d[l]!==void 0)return d[l];for(var _=a.charAt(u),h=t.indexOf(_,n),y=0,w,b,S,$;h>=0;)w=ts(s,i,t,a,h+1,u+1,d),w>y&&(h===n?w*=Ss:ar.test(s.charAt(h-1))?(w*=tr,S=s.slice(n,h-1).match(rr),S&&n>0&&(w*=Math.pow(Xt,S.length))):lr.test(s.charAt(h-1))?(w*=er,$=s.slice(n,h-1).match(fn),$&&n>0&&(w*=Math.pow(Xt,$.length))):(w*=sr,n>0&&(w*=Math.pow(Xt,h-n))),s.charAt(h)!==i.charAt(u)&&(w*=nr)),(w<Qt&&t.charAt(h-1)===a.charAt(u+1)||a.charAt(u+1)===a.charAt(u)&&t.charAt(h-1)!==a.charAt(u))&&(b=ts(s,i,t,a,h+1,u+2,d),b*Qt>w&&(w=b*Qt)),w>y&&(y=w),h=t.indexOf(_,h+1);return d[l]=y,y}function Es(s){return s.toLowerCase().replace(fn," ")}function or(s,i,t){return s=t&&t.length>0?`${s+" "+t.join(" ")}`:s,ts(s,i,Es(s),Es(i),0,0,{})}var ot='[cmdk-group=""]',Jt='[cmdk-group-items=""]',cr='[cmdk-group-heading=""]',pn='[cmdk-item=""]',Ns=`${pn}:not([aria-disabled="true"])`,ss="cmdk-item-select",Qe="data-value",dr=(s,i,t)=>or(s,i,t),_n=c.createContext(void 0),Et=()=>c.useContext(_n),vn=c.createContext(void 0),is=()=>c.useContext(vn),bn=c.createContext(void 0),yn=c.forwardRef((s,i)=>{let t=Xe(()=>{var p,D;return{search:"",value:(D=(p=s.value)!=null?p:s.defaultValue)!=null?D:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),a=Xe(()=>new Set),n=Xe(()=>new Map),u=Xe(()=>new Map),d=Xe(()=>new Set),l=jn(s),{label:_,children:h,value:y,onValueChange:w,filter:b,shouldFilter:S,loop:$,disablePointerSelection:T=!1,vimBindings:E=!0,...V}=s,Z=Je(),I=Je(),C=Je(),r=c.useRef(null),f=yr();Ve(()=>{if(y!==void 0){let p=y.trim();t.current.value=p,R.emit()}},[y]),Ve(()=>{f(6,ve)},[]);let R=c.useMemo(()=>({subscribe:p=>(d.current.add(p),()=>d.current.delete(p)),snapshot:()=>t.current,setState:(p,D,z)=>{var P,G,Y,ue;if(!Object.is(t.current[p],D)){if(t.current[p]=D,p==="search")Ne(),xe(),f(1,me);else if(p==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let ie=document.getElementById(C);ie?ie.focus():(P=document.getElementById(Z))==null||P.focus()}if(f(7,()=>{var ie;t.current.selectedItemId=(ie=ge())==null?void 0:ie.id,R.emit()}),z||f(5,ve),((G=l.current)==null?void 0:G.value)!==void 0){let ie=D??"";(ue=(Y=l.current).onValueChange)==null||ue.call(Y,ie);return}}R.emit()}},emit:()=>{d.current.forEach(p=>p())}}),[]),B=c.useMemo(()=>({value:(p,D,z)=>{var P;D!==((P=u.current.get(p))==null?void 0:P.value)&&(u.current.set(p,{value:D,keywords:z}),t.current.filtered.items.set(p,O(D,z)),f(2,()=>{xe(),R.emit()}))},item:(p,D)=>(a.current.add(p),D&&(n.current.has(D)?n.current.get(D).add(p):n.current.set(D,new Set([p]))),f(3,()=>{Ne(),xe(),t.current.value||me(),R.emit()}),()=>{u.current.delete(p),a.current.delete(p),t.current.filtered.items.delete(p);let z=ge();f(4,()=>{Ne(),(z==null?void 0:z.getAttribute("id"))===p&&me(),R.emit()})}),group:p=>(n.current.has(p)||n.current.set(p,new Set),()=>{u.current.delete(p),n.current.delete(p)}),filter:()=>l.current.shouldFilter,label:_||s["aria-label"],getDisablePointerSelection:()=>l.current.disablePointerSelection,listId:Z,inputId:C,labelId:I,listInnerRef:r}),[]);function O(p,D){var z,P;let G=(P=(z=l.current)==null?void 0:z.filter)!=null?P:dr;return p?G(p,t.current.search,D):0}function xe(){if(!t.current.search||l.current.shouldFilter===!1)return;let p=t.current.filtered.items,D=[];t.current.filtered.groups.forEach(P=>{let G=n.current.get(P),Y=0;G.forEach(ue=>{let ie=p.get(ue);Y=Math.max(ie,Y)}),D.push([P,Y])});let z=r.current;he().sort((P,G)=>{var Y,ue;let ie=P.getAttribute("id"),Q=G.getAttribute("id");return((Y=p.get(Q))!=null?Y:0)-((ue=p.get(ie))!=null?ue:0)}).forEach(P=>{let G=P.closest(Jt);G?G.appendChild(P.parentElement===G?P:P.closest(`${Jt} > *`)):z.appendChild(P.parentElement===z?P:P.closest(`${Jt} > *`))}),D.sort((P,G)=>G[1]-P[1]).forEach(P=>{var G;let Y=(G=r.current)==null?void 0:G.querySelector(`${ot}[${Qe}="${encodeURIComponent(P[0])}"]`);Y==null||Y.parentElement.appendChild(Y)})}function me(){let p=he().find(z=>z.getAttribute("aria-disabled")!=="true"),D=p==null?void 0:p.getAttribute(Qe);R.setState("value",D||void 0)}function Ne(){var p,D,z,P;if(!t.current.search||l.current.shouldFilter===!1){t.current.filtered.count=a.current.size;return}t.current.filtered.groups=new Set;let G=0;for(let Y of a.current){let ue=(D=(p=u.current.get(Y))==null?void 0:p.value)!=null?D:"",ie=(P=(z=u.current.get(Y))==null?void 0:z.keywords)!=null?P:[],Q=O(ue,ie);t.current.filtered.items.set(Y,Q),Q>0&&G++}for(let[Y,ue]of n.current)for(let ie of ue)if(t.current.filtered.items.get(ie)>0){t.current.filtered.groups.add(Y);break}t.current.filtered.count=G}function ve(){var p,D,z;let P=ge();P&&(((p=P.parentElement)==null?void 0:p.firstChild)===P&&((z=(D=P.closest(ot))==null?void 0:D.querySelector(cr))==null||z.scrollIntoView({block:"nearest"})),P.scrollIntoView({block:"nearest"}))}function ge(){var p;return(p=r.current)==null?void 0:p.querySelector(`${pn}[aria-selected="true"]`)}function he(){var p;return Array.from(((p=r.current)==null?void 0:p.querySelectorAll(Ns))||[])}function ne(p){let D=he()[p];D&&R.setState("value",D.getAttribute(Qe))}function ae(p){var D;let z=ge(),P=he(),G=P.findIndex(ue=>ue===z),Y=P[G+p];(D=l.current)!=null&&D.loop&&(Y=G+p<0?P[P.length-1]:G+p===P.length?P[0]:P[G+p]),Y&&R.setState("value",Y.getAttribute(Qe))}function Ae(p){let D=ge(),z=D==null?void 0:D.closest(ot),P;for(;z&&!P;)z=p>0?vr(z,ot):br(z,ot),P=z==null?void 0:z.querySelector(Ns);P?R.setState("value",P.getAttribute(Qe)):ae(p)}let Ie=()=>ne(he().length-1),Ze=p=>{p.preventDefault(),p.metaKey?Ie():p.altKey?Ae(1):ae(1)},He=p=>{p.preventDefault(),p.metaKey?ne(0):p.altKey?Ae(-1):ae(-1)};return c.createElement(We.div,{ref:i,tabIndex:-1,...V,"cmdk-root":"",onKeyDown:p=>{var D;(D=V.onKeyDown)==null||D.call(V,p);let z=p.nativeEvent.isComposing||p.keyCode===229;if(!(p.defaultPrevented||z))switch(p.key){case"n":case"j":{E&&p.ctrlKey&&Ze(p);break}case"ArrowDown":{Ze(p);break}case"p":case"k":{E&&p.ctrlKey&&He(p);break}case"ArrowUp":{He(p);break}case"Home":{p.preventDefault(),ne(0);break}case"End":{p.preventDefault(),Ie();break}case"Enter":{p.preventDefault();let P=ge();if(P){let G=new Event(ss);P.dispatchEvent(G)}}}}},c.createElement("label",{"cmdk-label":"",htmlFor:B.inputId,id:B.labelId,style:wr},_),Pt(s,p=>c.createElement(vn.Provider,{value:R},c.createElement(_n.Provider,{value:B},p))))}),ur=c.forwardRef((s,i)=>{var t,a;let n=Je(),u=c.useRef(null),d=c.useContext(bn),l=Et(),_=jn(s),h=(a=(t=_.current)==null?void 0:t.forceMount)!=null?a:d==null?void 0:d.forceMount;Ve(()=>{if(!h)return l.item(n,d==null?void 0:d.id)},[h]);let y=wn(n,u,[s.value,s.children,u],s.keywords),w=is(),b=Ue(f=>f.value&&f.value===y.current),S=Ue(f=>h||l.filter()===!1?!0:f.search?f.filtered.items.get(n)>0:!0);c.useEffect(()=>{let f=u.current;if(!(!f||s.disabled))return f.addEventListener(ss,$),()=>f.removeEventListener(ss,$)},[S,s.onSelect,s.disabled]);function $(){var f,R;T(),(R=(f=_.current).onSelect)==null||R.call(f,y.current)}function T(){w.setState("value",y.current,!0)}if(!S)return null;let{disabled:E,value:V,onSelect:Z,forceMount:I,keywords:C,...r}=s;return c.createElement(We.div,{ref:ft(u,i),...r,id:n,"cmdk-item":"",role:"option","aria-disabled":!!E,"aria-selected":!!b,"data-disabled":!!E,"data-selected":!!b,onPointerMove:E||l.getDisablePointerSelection()?void 0:T,onClick:E?void 0:$},s.children)}),mr=c.forwardRef((s,i)=>{let{heading:t,children:a,forceMount:n,...u}=s,d=Je(),l=c.useRef(null),_=c.useRef(null),h=Je(),y=Et(),w=Ue(S=>n||y.filter()===!1?!0:S.search?S.filtered.groups.has(d):!0);Ve(()=>y.group(d),[]),wn(d,l,[s.value,s.heading,_]);let b=c.useMemo(()=>({id:d,forceMount:n}),[n]);return c.createElement(We.div,{ref:ft(l,i),...u,"cmdk-group":"",role:"presentation",hidden:w?void 0:!0},t&&c.createElement("div",{ref:_,"cmdk-group-heading":"","aria-hidden":!0,id:h},t),Pt(s,S=>c.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":t?h:void 0},c.createElement(bn.Provider,{value:b},S))))}),hr=c.forwardRef((s,i)=>{let{alwaysRender:t,...a}=s,n=c.useRef(null),u=Ue(d=>!d.search);return!t&&!u?null:c.createElement(We.div,{ref:ft(n,i),...a,"cmdk-separator":"",role:"separator"})}),xr=c.forwardRef((s,i)=>{let{onValueChange:t,...a}=s,n=s.value!=null,u=is(),d=Ue(h=>h.search),l=Ue(h=>h.selectedItemId),_=Et();return c.useEffect(()=>{s.value!=null&&u.setState("search",s.value)},[s.value]),c.createElement(We.input,{ref:i,...a,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":_.listId,"aria-labelledby":_.labelId,"aria-activedescendant":l,id:_.inputId,type:"text",value:n?s.value:d,onChange:h=>{n||u.setState("search",h.target.value),t==null||t(h.target.value)}})}),gr=c.forwardRef((s,i)=>{let{children:t,label:a="Suggestions",...n}=s,u=c.useRef(null),d=c.useRef(null),l=Ue(h=>h.selectedItemId),_=Et();return c.useEffect(()=>{if(d.current&&u.current){let h=d.current,y=u.current,w,b=new ResizeObserver(()=>{w=requestAnimationFrame(()=>{let S=h.offsetHeight;y.style.setProperty("--cmdk-list-height",S.toFixed(1)+"px")})});return b.observe(h),()=>{cancelAnimationFrame(w),b.unobserve(h)}}},[]),c.createElement(We.div,{ref:ft(u,i),...n,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":l,"aria-label":a,id:_.listId},Pt(s,h=>c.createElement("div",{ref:ft(d,_.listInnerRef),"cmdk-list-sizer":""},h)))}),fr=c.forwardRef((s,i)=>{let{open:t,onOpenChange:a,overlayClassName:n,contentClassName:u,container:d,...l}=s;return c.createElement(qs,{open:t,onOpenChange:a},c.createElement(Zs,{container:d},c.createElement(Vs,{"cmdk-overlay":"",className:n}),c.createElement(Gs,{"aria-label":s.label,"cmdk-dialog":"",className:u},c.createElement(yn,{ref:i,...l}))))}),pr=c.forwardRef((s,i)=>Ue(t=>t.filtered.count===0)?c.createElement(We.div,{ref:i,...s,"cmdk-empty":"",role:"presentation"}):null),_r=c.forwardRef((s,i)=>{let{progress:t,children:a,label:n="Loading...",...u}=s;return c.createElement(We.div,{ref:i,...u,"cmdk-loading":"",role:"progressbar","aria-valuenow":t,"aria-valuemin":0,"aria-valuemax":100,"aria-label":n},Pt(s,d=>c.createElement("div",{"aria-hidden":!0},d)))}),_e=Object.assign(yn,{List:gr,Item:ur,Input:xr,Group:mr,Separator:hr,Dialog:fr,Empty:pr,Loading:_r});function vr(s,i){let t=s.nextElementSibling;for(;t;){if(t.matches(i))return t;t=t.nextElementSibling}}function br(s,i){let t=s.previousElementSibling;for(;t;){if(t.matches(i))return t;t=t.previousElementSibling}}function jn(s){let i=c.useRef(s);return Ve(()=>{i.current=s}),i}var Ve=typeof window>"u"?c.useEffect:c.useLayoutEffect;function Xe(s){let i=c.useRef();return i.current===void 0&&(i.current=s()),i}function Ue(s){let i=is(),t=()=>s(i.snapshot());return c.useSyncExternalStore(i.subscribe,t,t)}function wn(s,i,t,a=[]){let n=c.useRef(),u=Et();return Ve(()=>{var d;let l=(()=>{var h;for(let y of t){if(typeof y=="string")return y.trim();if(typeof y=="object"&&"current"in y)return y.current?(h=y.current.textContent)==null?void 0:h.trim():n.current}})(),_=a.map(h=>h.trim());u.value(s,l,_),(d=i.current)==null||d.setAttribute(Qe,l),n.current=l}),n}var yr=()=>{let[s,i]=c.useState(),t=Xe(()=>new Map);return Ve(()=>{t.current.forEach(a=>a()),t.current=new Map},[s]),(a,n)=>{t.current.set(a,n),i({})}};function jr(s){let i=s.type;return typeof i=="function"?i(s.props):"render"in i?i.render(s.props):s}function Pt({asChild:s,children:i},t){return s&&c.isValidElement(i)?c.cloneElement(jr(i),{ref:i.ref},t(i.props.children)):t(i)}var wr={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Sn=c.forwardRef(({className:s,...i},t)=>e.jsx(_e,{ref:t,className:se("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s),...i}));Sn.displayName=_e.displayName;const En=c.forwardRef(({className:s,...i},t)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(ea,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(_e.Input,{ref:t,className:se("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s),...i})]}));En.displayName=_e.Input.displayName;const Nn=c.forwardRef(({className:s,...i},t)=>e.jsx(_e.List,{ref:t,className:se("max-h-[300px] overflow-y-auto overflow-x-hidden",s),...i}));Nn.displayName=_e.List.displayName;const Cn=c.forwardRef((s,i)=>e.jsx(_e.Empty,{ref:i,className:"py-6 text-center text-sm",...s}));Cn.displayName=_e.Empty.displayName;const An=c.forwardRef(({className:s,...i},t)=>e.jsx(_e.Group,{ref:t,className:se("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",s),...i}));An.displayName=_e.Group.displayName;const Sr=c.forwardRef(({className:s,...i},t)=>e.jsx(_e.Separator,{ref:t,className:se("-mx-1 h-px bg-border",s),...i}));Sr.displayName=_e.Separator.displayName;const Rn=c.forwardRef(({className:s,...i},t)=>e.jsx(_e.Item,{ref:t,className:se("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s),...i}));Rn.displayName=_e.Item.displayName;const Ht=({value:s,onValueChange:i,options:t,placeholder:a="Select options",disabled:n=!1,className:u,maxBadges:d=3})=>{const[l,_]=c.useState(!1),[h,y]=c.useState(""),[w,b]=c.useState(!1),S=c.useMemo(()=>new Set(s),[s]),$=c.useMemo(()=>{const r=h.trim().toLowerCase();return r?t.filter(f=>`${f.label} ${f.value}`.toLowerCase().includes(r)):t},[t,h]),T=c.useMemo(()=>{const r=$;return w?r.filter(f=>S.has(f.value)):r},[$,w,S]),E=r=>{S.has(r)?i(s.filter(f=>f!==r)):i([...s,r])},V=r=>{r==null||r.stopPropagation(),i([])},Z=s.slice(0,d),I=Math.max(0,s.length-Z.length),C=c.useMemo(()=>{const r=new Map(t.map(f=>[f.value,f.label]));return f=>r.get(f)||f},[t]);return e.jsxs(jt,{open:l,onOpenChange:_,children:[e.jsx(wt,{asChild:!0,children:e.jsxs(pe,{type:"button",variant:"outline",role:"combobox","aria-expanded":l,disabled:n,className:se("w-full justify-between h-8",s.length===0&&"text-muted-foreground",u),children:[e.jsx("div",{className:"flex flex-wrap gap-1 items-center",children:s.length===0?e.jsx("span",{className:"truncate",children:a}):e.jsxs(e.Fragment,{children:[Z.map(r=>e.jsxs(vs,{variant:"secondary",className:"px-2 py-0.5 flex items-center gap-1",children:[C(r),e.jsx("span",{role:"button",tabIndex:0,"aria-label":`Remove ${C(r)}`,onClick:f=>{f.stopPropagation(),f.preventDefault(),i(s.filter(R=>R!==r))},onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&(f.stopPropagation(),f.preventDefault(),i(s.filter(R=>R!==r)))},className:"hover:text-foreground text-muted-foreground cursor-pointer",children:e.jsx(bs,{className:"h-3 w-3"})})]},r)),I>0&&e.jsxs(vs,{variant:"secondary",className:"px-2 py-0.5",children:["+",I]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.length>0&&e.jsx("span",{role:"button",tabIndex:0,onClick:V,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&V(r)},className:"cursor-pointer",children:e.jsx(bs,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"})}),e.jsx(Oa,{className:"h-4 w-4 opacity-60"})]})]})}),e.jsx(St,{className:"w-[var(--radix-popover-trigger-width)] p-0",align:"start",onOpenAutoFocus:r=>r.preventDefault(),children:e.jsxs(Sn,{shouldFilter:!1,children:[e.jsx(En,{placeholder:"Search...",value:h,onValueChange:y}),e.jsxs(Nn,{className:"max-h-72 overflow-y-auto overscroll-contain",onWheelCapture:r=>r.stopPropagation(),children:[e.jsx(Cn,{children:"No results found."}),e.jsx(An,{children:T.map(r=>{const f=S.has(r.value);return e.jsxs(Rn,{onSelect:()=>E(r.value),className:"cursor-pointer",children:[e.jsx($a,{className:se("mr-2 h-4 w-4",f?"opacity-100":"opacity-0")}),e.jsx("span",{className:"flex-1 truncate",children:r.label}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",r.value,")"]})]},r.value)})})]}),e.jsxs("div",{className:"flex justify-between p-2 border-t",children:[e.jsx(pe,{variant:"ghost",size:"sm",onClick:()=>b(r=>!r),disabled:s.length===0&&!w,children:w?"All Countries":"Selected"}),s.length>0&&e.jsx(pe,{variant:"ghost",size:"sm",onClick:V,children:"Clear"})]})]})})]})};Ht.displayName="MultiSelect";const Dn=[{value:"tracked",label:"Tracked"},{value:"b2c",label:"B2C"},{value:"b2b",label:"B2B"},{value:"signature",label:"Signature Required"},{value:"insurance",label:"Insurance"},{value:"express",label:"Express"},{value:"dangerous_goods",label:"Dangerous Goods"},{value:"saturday_delivery",label:"Saturday Delivery"},{value:"sunday_delivery",label:"Sunday Delivery"},{value:"multicollo",label:"Multicollo"}],st="__none__",Er=[{value:st,label:"Not required"},{value:"16",label:"16+"},{value:"18",label:"18+"}],Nr=[{value:st,label:"Not specified"},{value:"pick_up",label:"Pick Up"},{value:"drop_off",label:"Drop Off"},{value:"pick_up_and_drop_off",label:"Pick Up & Drop Off"}],Cr=[{value:st,label:"Not specified"},{value:"home_delivery",label:"Home Delivery"},{value:"service_point",label:"Service Point"},{value:"mailbox",label:"Mailbox"}],Ar=[{value:st,label:"Not specified"},{value:"parcel",label:"Parcel"},{value:"envelope",label:"Envelope"},{value:"pallet",label:"Pallet"}],At=s=>s&&s.trim()!==""?s:st,Rt=s=>!s||s===st||s.trim()===""?"":s.trim(),It={service_name:"",service_code:"",carrier_service_code:"",description:"",active:!0,currency:"USD",transit_days:null,transit_time:null,max_width:null,max_height:null,max_length:null,dimension_unit:"CM",min_weight:null,max_weight:null,weight_unit:"KG",domicile:!0,international:!1,zones:[],surcharge_ids:[],features:[],first_mile:"",last_mile:"",form_factor:"",age_check:""};function Rr(s){return s?Array.isArray(s)?s:Dn.filter(i=>s[i.value]===!0).map(i=>i.value):[]}function Dr(s){const i=s==null?void 0:s.features,t=Rr(i),a=i&&typeof i=="object"&&!Array.isArray(i)?i.first_mile||"":(s==null?void 0:s.first_mile)||"",n=i&&typeof i=="object"&&!Array.isArray(i)?i.last_mile||"":(s==null?void 0:s.last_mile)||"",u=i&&typeof i=="object"&&!Array.isArray(i)?i.form_factor||"":(s==null?void 0:s.form_factor)||"",d=i&&typeof i=="object"&&!Array.isArray(i)?i.age_check||"":(s==null?void 0:s.age_check)||"";return{...It,...s,surcharge_ids:(s==null?void 0:s.surcharge_ids)||[],features:t,first_mile:a,last_mile:n,form_factor:u,age_check:d}}const kr=({service:s,isOpen:i,onClose:t,onSubmit:a,trigger:n,availableSurcharges:u=[],servicePresets:d=[]})=>{const[l,_]=Te.useState(s||It),[h,y]=Te.useState(!1),[w,b]=Te.useState("general"),[S,$]=Te.useState({}),T=Te.useMemo(()=>{const r=[{id:"general",label:"General"},{id:"transit",label:"Transit"},{id:"features",label:"Features"},{id:"logistics",label:"Logistics"},{id:"limits",label:"Limits"}];return u.length>0&&r.push({id:"surcharges",label:"Surcharges"}),r},[u.length]);Te.useEffect(()=>{_(s?Dr(s):It),b("general"),$({})},[s]);const E=(r,f)=>{_(R=>({...R,[r]:f})),S[r]&&$(R=>{const B={...R};return delete B[r],B})},V=()=>{var f,R;const r={};return(f=l.service_name)!=null&&f.trim()||(r.service_name="Required"),(R=l.service_code)!=null&&R.trim()?/^[a-z0-9_]+$/.test(l.service_code)||(r.service_code="Only lowercase letters, numbers, and underscores"):r.service_code="Required",$(r),Object.keys(r).length>0?(b("general"),!1):!0},Z=async r=>{if(r.preventDefault(),!!V()){y(!0);try{const f={...l},R=B=>!B||B.trim()===""?null:B.trim();f.features={tracked:l.features.includes("tracked"),b2c:l.features.includes("b2c"),b2b:l.features.includes("b2b"),signature:l.features.includes("signature"),insurance:l.features.includes("insurance"),express:l.features.includes("express"),dangerous_goods:l.features.includes("dangerous_goods"),saturday_delivery:l.features.includes("saturday_delivery"),sunday_delivery:l.features.includes("sunday_delivery"),multicollo:l.features.includes("multicollo"),age_check:R(l.age_check),first_mile:R(l.first_mile),last_mile:R(l.last_mile),form_factor:R(l.form_factor),shipment_type:null},delete f.first_mile,delete f.last_mile,delete f.form_factor,delete f.age_check,await a(f),t()}catch(f){console.error("Failed to save service:",f)}finally{y(!1)}}},I=!!(s!=null&&s.id),C=!ta(l,s||It);return e.jsx(pt,{open:i,onOpenChange:t,children:e.jsxs(_t,{className:"max-w-xl max-h-[90vh] p-0 flex flex-col",children:[e.jsxs(vt,{className:"px-4 py-3 border-b bg-background shrink-0",children:[e.jsx(bt,{className:"text-base",children:I?"Edit Service":"Add Service"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Configure service details and settings"})]}),e.jsx("div",{className:"border-b border-border px-4 shrink-0",children:e.jsx("div",{className:"flex",children:T.map(r=>e.jsx("button",{type:"button",onClick:()=>b(r.id),className:se("flex-1 py-2 text-xs font-medium border-b-2 transition-colors",w===r.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"),children:r.label},r.id))})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3 min-h-0",children:e.jsxs("form",{onSubmit:Z,className:"space-y-3",children:[w==="general"&&e.jsxs("div",{className:"space-y-3",children:[!I&&d.length>0&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Prefill from carrier service"}),e.jsxs(ye,{value:"",onValueChange:r=>{const f=d.find(R=>R.code===r);f&&(E("service_name",f.name),E("service_code",r),E("carrier_service_code",r))},children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{placeholder:"Select a preset..."})}),e.jsx(Se,{children:d.map(r=>e.jsx(Ee,{value:r.code,children:r.name},r.code))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(W,{htmlFor:"service_name",className:"text-xs",children:["Service Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"service_name",value:l.service_name,onChange:r=>E("service_name",r.target.value),placeholder:"Standard Service",className:se("h-9",S.service_name&&"border-destructive")}),S.service_name&&e.jsx("p",{className:"text-xs text-destructive",children:S.service_name})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(W,{htmlFor:"service_code",className:"text-xs",children:["Service Code ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"service_code",value:l.service_code,onChange:r=>E("service_code",r.target.value),placeholder:"standard_service",className:se("h-9",S.service_code&&"border-destructive")}),S.service_code&&e.jsx("p",{className:"text-xs text-destructive",children:S.service_code})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"carrier_service_code",className:"text-xs",children:"Carrier Service Code"}),e.jsx(te,{id:"carrier_service_code",value:l.carrier_service_code||"",onChange:r=>E("carrier_service_code",r.target.value),placeholder:"Optional",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(W,{htmlFor:"currency",className:"text-xs",children:["Currency ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(ye,{value:l.currency,onValueChange:r=>E("currency",r),children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{})}),e.jsx(Se,{children:Os.map(r=>e.jsx(Ee,{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"description",className:"text-xs",children:"Description"}),e.jsx(te,{id:"description",value:l.description||"",onChange:r=>E("description",r.target.value),placeholder:"Optional service description",className:"h-9"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 pt-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ze,{id:"domicile",checked:l.domicile,onCheckedChange:r=>E("domicile",r)}),e.jsx(W,{htmlFor:"domicile",className:"text-xs cursor-pointer",children:"National/Domestic"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ze,{id:"international",checked:l.international,onCheckedChange:r=>E("international",r)}),e.jsx(W,{htmlFor:"international",className:"text-xs cursor-pointer",children:"International"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ze,{id:"active",checked:l.active,onCheckedChange:r=>E("active",r)}),e.jsx(W,{htmlFor:"active",className:"text-xs cursor-pointer",children:"Active"})]})]})]}),w==="transit"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"transit_days",className:"text-xs",children:"Transit Days"}),e.jsx(te,{id:"transit_days",type:"number",min:"0",value:l.transit_days||"",onChange:r=>E("transit_days",r.target.value?parseInt(r.target.value):null),placeholder:"e.g., 3",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"transit_time",className:"text-xs",children:"Transit Time (hours)"}),e.jsx(te,{id:"transit_time",type:"number",step:"0.1",min:"0",value:l.transit_time||"",onChange:r=>E("transit_time",r.target.value?parseFloat(r.target.value):null),placeholder:"e.g., 72",className:"h-9"})]})]}),w==="features"&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Service Features"}),e.jsx(Ht,{options:Dn,value:l.features||[],onValueChange:r=>E("features",r),placeholder:"Select features..."})]})}),w==="logistics"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"first_mile",className:"text-xs",children:"First Mile"}),e.jsxs(ye,{value:At(l.first_mile),onValueChange:r=>E("first_mile",Rt(r)),children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{placeholder:"Not specified"})}),e.jsx(Se,{children:Nr.map(r=>e.jsx(Ee,{value:r.value,children:r.label},r.value))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"last_mile",className:"text-xs",children:"Last Mile"}),e.jsxs(ye,{value:At(l.last_mile),onValueChange:r=>E("last_mile",Rt(r)),children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{placeholder:"Not specified"})}),e.jsx(Se,{children:Cr.map(r=>e.jsx(Ee,{value:r.value,children:r.label},r.value))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"form_factor",className:"text-xs",children:"Form Factor"}),e.jsxs(ye,{value:At(l.form_factor),onValueChange:r=>E("form_factor",Rt(r)),children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{placeholder:"Not specified"})}),e.jsx(Se,{children:Ar.map(r=>e.jsx(Ee,{value:r.value,children:r.label},r.value))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"age_check",className:"text-xs",children:"Age Check"}),e.jsxs(ye,{value:At(l.age_check),onValueChange:r=>E("age_check",Rt(r)),children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{placeholder:"Not required"})}),e.jsx(Se,{children:Er.map(r=>e.jsx(Ee,{value:r.value,children:r.label},r.value))})]})]})]}),w==="limits"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Weight"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"min_weight",className:"text-xs",children:"Min Weight"}),e.jsx(te,{id:"min_weight",type:"number",step:"0.1",min:"0",value:l.min_weight||"",onChange:r=>E("min_weight",r.target.value?parseFloat(r.target.value):null),placeholder:"0",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"max_weight",className:"text-xs",children:"Max Weight"}),e.jsx(te,{id:"max_weight",type:"number",step:"0.1",min:"0",value:l.max_weight||"",onChange:r=>E("max_weight",r.target.value?parseFloat(r.target.value):null),placeholder:"No limit",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"weight_unit",className:"text-xs",children:"Weight Unit"}),e.jsxs(ye,{value:l.weight_unit,onValueChange:r=>E("weight_unit",r),children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{})}),e.jsx(Se,{children:Fs.map(r=>e.jsx(Ee,{value:r,children:r},r))})]})]})]}),e.jsxs("div",{className:"border-t border-border pt-4 space-y-3",children:[e.jsx("h4",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Dimensions"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"max_length",className:"text-xs",children:"Max Length"}),e.jsx(te,{id:"max_length",type:"number",step:"0.1",min:"0",value:l.max_length||"",onChange:r=>E("max_length",r.target.value?parseFloat(r.target.value):null),placeholder:"No limit",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"max_width",className:"text-xs",children:"Max Width"}),e.jsx(te,{id:"max_width",type:"number",step:"0.1",min:"0",value:l.max_width||"",onChange:r=>E("max_width",r.target.value?parseFloat(r.target.value):null),placeholder:"No limit",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"max_height",className:"text-xs",children:"Max Height"}),e.jsx(te,{id:"max_height",type:"number",step:"0.1",min:"0",value:l.max_height||"",onChange:r=>E("max_height",r.target.value?parseFloat(r.target.value):null),placeholder:"No limit",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"dimension_unit",className:"text-xs",children:"Dimension Unit"}),e.jsxs(ye,{value:l.dimension_unit,onValueChange:r=>E("dimension_unit",r),children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{})}),e.jsx(Se,{children:Ps.map(r=>e.jsx(Ee,{value:r,children:r},r))})]})]})]})]}),w==="surcharges"&&u.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"border border-border rounded-md p-2 space-y-1.5 max-h-32 overflow-y-auto",children:u.map(r=>{const f=(l.surcharge_ids||[]).includes(r.id);return e.jsxs("div",{className:"flex items-center justify-between gap-2 py-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(ze,{id:`surcharge-${r.id}`,checked:f,onCheckedChange:R=>{const B=R?[...l.surcharge_ids||[],r.id]:(l.surcharge_ids||[]).filter(O=>O!==r.id);E("surcharge_ids",B)}}),e.jsx(W,{htmlFor:`surcharge-${r.id}`,className:"text-xs font-medium text-foreground cursor-pointer truncate",children:r.name||"Unnamed surcharge"})]}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:r.surcharge_type==="percentage"?`${r.amount}%`:`${r.amount}`})]},r.id)})}),(l.surcharge_ids||[]).length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:(l.surcharge_ids||[]).map(r=>{const f=u.find(R=>R.id===r);return f?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium bg-primary/10 text-primary rounded-full",children:[f.name||"Unnamed",e.jsx("button",{type:"button",onClick:()=>E("surcharge_ids",(l.surcharge_ids||[]).filter(R=>R!==r)),className:"hover:bg-primary/20 rounded-full p-0.5",children:e.jsx(tt,{className:"h-2.5 w-2.5"})})]},r):null})})]})]})}),e.jsxs(yt,{className:"px-4 py-3 border-t bg-background shrink-0",children:[e.jsx(pe,{type:"button",variant:"outline",size:"sm",onClick:t,children:"Cancel"}),e.jsxs(pe,{type:"submit",size:"sm",disabled:h||!C||!l.service_name||!l.service_code,onClick:r=>(r.preventDefault(),Z(r)),children:[h?"Saving...":I?"Update":"Add"," Service"]})]})]})})};function Ye(s,i,t){let a=t.initialDeps??[],n,u=!0;function d(){var l,_,h;let y;t.key&&((l=t.debug)!=null&&l.call(t))&&(y=Date.now());const w=s();if(!(w.length!==a.length||w.some(($,T)=>a[T]!==$)))return n;a=w;let S;if(t.key&&((_=t.debug)!=null&&_.call(t))&&(S=Date.now()),n=i(...w),t.key&&((h=t.debug)!=null&&h.call(t))){const $=Math.round((Date.now()-y)*100)/100,T=Math.round((Date.now()-S)*100)/100,E=T/16,V=(Z,I)=>{for(Z=String(Z);Z.length<I;)Z=" "+Z;return Z};console.info(`%câ± ${V(T,5)} /${V($,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*E,120))}deg 100% 31%);`,t==null?void 0:t.key)}return t!=null&&t.onChange&&!(u&&t.skipInitialOnChange)&&t.onChange(n),u=!1,n}return d.updateDeps=l=>{a=l},d}function Cs(s,i){if(s===void 0)throw new Error("Unexpected undefined");return s}const Tr=(s,i)=>Math.abs(s-i)<1.01,Ir=(s,i,t)=>{let a;return function(...n){s.clearTimeout(a),a=s.setTimeout(()=>i.apply(this,n),t)}},As=s=>{const{offsetWidth:i,offsetHeight:t}=s;return{width:i,height:t}},Mr=s=>s,$r=s=>{const i=Math.max(s.startIndex-s.overscan,0),t=Math.min(s.endIndex+s.overscan,s.count-1),a=[];for(let n=i;n<=t;n++)a.push(n);return a},Or=(s,i)=>{const t=s.scrollElement;if(!t)return;const a=s.targetWindow;if(!a)return;const n=d=>{const{width:l,height:_}=d;i({width:Math.round(l),height:Math.round(_)})};if(n(As(t)),!a.ResizeObserver)return()=>{};const u=new a.ResizeObserver(d=>{const l=()=>{const _=d[0];if(_!=null&&_.borderBoxSize){const h=_.borderBoxSize[0];if(h){n({width:h.inlineSize,height:h.blockSize});return}}n(As(t))};s.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()});return u.observe(t,{box:"border-box"}),()=>{u.unobserve(t)}},Rs={passive:!0},Ds=typeof window>"u"?!0:"onscrollend"in window,Fr=(s,i)=>{const t=s.scrollElement;if(!t)return;const a=s.targetWindow;if(!a)return;let n=0;const u=s.options.useScrollendEvent&&Ds?()=>{}:Ir(a,()=>{i(n,!1)},s.options.isScrollingResetDelay),d=y=>()=>{const{horizontal:w,isRtl:b}=s.options;n=w?t.scrollLeft*(b&&-1||1):t.scrollTop,u(),i(n,y)},l=d(!0),_=d(!1);_(),t.addEventListener("scroll",l,Rs);const h=s.options.useScrollendEvent&&Ds;return h&&t.addEventListener("scrollend",_,Rs),()=>{t.removeEventListener("scroll",l),h&&t.removeEventListener("scrollend",_)}},Pr=(s,i,t)=>{if(i!=null&&i.borderBoxSize){const a=i.borderBoxSize[0];if(a)return Math.round(a[t.options.horizontal?"inlineSize":"blockSize"])}return s[t.options.horizontal?"offsetWidth":"offsetHeight"]},Hr=(s,{adjustments:i=0,behavior:t},a)=>{var n,u;const d=s+i;(u=(n=a.scrollElement)==null?void 0:n.scrollTo)==null||u.call(n,{[a.options.horizontal?"left":"top"]:d,behavior:t})};class Lr{constructor(i){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const a=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(n=>{n.forEach(u=>{const d=()=>{this._measureElement(u.target,u)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(d):d()})}));return{disconnect:()=>{var n;(n=a())==null||n.disconnect(),t=null},observe:n=>{var u;return(u=a())==null?void 0:u.observe(n,{box:"border-box"})},unobserve:n=>{var u;return(u=a())==null?void 0:u.unobserve(n)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([a,n])=>{typeof n>"u"&&delete t[a]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Mr,rangeExtractor:$r,onChange:()=>{},measureElement:Pr,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...t}},this.notify=t=>{var a,n;(n=(a=this.options).onChange)==null||n.call(a,this,t)},this.maybeNotify=Ye(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const a=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==a){if(this.cleanup(),!a){this.maybeNotify();return}this.scrollElement=a,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(n=>{this.observer.observe(n)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,n=>{this.scrollRect=n,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(n,u)=>{this.scrollAdjustments=0,this.scrollDirection=u?this.getScrollOffset()<n?"forward":"backward":null,this.scrollOffset=n,this.isScrolling=u,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,a)=>{const n=new Map,u=new Map;for(let d=a-1;d>=0;d--){const l=t[d];if(n.has(l.lane))continue;const _=u.get(l.lane);if(_==null||l.end>_.end?u.set(l.lane,l):l.end<_.end&&n.set(l.lane,!0),n.size===this.options.lanes)break}return u.size===this.options.lanes?Array.from(u.values()).sort((d,l)=>d.end===l.end?d.index-l.index:d.end-l.end)[0]:void 0},this.getMeasurementOptions=Ye(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(t,a,n,u,d,l)=>(this.prevLanes!==void 0&&this.prevLanes!==l&&(this.lanesChangedFlag=!0),this.prevLanes=l,this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:a,scrollMargin:n,getItemKey:u,enabled:d,lanes:l}),{key:!1,skipInitialOnChange:!0,onChange:()=>{this.notify(this.isScrolling)}}),this.getMeasurements=Ye(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:a,scrollMargin:n,getItemKey:u,enabled:d,lanes:l},_)=>{if(!d)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>t)for(const b of this.laneAssignments.keys())b>=t&&this.laneAssignments.delete(b);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(b=>{this.itemSizeCache.set(b.key,b.size)}));const h=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===t&&(this.lanesSettling=!1);const y=this.measurementsCache.slice(0,h),w=new Array(l).fill(void 0);for(let b=0;b<h;b++){const S=y[b];S&&(w[S.lane]=b)}for(let b=h;b<t;b++){const S=u(b),$=this.laneAssignments.get(b);let T,E;if($!==void 0&&this.options.lanes>1){T=$;const C=w[T],r=C!==void 0?y[C]:void 0;E=r?r.end+this.options.gap:a+n}else{const C=this.options.lanes===1?y[b-1]:this.getFurthestMeasurement(y,b);E=C?C.end+this.options.gap:a+n,T=C?C.lane:b%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(b,T)}const V=_.get(S),Z=typeof V=="number"?V:this.options.estimateSize(b),I=E+Z;y[b]={index:b,start:E,size:Z,end:I,key:S,lane:T},w[T]=b}return this.measurementsCache=y,y},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Ye(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(t,a,n,u)=>this.range=t.length>0&&a>0?Ur({measurements:t,outerSize:a,scrollOffset:n,lanes:u}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Ye(()=>{let t=null,a=null;const n=this.calculateRange();return n&&(t=n.startIndex,a=n.endIndex),this.maybeNotify.updateDeps([this.isScrolling,t,a]),[this.options.rangeExtractor,this.options.overscan,this.options.count,t,a]},(t,a,n,u,d)=>u===null||d===null?[]:t({startIndex:u,endIndex:d,overscan:a,count:n}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=t=>{const a=this.options.indexAttribute,n=t.getAttribute(a);return n?parseInt(n,10):(console.warn(`Missing attribute name '${a}={index}' on measured element.`),-1)},this._measureElement=(t,a)=>{const n=this.indexFromElement(t),u=this.measurementsCache[n];if(!u)return;const d=u.key,l=this.elementsCache.get(d);l!==t&&(l&&this.observer.unobserve(l),this.observer.observe(t),this.elementsCache.set(d,t)),t.isConnected&&this.resizeItem(n,this.options.measureElement(t,a,this))},this.resizeItem=(t,a)=>{const n=this.measurementsCache[t];if(!n)return;const u=this.itemSizeCache.get(n.key)??n.size,d=a-u;d!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(n,d,this):n.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=d,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(n.index),this.itemSizeCache=new Map(this.itemSizeCache.set(n.key,a)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((a,n)=>{a.isConnected||(this.observer.unobserve(a),this.elementsCache.delete(n))});return}this._measureElement(t,void 0)},this.getVirtualItems=Ye(()=>[this.getVirtualIndexes(),this.getMeasurements()],(t,a)=>{const n=[];for(let u=0,d=t.length;u<d;u++){const l=t[u],_=a[l];n.push(_)}return n},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const a=this.getMeasurements();if(a.length!==0)return Cs(a[kn(0,a.length-1,n=>Cs(a[n]).start,t)])},this.getOffsetForAlignment=(t,a,n=0)=>{const u=this.getSize(),d=this.getScrollOffset();a==="auto"&&(a=t>=d+u?"end":"start"),a==="center"?t+=(n-u)/2:a==="end"&&(t-=u);const l=this.getTotalSize()+this.options.scrollMargin-u;return Math.max(Math.min(l,t),0)},this.getOffsetForIndex=(t,a="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const n=this.measurementsCache[t];if(!n)return;const u=this.getSize(),d=this.getScrollOffset();if(a==="auto")if(n.end>=d+u-this.options.scrollPaddingEnd)a="end";else if(n.start<=d+this.options.scrollPaddingStart)a="start";else return[d,a];const l=a==="end"?n.end+this.options.scrollPaddingEnd:n.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(l,a,n.size),a]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(t,{align:a="start",behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,a),{adjustments:void 0,behavior:n})},this.scrollToIndex=(t,{align:a="auto",behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),t=Math.max(0,Math.min(t,this.options.count-1));let u=0;const d=10,l=h=>{if(!this.targetWindow)return;const y=this.getOffsetForIndex(t,h);if(!y){console.warn("Failed to get offset for index:",t);return}const[w,b]=y;this._scrollToOffset(w,{adjustments:void 0,behavior:n}),this.targetWindow.requestAnimationFrame(()=>{const S=this.getScrollOffset(),$=this.getOffsetForIndex(t,b);if(!$){console.warn("Failed to get offset for index:",t);return}Tr($[0],S)||_(b)})},_=h=>{this.targetWindow&&(u++,u<d?this.targetWindow.requestAnimationFrame(()=>l(h)):console.warn(`Failed to scroll to index ${t} after ${d} attempts.`))};l(a)},this.scrollBy=(t,{behavior:a}={})=>{a==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:a})},this.getTotalSize=()=>{var t;const a=this.getMeasurements();let n;if(a.length===0)n=this.options.paddingStart;else if(this.options.lanes===1)n=((t=a[a.length-1])==null?void 0:t.end)??0;else{const u=Array(this.options.lanes).fill(null);let d=a.length-1;for(;d>=0&&u.some(l=>l===null);){const l=a[d];u[l.lane]===null&&(u[l.lane]=l.end),d--}n=Math.max(...u.filter(l=>l!==null))}return Math.max(n-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:a,behavior:n})=>{this.options.scrollToFn(t,{behavior:n,adjustments:a},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(i)}}const kn=(s,i,t,a)=>{for(;s<=i;){const n=(s+i)/2|0,u=t(n);if(u<a)s=n+1;else if(u>a)i=n-1;else return n}return s>0?s-1:0};function Ur({measurements:s,outerSize:i,scrollOffset:t,lanes:a}){const n=s.length-1,u=_=>s[_].start;if(s.length<=a)return{startIndex:0,endIndex:n};let d=kn(0,n,u,t),l=d;if(a===1)for(;l<n&&s[l].end<t+i;)l++;else if(a>1){const _=Array(a).fill(0);for(;l<n&&_.some(y=>y<t+i);){const y=s[l];_[y.lane]=y.end,l++}const h=Array(a).fill(t+i);for(;d>=0&&h.some(y=>y>=t);){const y=s[d];h[y.lane]=y.start,d--}d=Math.max(0,d-d%a),l=Math.min(n,l+(a-1-l%a))}return{startIndex:d,endIndex:l}}const ks=typeof document<"u"?c.useLayoutEffect:c.useEffect;function Wr(s){const i=c.useReducer(()=>({}),{})[1],t={...s,onChange:(n,u)=>{var d;u?sa.flushSync(i):i(),(d=s.onChange)==null||d.call(s,n,u)}},[a]=c.useState(()=>new Lr(t));return a.setOptions(t),ks(()=>a._didMount(),[]),ks(()=>a._willUpdate()),a}function Tn(s){return Wr({observeElementRect:Or,observeElementOffset:Fr,scrollToFn:Hr,...s})}function zr(s){const i=new Map;for(const t of s){const a=`${t.service_id}:${t.zone_id}:${t.min_weight??0}:${t.max_weight??0}`;i.set(a,{rate:t.rate,cost:t.cost})}return i}function Vr(s){const i=new Set,t=[];for(const a of s){const n=a.min_weight??0,u=a.max_weight??0;if(n===0&&u===0)continue;const d=`${n}:${u}`;i.has(d)||(i.add(d),t.push({min_weight:n,max_weight:u}))}return t.sort((a,n)=>a.max_weight-n.max_weight)}const Zr=Te.memo(({value:s,onSave:i,disabled:t=!1})=>{const[a,n]=c.useState(!1),[u,d]=c.useState((s==null?void 0:s.toString())||""),[l,_]=c.useState((s==null?void 0:s.toString())||""),h=c.useRef(null);c.useEffect(()=>{_((s==null?void 0:s.toString())||""),a||d((s==null?void 0:s.toString())||"")},[s,a]),c.useEffect(()=>{a&&h.current&&(h.current.focus(),h.current.select())},[a]);const y=()=>{u!==l&&(i(u),_(u)),n(!1)},w=b=>{b.key==="Enter"?y():b.key==="Escape"&&(d(l),n(!1))};return a?e.jsx("input",{ref:h,type:"number",step:"any",min:"0",value:u,onChange:b=>d(b.target.value),onBlur:y,onKeyDown:w,disabled:t,className:"w-full h-full p-0 border-none outline-none ring-0 text-center text-sm text-foreground relative z-20 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary bg-background"}):e.jsx("div",{className:se("w-full h-full px-2 py-2 text-center text-sm text-muted-foreground cursor-pointer hover:bg-accent flex items-center justify-center",t&&"cursor-not-allowed opacity-50"),onClick:()=>!t&&n(!0),title:t?"Read only":"Click to edit",children:e.jsx("span",{children:l!==""&&!isNaN(Number(l))?Number(l).toFixed(2):"-"})})});Zr.displayName="EditableCell";const Dt=(s,i,t)=>s===0?`Up to ${i} ${t}`:`${s} â€“ ${i} ${t}`;function Gr({onAddWeightRange:s,weightUnit:i,weightRangePresets:t,onAddFromPreset:a,missingRanges:n,onAddMissingRange:u,align:d="start"}){return e.jsxs(jt,{children:[e.jsx(wt,{asChild:!0,children:e.jsxs("button",{className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-primary hover:bg-accent rounded-md transition-colors",children:[e.jsx(Fe,{className:"h-3 w-3"}),"Add Weight Range"]})}),e.jsx(St,{align:d,className:"w-60 p-2",sideOffset:8,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground px-2 py-1",children:"Add weight range"}),n&&n.length>0&&u&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-muted-foreground px-2 py-0.5",children:"Missing from this service"}),e.jsx("div",{className:"max-h-32 overflow-y-auto space-y-0.5",children:n.map(l=>e.jsx("button",{onClick:()=>u(l.min_weight,l.max_weight),className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors truncate text-amber-600 dark:text-amber-400",title:Dt(l.min_weight,l.max_weight,i),children:Dt(l.min_weight,l.max_weight,i)},`${l.min_weight}-${l.max_weight}`))}),e.jsx("div",{className:"border-t border-border my-1"})]}),t&&t.length>0&&a&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-muted-foreground px-2 py-0.5",children:"Carrier presets"}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-0.5",children:t.map(l=>e.jsx("button",{onClick:()=>a(l.min_weight,l.max_weight),className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors truncate",title:Dt(l.min_weight,l.max_weight,i),children:Dt(l.min_weight,l.max_weight,i)},`${l.min_weight}-${l.max_weight}`))}),e.jsx("div",{className:"border-t border-border my-1"})]}),e.jsxs("button",{onClick:s,className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors flex items-center gap-1.5 text-primary font-medium",children:[e.jsx(Fe,{className:"h-3.5 w-3.5"}),"Custom range"]})]})})]})}const In=Te.memo(({value:s,onSave:i})=>{const[t,a]=c.useState(!1),[n,u]=c.useState((s==null?void 0:s.toString())||""),[d,l]=c.useState((s==null?void 0:s.toString())||""),_=c.useRef(null);c.useEffect(()=>{l((s==null?void 0:s.toString())||""),t||u((s==null?void 0:s.toString())||"")},[s,t]),c.useEffect(()=>{t&&_.current&&(_.current.focus(),_.current.select())},[t]);const h=()=>{const w=n.trim(),b=parseFloat(w);w===""||isNaN(b)?u(d):n!==d&&(i(n),l(n)),a(!1)},y=w=>{w.key==="Enter"?h():w.key==="Escape"&&(u(d),a(!1))};return t?e.jsx("input",{ref:_,type:"number",step:"any",min:"0",value:n,onChange:w=>u(w.target.value),onBlur:h,onKeyDown:y,className:"w-full h-full p-0 border-none outline-none ring-0 text-center text-sm text-foreground relative z-20 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary bg-background"}):e.jsx("div",{className:"w-full h-full px-2 py-2 text-center text-sm text-muted-foreground cursor-pointer hover:bg-accent flex items-center justify-center",onClick:()=>a(!0),title:"Click to edit",children:e.jsx("span",{children:d!==""&&!isNaN(Number(d))?Number(d).toFixed(2):"-"})})});In.displayName="EditableCell";function Br({service:s,sharedZones:i,serviceRates:t,weightRanges:a,serviceFilteredWeightRanges:n,weightUnit:u,onCellEdit:d,onDeleteRate:l,onAddWeightRange:_,onRemoveWeightRange:h,onEditWeightRange:y,onEditZone:w,onDeleteZone:b,onAssignZoneToService:S,onCreateNewZone:$,onRemoveZoneFromService:T,missingRanges:E,onAddMissingRange:V,weightRangePresets:Z,onAddFromPreset:I}){const C=c.useRef(null),[r,f]=c.useState(!1),R=s.zone_ids||[],B=c.useMemo(()=>i.filter(p=>R.includes(p.id)),[i,R]),O=c.useMemo(()=>i.filter(p=>!R.includes(p.id)),[i,R]),xe=c.useMemo(()=>zr(t),[t]),me=n??a,Ne=c.useMemo(()=>me.length===0?[{min_weight:0,max_weight:0}]:me,[me]),ve=Tn({count:Ne.length,getScrollElement:()=>C.current,estimateSize:()=>40,overscan:10}),ge=!!(S||$),he=200,ne=140,ae=40,Ae=he+B.length*ne+(ge?ae:0),Ie=p=>{var z;const D=[];return(z=p.country_codes)!=null&&z.length&&D.push(`Countries: ${p.country_codes.join(", ")}`),p.transit_days!=null&&D.push(`Transit: ${p.transit_days} days`),D.length>0?D.join(`
`):p.label||""},Ze=p=>{const D=t.filter(G=>G.service_id===s.id&&G.min_weight===p.min_weight&&G.max_weight===p.max_weight&&G.rate!=null&&G.rate>0),z=D.length;if(z===0)return"No rates set";const P=D.reduce((G,Y)=>G+(Y.rate??0),0)/z;return`${z} rate${z!==1?"s":""}, avg ${P.toFixed(2)}`};if(B.length===0)return e.jsx("div",{className:"flex-1 flex items-center justify-center text-muted-foreground bg-muted/50 rounded border-2 border-dashed",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-sm",children:"No zones assigned to this service"}),ge&&e.jsx("button",{onClick:()=>$?$(s.id):S==null?void 0:S(s.id,""),className:"mt-2 text-xs text-primary hover:underline",children:"+ Add zone"})]})});const He=(p,D)=>D?"Flat rate":p.min_weight===0?`Up to ${p.max_weight} ${u}`:`${p.min_weight} â€“ ${p.max_weight} ${u}`;return e.jsx(Da,{delayDuration:300,children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex-1 flex flex-col border border-border rounded-md bg-background overflow-hidden",children:e.jsx("div",{ref:C,className:"flex-1 overflow-auto",children:e.jsxs("div",{style:{minWidth:`${Ae}px`},children:[e.jsxs("div",{className:"flex border-b border-border bg-muted font-medium text-sm text-foreground sticky top-0 z-30 shadow-sm",children:[e.jsxs("div",{className:"p-3 border-r border-border flex-shrink-0 bg-muted sticky left-0 z-40 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",style:{width:`${he}px`},children:["Weight (",u,")"]}),B.map((p,D)=>e.jsx("div",{className:"p-3 border-r border-border flex-shrink-0 bg-muted group/zone",style:{width:`${ne}px`},children:e.jsxs("div",{className:"flex items-center justify-center gap-0.5",children:[e.jsxs(ys,{children:[e.jsx(js,{asChild:!0,children:e.jsx("span",{className:"truncate text-center flex-1 min-w-0 cursor-default",children:p.label||`Zone ${D+1}`})}),e.jsx(ws,{side:"bottom",className:"max-w-xs text-xs whitespace-pre-line",children:Ie(p)})]}),e.jsxs("div",{className:"flex items-center gap-0 opacity-0 group-hover/zone:opacity-100 transition-all flex-shrink-0 bg-muted",children:[w&&e.jsx("button",{onClick:()=>w(p),className:"p-0.5 rounded-sm text-muted-foreground hover:text-primary hover:bg-accent/50",title:`Edit ${p.label||"zone"}`,children:e.jsx(Mt,{className:"h-3 w-3"})}),b&&e.jsx("button",{onClick:()=>b(p.label),className:"p-0.5 rounded-sm text-muted-foreground hover:text-destructive hover:bg-destructive/10",title:`Delete ${p.label||"zone"}`,children:e.jsx($t,{className:"h-3 w-3"})}),T&&e.jsx("button",{onClick:()=>T(s.id,p.id),className:"p-0.5 rounded-sm text-muted-foreground hover:text-destructive hover:bg-destructive/10",title:`Remove ${p.label||"zone"} from this service`,children:e.jsx(tt,{className:"h-3 w-3"})})]})]})},p.id||D)),ge&&e.jsx("div",{className:"flex-shrink-0 bg-muted flex items-center justify-center border-r border-border",style:{width:`${ae}px`},children:e.jsxs(jt,{open:r,onOpenChange:f,children:[e.jsx(wt,{asChild:!0,children:e.jsx("button",{className:"p-1 text-muted-foreground hover:text-primary transition-colors",title:"Add zone to this service",children:e.jsx(Fe,{className:"h-3.5 w-3.5"})})}),e.jsx(St,{align:"start",className:"w-56 p-2",sideOffset:8,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground px-2 py-1",children:"Add zone"}),O.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-0.5",children:O.map(p=>e.jsx("button",{onClick:()=>{S==null||S(s.id,p.id),f(!1)},className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors truncate",title:p.label,children:p.label||p.id},p.id))}),e.jsx("div",{className:"border-t border-border my-1"})]}),$&&e.jsxs("button",{onClick:()=>{$(s.id),f(!1)},className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors flex items-center gap-1.5 text-primary font-medium",children:[e.jsx(Fe,{className:"h-3.5 w-3.5"}),"Create new zone"]})]})})]})})]}),e.jsx("div",{style:{height:`${ve.getTotalSize()}px`,position:"relative"},children:ve.getVirtualItems().map(p=>{const D=Ne[p.index],z=D.min_weight===0&&D.max_weight===0;return e.jsxs("div",{className:"absolute top-0 left-0 w-full flex border-b border-border group hover:bg-muted/50 transition-colors",style:{height:`${p.size}px`,transform:`translateY(${p.start}px)`},children:[e.jsxs("div",{className:"px-3 py-2 border-r border-border flex-shrink-0 bg-background sticky left-0 z-20 flex items-center justify-between shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",style:{width:`${he}px`},children:[e.jsxs(ys,{children:[e.jsx(js,{asChild:!0,children:e.jsx("span",{className:"text-sm text-foreground cursor-default",children:He(D,z)})}),!z&&e.jsx(ws,{side:"right",className:"text-xs",children:Ze(D)})]}),e.jsxs("div",{className:"flex items-center gap-0 opacity-0 group-hover:opacity-100 transition-opacity",children:[y&&!z&&e.jsx("button",{onClick:()=>y(D),className:"p-0.5 text-muted-foreground hover:text-primary",title:"Edit weight range",children:e.jsx(Mt,{className:"h-3 w-3"})}),h&&!z&&e.jsx("button",{onClick:()=>h(D.min_weight,D.max_weight),className:"p-0.5 text-muted-foreground hover:text-destructive",title:"Remove weight range",children:e.jsx($t,{className:"h-3 w-3"})})]})]}),B.map(P=>{const G=`${s.id}:${P.id}:${D.min_weight}:${D.max_weight}`,Y=xe.get(G),ue=(Y==null?void 0:Y.rate)!=null&&Y.rate>0;return e.jsxs("div",{className:"border-r border-border flex-shrink-0 relative group/cell",style:{width:`${ne}px`},children:[e.jsx(In,{value:(Y==null?void 0:Y.rate)??null,onSave:ie=>{const Q=parseFloat(ie);isNaN(Q)||d(s.id,P.id,D.min_weight,D.max_weight,Q)}}),l&&ue&&e.jsx("button",{onClick:ie=>{ie.stopPropagation(),l(s.id,P.id,D.min_weight,D.max_weight)},className:"absolute inset-y-0 right-px my-auto h-4 w-4 flex items-center justify-center opacity-0 group-hover/cell:opacity-100 text-muted-foreground hover:text-destructive transition-opacity z-10",title:"Delete rate",children:e.jsx(tt,{className:"h-2.5 w-2.5"})})]},P.id)}),ge&&e.jsx("div",{className:"flex-shrink-0",style:{width:`${ae}px`}})]},p.key)})})]})})}),_&&e.jsx("div",{className:"flex items-center gap-2 mt-2 pt-2 border-t border-border",children:e.jsx(Gr,{onAddWeightRange:_,weightUnit:u,weightRangePresets:Z,onAddFromPreset:I,missingRanges:E,onAddMissingRange:V})})]})})}function qr({open:s,onOpenChange:i,existingRanges:t,weightUnit:a,onAdd:n,isLoading:u=!1}){const[d,l]=c.useState(""),[_,h]=c.useState(null),y=t.length>0?Math.max(...t.map(b=>b.max_weight)):0,w=()=>{h(null);const b=parseFloat(d);if(isNaN(b)||b<=0){h("Max weight must be a positive number");return}if(b<=y){h(`Max weight must be greater than ${y} ${a}`);return}if(t.some($=>y<$.max_weight&&b>$.min_weight)){h("This weight range overlaps with an existing range");return}n(y,b),l(""),h(null),i(!1)};return e.jsx(Tt,{open:s,onOpenChange:i,children:e.jsxs(ct,{children:[e.jsxs(dt,{children:[e.jsx(mt,{children:"Add Weight Range"}),e.jsx(ht,{children:"Add a new weight bracket to the rate grid. Rates will be initialized to 0 for all service-zone combinations."})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{children:[e.jsxs(W,{children:["Min Weight (",a,")"]}),e.jsx(te,{value:y,disabled:!0,className:"mt-1"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Auto-derived from the previous range"})]}),e.jsxs("div",{children:[e.jsxs(W,{children:["Max Weight (",a,")"]}),e.jsx(te,{type:"number",step:"any",min:y+.01,value:d,onChange:b=>l(b.target.value),onKeyDown:b=>{b.key==="Enter"&&(b.preventDefault(),w())},placeholder:`e.g., ${y+5}`,className:"mt-1",autoFocus:!0}),_&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:_})]})]}),e.jsxs(ut,{children:[e.jsx(gt,{children:"Cancel"}),e.jsx(xt,{onClick:w,disabled:u||!d,children:u?"Adding...":"Add Range"})]})]})})}function Ts({services:s,onAddService:i,servicePresets:t,onAddServiceFromPreset:a,onCloneService:n,align:u="end",iconOnly:d=!1}){return e.jsxs(jt,{children:[e.jsx(wt,{asChild:!0,children:d?e.jsx("button",{className:"p-1.5 text-muted-foreground hover:text-primary hover:bg-accent rounded-md transition-colors",title:"Add service",children:e.jsx(Fe,{className:"h-4 w-4"})}):e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 rounded-md transition-colors",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Add Service"]})}),e.jsx(St,{align:u,className:"w-56 p-2",sideOffset:8,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground px-2 py-1",children:"Add service"}),t&&t.length>0&&a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-0.5",children:t.map(l=>e.jsx("button",{onClick:()=>a(l.code),className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors truncate",title:l.name,children:l.name||l.code},l.code))}),e.jsx("div",{className:"border-t border-border my-1"})]}),s.length>0&&n&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-muted-foreground px-2 py-0.5",children:"Clone existing"}),e.jsx("div",{className:"max-h-32 overflow-y-auto space-y-0.5",children:s.map(l=>e.jsx("button",{onClick:()=>n(l),className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors truncate text-muted-foreground",title:`Clone ${l.service_name}`,children:l.service_name||l.service_code},l.id))}),e.jsx("div",{className:"border-t border-border my-1"})]}),e.jsxs("button",{onClick:i,className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors flex items-center gap-1.5 text-primary font-medium",children:[e.jsx(Fe,{className:"h-3.5 w-3.5"}),"Create new service"]})]})})]})}function Kr({open:s,onOpenChange:i,weightRange:t,existingRanges:a,weightUnit:n,onSave:u,isLoading:d=!1}){const[l,_]=c.useState(""),[h,y]=c.useState(null);if(c.useEffect(()=>{s&&t&&(_(t.max_weight.toString()),y(null))},[s,t]),!t)return null;const w=S=>{S==null||S.preventDefault(),y(null);const $=parseFloat(l);if(isNaN($)||$<=0){y("Max weight must be a positive number");return}if($<=t.min_weight){y(`Max weight must be greater than ${t.min_weight} ${n}`);return}if(a.filter(V=>!(V.min_weight===t.min_weight&&V.max_weight===t.max_weight)).some(V=>t.min_weight<V.max_weight&&$>V.min_weight)){y("This weight range would overlap with an existing range");return}u(t.min_weight,t.max_weight,$),i(!1)},b=S=>{S.key==="Enter"&&(S.preventDefault(),w())};return e.jsx(pt,{open:s,onOpenChange:i,children:e.jsxs(_t,{className:"max-w-sm",children:[e.jsxs(vt,{children:[e.jsx(bt,{children:"Edit Weight Range"}),e.jsx(Ot,{children:"Modify the max weight for this bracket. Existing rates will be re-keyed automatically."})]}),e.jsx(Ft,{children:e.jsxs("form",{id:"edit-weight-range-form",onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(W,{className:"text-xs",children:["Min Weight (",n,")"]}),e.jsx(te,{type:"number",value:t.min_weight,disabled:!0,className:"h-9 bg-muted text-muted-foreground"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(W,{className:"text-xs",children:["Max Weight (",n,")"]}),e.jsx(te,{type:"number",step:"any",min:t.min_weight+.01,value:l,onChange:S=>_(S.target.value),onKeyDown:b,className:"h-9",autoFocus:!0}),h&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:h})]})]})}),e.jsxs(yt,{children:[e.jsx(pe,{type:"button",variant:"outline",size:"sm",onClick:()=>i(!1),children:"Cancel"}),e.jsx(pe,{type:"submit",size:"sm",form:"edit-weight-range-form",disabled:d||!l,children:d?"Saving...":"Save"})]})]})})}function Yr(...s){return s.filter(Boolean).join(" ")}function Qr({surcharges:s,services:i,onEditSurcharge:t,onAddSurcharge:a,onRemoveSurcharge:n,surchargePresets:u,onAddSurchargeFromPreset:d,onCloneSurcharge:l}){const _=b=>i.filter(S=>{var $;return($=S.surcharge_ids)==null?void 0:$.includes(b)}).length,h=b=>b.surcharge_type==="percentage"?`${b.amount??0}%`:`${b.amount??0}`,y=b=>b.surcharge_type==="percentage"?"Percentage":"Fixed Amount",w=({align:b="end"})=>e.jsxs(jt,{children:[e.jsx(wt,{asChild:!0,children:e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 rounded-md transition-colors",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Add Surcharge"]})}),e.jsx(St,{align:b,className:"w-56 p-2",sideOffset:8,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground px-2 py-1",children:"Add surcharge"}),u&&u.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-0.5",children:u.map(S=>e.jsx("button",{onClick:()=>d==null?void 0:d(S.id),className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors truncate",title:`${S.name} (${S.surcharge_type==="percentage"?`${S.amount}%`:S.amount})`,children:S.name},S.id))}),e.jsx("div",{className:"border-t border-border my-1"})]}),s.length>0&&l&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-muted-foreground px-2 py-0.5",children:"Clone existing"}),e.jsx("div",{className:"max-h-32 overflow-y-auto space-y-0.5",children:s.map(S=>e.jsx("button",{onClick:()=>l(S),className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors truncate text-muted-foreground",title:`Clone ${S.name}`,children:S.name||"Unnamed"},S.id))}),e.jsx("div",{className:"border-t border-border my-1"})]}),e.jsxs("button",{onClick:a,className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors flex items-center gap-1.5 text-primary font-medium",children:[e.jsx(Fe,{className:"h-3.5 w-3.5"}),"Create new surcharge"]})]})})]});return s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground p-8",children:[e.jsx("p",{className:"mb-4",children:"No surcharges configured yet."}),e.jsx(w,{align:"center"})]}):e.jsxs("div",{className:"space-y-4 h-full overflow-y-auto pr-2",children:[e.jsxs("div",{className:"flex items-center justify-between sticky top-0 bg-background z-10 py-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Surcharge Configuration"}),e.jsx(w,{})]}),s.map((b,S)=>{const $=_(b.id);return e.jsx("div",{className:"bg-card border border-border rounded-lg shadow-sm hover:border-primary/50 transition-colors",children:e.jsxs("div",{className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-semibold text-foreground text-base",children:b.name||`Surcharge ${S+1}`}),e.jsx("span",{className:Yr("inline-flex items-center px-2.5 py-1 rounded-md text-xs font-semibold",b.active?"bg-green-500 text-white dark:bg-green-600 dark:text-white":"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300"),children:b.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>t(b),className:"p-1.5 text-muted-foreground hover:text-foreground hover:bg-accent rounded transition-colors",title:"Edit Surcharge",children:e.jsx(Mt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>n(b.id),className:"p-1.5 text-muted-foreground hover:text-destructive hover:bg-destructive/10 rounded transition-colors",title:"Delete Surcharge",children:e.jsx($t,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground whitespace-nowrap",children:"Type:"}),e.jsx("div",{className:"text-sm font-semibold text-foreground",children:y(b)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground whitespace-nowrap",children:"Amount:"}),e.jsx("div",{className:"text-sm font-semibold text-foreground",children:h(b)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground whitespace-nowrap",children:"Cost (COGS):"}),e.jsx("div",{className:"text-sm font-semibold text-foreground",children:b.cost!=null?b.cost:"â€”"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground whitespace-nowrap",children:"Linked Services:"}),e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[$," of ",i.length]})]})]})]})},b.id)})]})}function Xr({open:s,onOpenChange:i,zone:t,onSave:a,countryOptions:n,services:u,onToggleServiceZone:d}){const[l,_]=c.useState(""),[h,y]=c.useState([]),[w,b]=c.useState(""),[S,$]=c.useState(""),[T,E]=c.useState("");c.useEffect(()=>{var C,r,f;t&&s&&(_(t.label||""),y(t.country_codes||[]),b(((C=t.cities)==null?void 0:C.join(", "))||""),$(((r=t.postal_codes)==null?void 0:r.join(", "))||""),E(((f=t.transit_days)==null?void 0:f.toString())||""))},[t,s]);const V=C=>{const r=u.find(f=>f.id===C);return!r||!t?!1:(r.zones||[]).some(f=>f.id===t.id||f.label===t.label)},Z=()=>t?u.filter(C=>(C.zones||[]).some(r=>r.id===t.id||r.label===t.label)).length:0,I=C=>{if(C.preventDefault(),!t)return;const r=t.label||t.id,f=w.split(",").map(xe=>xe.trim()).filter(Boolean),R=S.split(",").map(xe=>xe.trim()).filter(Boolean),B=T?parseInt(T,10):null,O=B!==null&&B<0?0:B;a(r,{label:l,country_codes:Array.from(new Set(h.map(xe=>xe.toUpperCase()))),cities:f,postal_codes:R,transit_days:O}),i(!1)};return e.jsx(pt,{open:s,onOpenChange:i,children:e.jsxs(_t,{className:"max-w-lg",children:[e.jsxs(vt,{children:[e.jsx(bt,{children:"Edit Zone"}),e.jsx(Ot,{children:"Configure zone details and linked services"})]}),e.jsx(Ft,{children:e.jsxs("form",{id:"zone-form",onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Label"}),e.jsx(te,{value:l,onChange:C=>_(C.target.value),placeholder:"Zone 1",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Transit Days"}),e.jsx(te,{type:"number",min:0,value:T,onChange:C=>E(C.target.value),placeholder:"2",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Country Codes"}),e.jsx(Ht,{options:n,value:h,onValueChange:y,placeholder:"Select countries"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Cities (comma separated)"}),e.jsx(te,{value:w,onChange:C=>b(C.target.value),placeholder:"New York, Toronto",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Postal Codes (comma separated)"}),e.jsx(te,{value:S,onChange:C=>$(C.target.value),placeholder:"10001, 94105",className:"h-9"})]}),u.length>0&&d&&t&&e.jsxs("div",{className:"pt-3 border-t border-border",children:[e.jsxs(W,{className:"text-xs text-muted-foreground block mb-2",children:["Linked Services (",Z()," of ",u.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:u.map(C=>{const r=V(C.id),f=`zone-svc-${C.id}`;return e.jsxs("label",{htmlFor:f,className:"flex items-center gap-2.5 px-2 py-1.5 rounded-md hover:bg-accent cursor-pointer transition-colors",children:[e.jsx(ze,{id:f,checked:r,onCheckedChange:R=>d(C.id,t.id,R===!0)}),e.jsx("span",{className:"text-sm text-foreground",children:C.service_name||C.service_code})]},C.id)})})]})]})}),e.jsxs(yt,{children:[e.jsx(pe,{type:"button",variant:"outline",size:"sm",onClick:()=>i(!1),children:"Cancel"}),e.jsx(pe,{type:"submit",size:"sm",form:"zone-form",children:"Save"})]})]})})}const Jr=[{value:"fixed",label:"Fixed Amount"},{value:"percentage",label:"Percentage"}];function el({open:s,onOpenChange:i,surcharge:t,onSave:a,services:n,onToggleServiceSurcharge:u}){const[d,l]=c.useState(""),[_,h]=c.useState("fixed"),[y,w]=c.useState("0"),[b,S]=c.useState(""),[$,T]=c.useState(!0);c.useEffect(()=>{var I,C;t&&s&&(l(t.name||""),h(t.surcharge_type||"fixed"),w(((I=t.amount)==null?void 0:I.toString())||"0"),S(((C=t.cost)==null?void 0:C.toString())||""),T(t.active??!0))},[t,s]);const E=I=>{var r;if(!t)return!1;const C=n.find(f=>f.id===I);return((r=C==null?void 0:C.surcharge_ids)==null?void 0:r.includes(t.id))??!1},V=()=>t?n.filter(I=>{var C;return(C=I.surcharge_ids)==null?void 0:C.includes(t.id)}).length:0,Z=I=>{I.preventDefault(),t&&(a(t.id,{name:d,surcharge_type:_,amount:parseFloat(y)||0,cost:b?parseFloat(b):null,active:$}),i(!1))};return e.jsx(pt,{open:s,onOpenChange:i,children:e.jsxs(_t,{className:"max-w-lg",children:[e.jsxs(vt,{children:[e.jsx(bt,{children:"Edit Surcharge"}),e.jsx(Ot,{children:"Configure surcharge details and linked services"})]}),e.jsx(Ft,{children:e.jsxs("form",{id:"surcharge-form",onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Name"}),e.jsx(te,{value:d,onChange:I=>l(I.target.value),placeholder:"Fuel Surcharge",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Type"}),e.jsxs(ye,{value:_,onValueChange:h,children:[e.jsx(je,{className:"w-full h-9",children:e.jsx(we,{placeholder:"Select type"})}),e.jsx(Se,{children:Jr.map(I=>e.jsx(Ee,{value:I.value,children:I.label},I.value))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(W,{className:"text-xs",children:["Amount ",_==="percentage"?"(%)":""]}),e.jsx(te,{type:"number",step:"0.01",value:y,onChange:I=>w(I.target.value),placeholder:"0.00",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Cost (COGS)"}),e.jsx(te,{type:"number",step:"0.01",value:b,onChange:I=>S(I.target.value),placeholder:"0.00",className:"h-9"})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-1",children:[e.jsx(ze,{id:"surcharge-active",checked:$,onCheckedChange:I=>T(I===!0)}),e.jsx(W,{htmlFor:"surcharge-active",className:"text-xs cursor-pointer",children:"Active"})]}),n.length>0&&t&&e.jsxs("div",{className:"pt-3 border-t border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(W,{className:"text-xs text-muted-foreground",children:["Linked Services (",V()," of ",n.length,")"]}),e.jsx("button",{type:"button",onClick:()=>{const I=V()===n.length;n.forEach(C=>{const r=E(C.id);I&&r?u(C.id,t.id,!1):!I&&!r&&u(C.id,t.id,!0)})},className:"text-xs text-primary hover:text-primary/80 font-medium",children:V()===n.length?"Deselect All":"Select All"})]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:n.map(I=>{const C=E(I.id),r=`surch-svc-${I.id}`;return e.jsxs("label",{htmlFor:r,className:"flex items-center gap-2.5 px-2 py-1.5 rounded-md hover:bg-accent cursor-pointer transition-colors",children:[e.jsx(ze,{id:r,checked:C,onCheckedChange:f=>u(I.id,t.id,f===!0)}),e.jsx("span",{className:"text-sm text-foreground",children:I.service_name||I.service_code})]},I.id)})})]})]})}),e.jsxs(yt,{children:[e.jsx(pe,{type:"button",variant:"outline",size:"sm",onClick:()=>i(!1),children:"Cancel"}),e.jsx(pe,{type:"submit",size:"sm",form:"surcharge-form",children:"Save"})]})]})})}function tl({open:s,onOpenChange:i,serviceRate:t,onSave:a,services:n,sharedZones:u,weightUnit:d}){var I,C;const[l,_]=c.useState(""),[h,y]=c.useState(""),[w,b]=c.useState(""),[S,$]=c.useState("");c.useEffect(()=>{var r,f,R,B;t&&s&&(_(((r=t.rate)==null?void 0:r.toString())||"0"),y(((f=t.cost)==null?void 0:f.toString())||""),b(((R=t.transit_days)==null?void 0:R.toString())||""),$(((B=t.transit_time)==null?void 0:B.toString())||""))},[t,s]);const T=t?((I=n.find(r=>r.id===t.service_id))==null?void 0:I.service_name)||t.service_id:"",E=t?((C=u.find(r=>r.id===t.zone_id))==null?void 0:C.label)||t.zone_id:"",V=t?t.min_weight===0&&t.max_weight===0?"Flat rate":t.min_weight===0?`Up to ${t.max_weight} ${d}`:`${t.min_weight} â€“ ${t.max_weight} ${d}`:"",Z=r=>{if(r.preventDefault(),!t)return;const f=w?parseInt(w,10):null,R=S?parseFloat(S):null;a({...t,rate:parseFloat(l)||0,cost:h?parseFloat(h):null,transit_days:f!==null&&!isNaN(f)?f:null,transit_time:R!==null&&!isNaN(R)?R:null}),i(!1)};return e.jsx(pt,{open:s,onOpenChange:i,children:e.jsxs(_t,{className:"max-w-lg",children:[e.jsxs(vt,{children:[e.jsx(bt,{children:"Edit Service Rate"}),e.jsx(Ot,{children:"Update rate details for this service-zone-weight combination"})]}),e.jsx(Ft,{children:e.jsxs("form",{id:"service-rate-form",onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground w-20",children:"Service:"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:T})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground w-20",children:"Zone:"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:E})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground w-20",children:"Weight:"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:V})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Rate (Sell Price)"}),e.jsx(te,{type:"number",step:"0.01",value:l,onChange:r=>_(r.target.value),placeholder:"0.00",className:"h-9",autoFocus:!0})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Cost (COGS)"}),e.jsx(te,{type:"number",step:"0.01",value:h,onChange:r=>y(r.target.value),placeholder:"0.00",className:"h-9"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Transit Days"}),e.jsx(te,{type:"number",min:0,step:"1",value:w,onChange:r=>b(r.target.value),placeholder:"e.g., 3",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Transit Time (hours)"}),e.jsx(te,{type:"number",min:0,step:"0.5",value:S,onChange:r=>$(r.target.value),placeholder:"e.g., 48",className:"h-9"})]})]})]})}),e.jsxs(yt,{children:[e.jsx(pe,{type:"button",variant:"outline",size:"sm",onClick:()=>i(!1),children:"Cancel"}),e.jsx(pe,{type:"submit",size:"sm",form:"service-rate-form",children:"Save"})]})]})})}const sl=[{key:"type",label:"Type",width:100},{key:"fromCountry",label:"From",width:60},{key:"zone",label:"Zone",width:120},{key:"carrierCode",label:"Carrier",width:100},{key:"serviceCode",label:"Service Code",width:140},{key:"serviceName",label:"Service Name",width:200},{key:"minWeight",label:"Min Weight",width:90},{key:"maxWeight",label:"Max Weight",width:90},{key:"maxLength",label:"Max Length",width:90},{key:"maxWidth",label:"Max Width",width:90},{key:"maxHeight",label:"Max Height",width:90},{key:"rate",label:"Base Rate",width:90},{key:"currency",label:"Currency",width:70}],nl=[];function il(s,i){var t,a,n;switch(i){case"type":return s.type;case"fromCountry":return s.fromCountry;case"zone":return s.zone;case"carrierCode":return s.carrierCode;case"serviceCode":return s.serviceCode;case"serviceName":return s.serviceName;case"minWeight":return s.minWeight.toString();case"maxWeight":return s.maxWeight.toString();case"maxLength":return((t=s.maxLength)==null?void 0:t.toString())||"";case"maxWidth":return((a=s.maxWidth)==null?void 0:a.toString())||"";case"maxHeight":return((n=s.maxHeight)==null?void 0:n.toString())||"";case"rate":return s.rate!=null?s.rate.toFixed(2):"";case"currency":return s.currency;default:return s.surcharges[i]!=null?s.surcharges[i].toFixed(2):""}}const al=Te.memo(function({row:i,rowIndex:t,columns:a,height:n,start:u}){return e.jsxs("div",{className:se("absolute top-0 left-0 w-full flex border-b border-border text-xs",t%2===0?"bg-background":"bg-muted/30"),style:{height:`${n}px`,transform:`translateY(${u}px)`},children:[e.jsx("div",{className:"w-10 px-2 py-1.5 border-r border-border flex-shrink-0 bg-background text-center text-muted-foreground sticky left-0 z-10",children:t+1}),a.map(d=>{const l=il(i,d.key);return e.jsx("div",{className:"px-2 py-1.5 border-r border-border flex-shrink-0 truncate text-foreground",style:{width:`${d.width}px`},title:l,children:l},d.key)})]})});function rl({open:s,onOpenChange:i,name:t,carrierName:a,originCountries:n,services:u,sharedZones:d,serviceRates:l,weightRanges:_,surcharges:h,weightUnit:y}){const w=c.useRef(null),b=c.useMemo(()=>{if(!s)return new Map;const f=new Map;for(const R of l){const B=`${R.service_id}:${R.zone_id}:${R.min_weight??0}:${R.max_weight??0}`;f.set(B,R.rate)}return f},[s,l]),S=c.useMemo(()=>s?h.filter(f=>f.name).map(f=>({key:f.id,label:f.name,width:100})):[],[s,h]),$=c.useMemo(()=>{if(!s)return new Map;const f=new Map;for(const R of h)f.set(R.id,R.amount);return f},[s,h]),T=c.useMemo(()=>{if(!s)return nl;const f=[],R=n.join(", ")||"â€”",B=_.length>0?_:[{min_weight:0,max_weight:0}];for(const O of u){const me=(O.zone_ids||[]).map(ne=>d.find(ae=>ae.id===ne)).filter(Boolean),Ne=new Set(O.surcharge_ids||[]),ve={};$.forEach((ne,ae)=>{Ne.has(ae)&&(ve[ae]=ne)});const he=(O.features||[]).includes("returns")||/\breturn/i.test(O.service_name||"")||/\breturn/i.test(O.service_code||"")?"RETURN":"SHIPPING";if(me.length!==0)for(const ne of me)for(const ae of B){const Ae=`${O.id}:${ne.id}:${ae.min_weight}:${ae.max_weight}`,Ie=b.get(Ae)??null;f.push({type:he,fromCountry:R,zone:ne.label||"â€”",carrierCode:a,serviceCode:O.service_code,serviceName:O.service_name,minWeight:ae.min_weight,maxWeight:ae.max_weight,maxLength:O.max_length??null,maxWidth:O.max_width??null,maxHeight:O.max_height??null,rate:Ie,currency:O.currency||"USD",weightUnit:O.weight_unit||y,surcharges:ve})}}return f},[s,u,d,_,$,a,n,y,b]),E=c.useDeferredValue(T),V=E!==T,Z=c.useMemo(()=>[...sl,...S],[S]),I=c.useMemo(()=>Z.reduce((f,R)=>f+R.width,0),[Z]),C=Tn({count:E.length,getScrollElement:()=>w.current,estimateSize:()=>32,overscan:5}),r=c.useCallback(()=>i(!1),[i]);return e.jsx(Hs,{open:s,onOpenChange:i,children:e.jsxs(Ls,{side:"right",className:"w-full sm:max-w-full p-0",hideCloseButton:!0,children:[e.jsx(Us,{className:"px-4 sm:px-6 py-4 border-b border-border bg-background",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs(Ws,{className:"text-lg font-semibold flex-1",children:[t||"Rate Sheet"," â€” Preview"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[T.length," rows"]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:[Z.length," columns"]})]}),e.jsx("button",{onClick:r,className:"p-2 rounded-md text-muted-foreground hover:text-foreground hover:bg-accent transition-colors","aria-label":"Close preview",children:e.jsx(tt,{className:"h-5 w-5"})})]})}),e.jsx("div",{className:"flex-1 h-[calc(100vh-73px)] overflow-hidden",children:T.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-sm",children:"No data to preview"}),e.jsx("p",{className:"text-xs mt-1",children:"Add services and configure rates to see the preview"})]})}):e.jsxs("div",{className:"relative h-full",children:[V&&e.jsx("div",{className:"absolute inset-0 z-30 flex items-center justify-center bg-background/60",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(kt,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Loading preview..."})]})}),e.jsx("div",{ref:w,className:se("h-full overflow-auto transition-opacity duration-150",V&&"opacity-60"),children:e.jsxs("div",{style:{minWidth:`${I}px`},children:[e.jsxs("div",{className:"flex border-b border-border bg-muted font-medium text-xs text-foreground sticky top-0 z-10",children:[e.jsx("div",{className:"w-10 px-2 py-2 border-r border-border flex-shrink-0 bg-muted text-center text-muted-foreground sticky left-0 z-20",children:"#"}),Z.map(f=>e.jsx("div",{className:"px-2 py-2 border-r border-border flex-shrink-0 bg-muted truncate",style:{width:`${f.width}px`},title:f.label,children:f.label},f.key))]}),e.jsx("div",{style:{height:`${C.getTotalSize()}px`,position:"relative"},children:C.getVirtualItems().map(f=>e.jsx(al,{row:E[f.index],rowIndex:f.index,columns:Z,height:f.size,start:f.start},f.key))})]})})]})})]})})}const ke=(s="temp")=>`${s}-${crypto.randomUUID()}`,Is=s=>{if(s){if(!Array.isArray(s)){const i={};for(const[t,a]of Object.entries(s))if(typeof a=="string"){const n=a.trim();n===""?i[t]=null:i[t]=n}else a!=null&&(i[t]=a);return Object.keys(i).length>0?i:void 0}if(s.length!==0)return Object.fromEntries(s.map(i=>[i,!0]))}},es=s=>!s||typeof s!="object"?[]:Object.entries(s).filter(([i,t])=>t===!0).map(([i])=>i),ll=({rateSheetId:s,onClose:i,preloadCarrier:t,linkConnectionId:a,isAdmin:n=!1,useRateSheet:u,useRateSheetMutation:d})=>{var gs,fs,ps,_s;const _=!(s==="new"),[h,y]=c.useState(t||""),[w,b]=c.useState(""),[S,$]=c.useState([]),[T,E]=c.useState([]),[V,Z]=c.useState([]),[I,C]=c.useState([]),[r,f]=c.useState([]),[R,B]=c.useState(null),O=c.useRef(null),[xe,me]=c.useState(!1),[Ne,ve]=c.useState(null),[ge,he]=c.useState(!1),[ne,ae]=c.useState(null),[Ae,Ie]=c.useState(null),[Ze,He]=c.useState(!1),[p,D]=c.useState(!1),[z,P]=c.useState(!1),[G,Y]=c.useState("rate_sheet"),[ue,ie]=c.useState(!1),[Q,Lt]=c.useState(null),[Mn,nt]=c.useState(!1),[Me,Nt]=c.useState(null),[it,as]=c.useState(!1),[$n,Ut]=c.useState(!1),[fe,Wt]=c.useState(null),[On,at]=c.useState(!1),[$e,rt]=c.useState(null),[Fn,Pn]=c.useState(!1),[Hn,ul]=c.useState(null),[Ln,rs]=c.useState(!1),[ml,Un]=c.useState(!1),[Wn,ls]=c.useState(!1),[zn,Vn]=c.useState(null),zt=c.useRef(!1),Vt=c.useRef(!1),[os,cs]=c.useState(null),[Ct,Zt]=c.useState({}),{references:H,metadata:hl}=na(),{toast:le}=ia(),{query:Ge}=u({id:_?s:void 0}),Re=d(),K=(gs=Ge==null?void 0:Ge.data)==null?void 0:gs.rate_sheet,Zn=Ge==null?void 0:Ge.isLoading,Be=c.useMemo(()=>{const o=(H==null?void 0:H.carriers)||{},m=(H==null?void 0:H.ratesheets)||{};return Object.entries(o).filter(([g])=>m[g]).map(([g,x])=>({id:g,name:String(x)}))},[H==null?void 0:H.carriers,H==null?void 0:H.ratesheets]),ds=c.useMemo(()=>{const o=(H==null?void 0:H.countries)||{};return Object.entries(o).map(([m,g])=>({value:m.toUpperCase(),label:String(g)})).sort((m,g)=>m.label.localeCompare(g.label))},[H==null?void 0:H.countries]),Gn=Os,Bn=Fs,qn=Ps,Kn=((fs=T[0])==null?void 0:fs.currency)??"USD",qe=((ps=T[0])==null?void 0:ps.weight_unit)??"KG",Yn=((_s=T[0])==null?void 0:_s.dimension_unit)??"CM",Gt=(K==null?void 0:K.carriers)??[],Bt=c.useMemo(()=>{var m,g;if(!h||!((g=(m=H==null?void 0:H.ratesheets)==null?void 0:m[h])!=null&&g.services))return[];const o=new Set(T.map(x=>x.service_code));return H.ratesheets[h].services.filter(x=>!o.has(x.service_code)).map(x=>({code:x.service_code,name:x.service_name})).sort((x,v)=>x.name.localeCompare(v.name))},[h,H==null?void 0:H.ratesheets,T]);c.useMemo(()=>{var m,g;if(!h||!((g=(m=H==null?void 0:H.ratesheets)==null?void 0:m[h])!=null&&g.zones))return[];const o=new Set(I.map(x=>x.label));return H.ratesheets[h].zones.filter(x=>x.label&&!o.has(x.label)).map(x=>({id:x.id,label:x.label,countries:(x.country_codes||[]).length})).sort((x,v)=>x.label.localeCompare(v.label))},[h,H==null?void 0:H.ratesheets,I]);const Qn=c.useMemo(()=>{var m,g;if(!h||!((g=(m=H==null?void 0:H.ratesheets)==null?void 0:m[h])!=null&&g.surcharges))return[];const o=new Set(V.map(x=>x.name));return H.ratesheets[h].surcharges.filter(x=>x.name&&!o.has(x.name)).map(x=>({id:x.id,name:x.name,amount:x.amount,surcharge_type:x.surcharge_type})).sort((x,v)=>x.name.localeCompare(v.name))},[h,H==null?void 0:H.ratesheets,V]),lt=_&&Zn&&!K;c.useEffect(()=>{T.length>0?Q&&T.some(m=>m.id===Q)||Lt(T[0].id):Lt(null)},[T]),c.useEffect(()=>{R!==null&&B(null)},[K==null?void 0:K.service_rates]),c.useEffect(()=>{if(K&&_){y(K.carrier_name||""),b(K.name||""),$(K.origin_countries||[]);const o=K.zones||[],m=K.service_rates||[],g=K.services||[],x=new Map(o.map(M=>[M.id,M])),v=new Map(m.map(M=>[`${M.service_id}:${M.zone_id}`,M])),j=new Set,U=g.map(M=>{const be=(M.zone_ids||[]).map((Ce,Yt)=>{const q=x.get(Ce),re=v.get(`${M.id}:${Ce}`);return j.add(Ce),{id:Ce,label:(q==null?void 0:q.label)||`Zone ${Yt+1}`,rate:(re==null?void 0:re.rate)??0,cost:(re==null?void 0:re.cost)??null,min_weight:(re==null?void 0:re.min_weight)??(q==null?void 0:q.min_weight)??null,max_weight:(re==null?void 0:re.max_weight)??(q==null?void 0:q.max_weight)??null,weight_unit:(q==null?void 0:q.weight_unit)??null,transit_days:(re==null?void 0:re.transit_days)??(q==null?void 0:q.transit_days)??null,transit_time:(re==null?void 0:re.transit_time)??(q==null?void 0:q.transit_time)??null,country_codes:(q==null?void 0:q.country_codes)||[],postal_codes:(q==null?void 0:q.postal_codes)||[],cities:(q==null?void 0:q.cities)||[]}}),X=M.features;return{...M,zones:be,features:es(M.features),first_mile:(X==null?void 0:X.first_mile)||"",last_mile:(X==null?void 0:X.last_mile)||"",form_factor:(X==null?void 0:X.form_factor)||"",age_check:(X==null?void 0:X.age_check)||""}}),F=o.map(M=>({id:M.id,label:M.label||"",rate:0,cost:null,min_weight:M.min_weight??null,max_weight:M.max_weight??null,weight_unit:M.weight_unit??null,transit_days:M.transit_days??null,transit_time:M.transit_time??null,country_codes:M.country_codes||[],postal_codes:M.postal_codes||[],cities:M.cities||[]}));E(U),C(F),Z(K.surcharges||[]);const k=new Map;o.forEach(M=>{k.set(M.id,{id:M.id,label:M.label||"",rate:0,country_codes:M.country_codes||[],postal_codes:M.postal_codes||[],cities:M.cities||[],transit_days:M.transit_days??null,transit_time:M.transit_time??null})});const L=new Map;(K.surcharges||[]).forEach(M=>{L.set(M.id,{...M})});const J=new Map;m.forEach(M=>{J.set(`${M.service_id}:${M.zone_id}`,{rate:M.rate,cost:M.cost})});const N=new Map,ee=new Map;g.forEach(M=>{N.set(M.id,[...M.zone_ids||[]]),ee.set(M.id,[...M.surcharge_ids||[]])}),O.current={name:K.name||"",zones:k,surcharges:L,serviceRates:J,serviceZoneIds:N,serviceSurchargeIds:ee}}},[K,_]),c.useEffect(()=>{if(!_){if(t){y(t);const o=Be.find(m=>m.id===t);o&&b(`${o.name} - sheet`)}else y(""),b("");$([]),E([]),C([]),Z([]),f([]),O.current=null}},[_,t,Be]);const us=c.useRef("");c.useEffect(()=>{var o,m;if(!_&&h){const g=Be.find(x=>x.id===h);if(g&&b(`${g.name} - sheet`),us.current!==h){const x=(o=H==null?void 0:H.ratesheets)==null?void 0:o[h];if(((m=x==null?void 0:x.services)==null?void 0:m.length)>0){const{zones:v,services:j,surcharges:U,service_rates:F}=x,k=new Map((v||[]).map(A=>[A.id,A])),L=new Map;for(const A of F||[]){const be=`${A.service_id}:${A.zone_id}:${A.min_weight??0}:${A.max_weight??0}`;L.set(be,{rate:A.rate??0,cost:A.cost??null})}const J=(v||[]).map(A=>({id:A.id,label:A.label||"",rate:0,cost:null,min_weight:A.min_weight??null,max_weight:A.max_weight??null,weight_unit:A.weight_unit??null,transit_days:A.transit_days??null,transit_time:A.transit_time??null,country_codes:A.country_codes||[],postal_codes:A.postal_codes||[],cities:A.cities||[]})),N=(U||[]).map(A=>({id:A.id||ke("surcharge"),name:A.name||"",amount:A.amount??0,surcharge_type:A.surcharge_type||"fixed",cost:A.cost??null,active:A.active??!0})),ee=[],M=j.map(A=>{const be=ke("service"),X=A.id,Ce=A.zone_ids||[],Yt=Ce.map((q,re)=>{const Oe=k.get(q)||{label:`Zone ${re+1}`},Ke=L.get(`${X}:${q}:0:0`);return{id:q,label:Oe.label||`Zone ${re+1}`,rate:(Ke==null?void 0:Ke.rate)??0,cost:(Ke==null?void 0:Ke.cost)??null,min_weight:Oe.min_weight??null,max_weight:Oe.max_weight??null,weight_unit:Oe.weight_unit??null,transit_days:Oe.transit_days??null,transit_time:Oe.transit_time??null,country_codes:Oe.country_codes||[],postal_codes:Oe.postal_codes||[],cities:Oe.cities||[]}});for(const q of F||[])String(q.service_id)===String(X)&&ee.push({service_id:be,zone_id:q.zone_id,rate:q.rate??0,cost:q.cost??null,min_weight:q.min_weight??null,max_weight:q.max_weight??null});return{id:be,object_type:"service_level",service_name:A.service_name||"",service_code:A.service_code||"",carrier_service_code:A.carrier_service_code??null,description:A.description??null,active:A.active??!0,currency:A.currency??"USD",transit_days:A.transit_days??null,transit_time:A.transit_time??null,max_width:A.max_width??null,max_height:A.max_height??null,max_length:A.max_length??null,dimension_unit:A.dimension_unit??null,max_weight:A.max_weight??null,weight_unit:A.weight_unit??null,domicile:A.domicile??null,international:A.international??null,zones:Yt,zone_ids:Ce,surcharge_ids:A.surcharge_ids||[],features:es(A.features),...A.features?{first_mile:A.features.first_mile||"",last_mile:A.features.last_mile||"",form_factor:A.features.form_factor||"",age_check:A.features.age_check||""}:{}}});E(M),C(J),Z(N),f(ee)}else E([]),C([]),Z([]),f([])}}us.current=h},[h,_,Be]);const ms=()=>{ve(null),me(!0)},hs=o=>{var J;if(!h||!((J=H==null?void 0:H.ratesheets)!=null&&J[h]))return;const m=H.ratesheets[h],g=(m.services||[]).find(N=>N.service_code===o);if(!g)return;const x=ke("service"),v=g.id,j=g.zone_ids||[],U=m.service_rates||[],F=j.map(N=>{const ee=I.find(A=>A.id===N);if(!ee)return null;const M=U.find(A=>String(A.service_id)===String(v)&&A.zone_id===N);return{...ee,rate:(M==null?void 0:M.rate)??0,cost:(M==null?void 0:M.cost)??null}}).filter(Boolean),k=U.filter(N=>String(N.service_id)===String(v)).map(N=>({service_id:x,zone_id:N.zone_id,rate:N.rate??0,cost:N.cost??null,min_weight:N.min_weight??null,max_weight:N.max_weight??null})),L={id:x,object_type:"service_level",service_name:g.service_name||"",service_code:g.service_code||"",carrier_service_code:g.carrier_service_code??null,description:g.description??null,active:g.active??!0,currency:g.currency??"USD",transit_days:g.transit_days??null,transit_time:g.transit_time??null,max_width:g.max_width??null,max_height:g.max_height??null,max_length:g.max_length??null,dimension_unit:g.dimension_unit??null,max_weight:g.max_weight??null,weight_unit:g.weight_unit??null,domicile:g.domicile??null,international:g.international??null,zones:F,zone_ids:j,surcharge_ids:g.surcharge_ids||[],features:es(g.features),...g.features?{first_mile:g.features.first_mile||"",last_mile:g.features.last_mile||"",form_factor:g.features.form_factor||"",age_check:g.features.age_check||""}:{}};E(N=>[...N,L]),f(N=>[...N,...k]),Un(!1)},Xn=o=>{var v;if(!h||!((v=H==null?void 0:H.ratesheets)!=null&&v[h]))return;const g=(H.ratesheets[h].surcharges||[]).find(j=>j.id===o);if(!g)return;const x={id:ke("surcharge"),name:g.name||"",amount:g.amount??0,surcharge_type:g.surcharge_type||"fixed",active:!0,cost:g.cost??null};rt(x),at(!0)},Jn=o=>{const m={...o,id:ke("surcharge"),name:`${o.name} (copy)`};rt(m),at(!0)},xs=o=>{const m=ke("service"),g={...o,id:m,service_name:`${o.service_name} (copy)`};E(v=>[...v,g]);const x=r.filter(v=>v.service_id===o.id).map(v=>({...v,service_id:m}));f(v=>[...v,...x]),ve(g),me(!0)},ei=o=>{ve(o),me(!0)},ti=o=>{if(Ne)E(m=>m.map(g=>g.service_code===Ne.service_code?{...g,...o}:g));else{const m={id:ke("service"),object_type:"service_level",service_name:o.service_name||"",service_code:o.service_code||"",currency:o.currency??"USD",carrier_service_code:o.carrier_service_code??null,description:o.description??null,transit_days:o.transit_days??null,transit_time:null,zones:[{id:ke("zone"),rate:0,label:"Zone 1",min_weight:null,max_weight:null,weight_unit:null,transit_days:null,transit_time:null,cities:[],postal_codes:[],country_codes:[]}],active:o.active??!0,domicile:o.domicile??null,international:o.international??null,max_weight:o.max_weight??null,weight_unit:o.weight_unit??null,max_width:o.max_width??null,max_height:o.max_height??null,max_length:o.max_length??null,dimension_unit:o.dimension_unit??null,features:o.features??[]};E(g=>[...g,m])}me(!1),ve(null)},si=o=>{ae(o),he(!0)},ni=async()=>{if(ne){if(ne.id&&!ne.id.startsWith("temp-")&&s&&Re.deleteRateSheetService){D(!0);try{await Re.deleteRateSheetService.mutateAsync({rate_sheet_id:s,service_id:ne.id}),le({title:"Service deleted",description:"Service has been removed from the rate sheet"})}catch{le({title:"Failed to delete service",description:"An error occurred while deleting the service",variant:"destructive"}),ae(null),he(!1),D(!1);return}finally{D(!1)}}E(m=>m.filter(g=>g.service_code!==ne.service_code)),ae(null),he(!1)}},ii=()=>{const o=new Set;return I.filter(m=>m.label).forEach(m=>o.add(m.label)),T.flatMap(m=>m.zones||[]).filter(m=>m.label).forEach(m=>o.add(m.label)),o},ai=(o,m)=>{const g=I.find(x=>x.id===m);g&&E(x=>x.map(v=>{if(v.id!==o)return v;const j=v.zone_ids||[];return j.includes(m)?v:{...v,zones:[...v.zones||[],g],zone_ids:[...j,m]}}))},ri=o=>{const m=ii();let g=1;for(;m.has(`Zone ${g}`);)g++;const x={id:ke("zone"),rate:0,label:`Zone ${g}`,min_weight:null,max_weight:null,weight_unit:null,transit_days:null,transit_time:null,cities:[],postal_codes:[],country_codes:[]};cs(o),Wt(x),Ut(!0)},li=(o,m)=>{E(g=>g.map(x=>x.id!==o?x:{...x,zones:(x.zones||[]).filter(v=>v.id!==m),zone_ids:(x.zone_ids||[]).filter(v=>v!==m)}))},oi=(o,m)=>{o&&(C(g=>g.map(x=>(x.label||x.id)===o?{...x,...m}:x)),E(g=>g.map(x=>{const v=(x.zones||[]).map(j=>(j.label||j.id)===o?{...j,...m}:j);return{...x,zones:v}})))},ci=o=>{Ie(o),He(!0)},di=()=>{Ae!==null&&(C(o=>o.filter(m=>(m.label||m.id)!==Ae)),E(o=>o.map(m=>({...m,zones:(m.zones||[]).filter(g=>(g.label||g.id)!==Ae)}))),Ie(null),He(!1))},ui=o=>{Wt(o),Ut(!0)},mi=o=>{rt(o),at(!0)},hi=(o,m)=>{zt.current=!0;const g=fe&&I.some(x=>x.id===fe.id);if(fe&&g)oi(o,m);else if(fe){const x={...fe,...m};C(v=>v.some(j=>j.id===x.id)?v:[...v,x]),os&&E(v=>v.map(j=>{if(j.id!==os)return j;const U=j.zone_ids||[];return U.includes(x.id)?j:{...j,zones:[...j.zones||[],x],zone_ids:[...U,x.id]}}))}},xi=(o,m)=>{Vt.current=!0;const g=$e&&V.some(x=>x.id===$e.id);if($e&&g)_i(o,m);else if($e){const x={...$e,...m};Z(v=>v.some(j=>j.id===x.id)?v:[...v,x])}},gi=async o=>{if(_)try{await Re.updateServiceRate.mutateAsync({rate_sheet_id:s,service_id:o.service_id,zone_id:o.zone_id,rate:o.rate,cost:o.cost,min_weight:o.min_weight??0,max_weight:o.max_weight??0,transit_days:o.transit_days,transit_time:o.transit_time})}catch(m){le({title:"Failed to update rate",description:m==null?void 0:m.message,variant:"destructive"})}},fi=(o,m,g)=>{E(x=>x.map(v=>{if(v.id!==o)return v;const j=v.zones||[],U=v.zone_ids||[];if(g){const F=I.find(k=>k.id===m)||T.flatMap(k=>k.zones||[]).find(k=>k.id===m)||((fe==null?void 0:fe.id)===m?fe:void 0);return!F||U.includes(m)?v:{...v,zones:[...j,F],zone_ids:[...U,m]}}else return{...v,zones:j.filter(F=>F.id!==m),zone_ids:U.filter(F=>F!==m)}}))},pi=()=>{const o={id:ke("surcharge"),name:"",amount:0,surcharge_type:"fixed",active:!0,cost:null};rt(o),at(!0)},_i=(o,m)=>{Z(g=>g.map(x=>x.id===o?{...x,...m}:x))},vi=o=>{Z(m=>m.filter(g=>g.id!==o))},bi=(o,m,g)=>{E(x=>x.map(v=>{if(v.id!==o)return v;const j=v.surcharge_ids||[],U=g?[...j,m]:j.filter(F=>F!==m);return{...v,surcharge_ids:U}}))},De=c.useMemo(()=>_?R??(K==null?void 0:K.service_rates)??[]:r,[_,R,K==null?void 0:K.service_rates,r]),Le=c.useMemo(()=>Vr(De),[De]),yi=c.useMemo(()=>{var j,U;if(!h||!((U=(j=H==null?void 0:H.ratesheets)==null?void 0:j[h])!=null&&U.service_rates))return[];const o=H.ratesheets[h].service_rates,m=new Set(Le.map(F=>`${F.min_weight}:${F.max_weight}`)),g=Q?Ct[Q]||[]:[];for(const F of g)m.add(`${F.min_weight}:${F.max_weight}`);const x=new Set,v=[];for(const F of o){if(F.min_weight==null||F.max_weight==null)continue;const k=`${F.min_weight}:${F.max_weight}`;x.has(k)||m.has(k)||(x.add(k),v.push({min_weight:F.min_weight,max_weight:F.max_weight}))}return v.sort((F,k)=>F.min_weight-k.min_weight||F.max_weight-k.max_weight)},[h,H==null?void 0:H.ratesheets,Le,Q,Ct]),qt=c.useCallback(o=>{const m=De.filter(j=>j.service_id===o),g=new Set,x=[];for(const j of m){const U=j.min_weight??0,F=j.max_weight??0;if(U===0&&F===0)continue;const k=`${U}:${F}`;g.has(k)||(g.add(k),x.push({min_weight:U,max_weight:F}))}const v=Ct[o]||[];for(const j of v){const U=`${j.min_weight}:${j.max_weight}`;g.has(U)||(g.add(U),x.push(j))}return x.sort((j,U)=>j.min_weight-U.min_weight)},[De,Ct]),ji=c.useCallback(o=>{const m=qt(o),g=new Set(m.map(x=>`${x.min_weight}:${x.max_weight}`));return Le.filter(x=>!g.has(`${x.min_weight}:${x.max_weight}`))},[Le,qt]),wi=o=>{Vn(o),ls(!0)},Si=(o,m,g)=>{if(_&&s&&Q)if(De.some(v=>v.min_weight===o&&v.max_weight===m)){const v=De.filter(j=>j.service_id===Q&&j.min_weight===o&&j.max_weight===m);B(j=>(j??(K==null?void 0:K.service_rates)??[]).map(F=>F.service_id===Q&&F.min_weight===o&&F.max_weight===m?{...F,max_weight:g}:F)),Promise.all(v.map(j=>Re.deleteServiceRate.mutateAsync({rate_sheet_id:s,service_id:j.service_id,zone_id:j.zone_id,min_weight:j.min_weight,max_weight:j.max_weight}))).then(()=>Promise.all(v.map(j=>Re.updateServiceRate.mutateAsync({rate_sheet_id:s,service_id:j.service_id,zone_id:j.zone_id,rate:j.rate??0,min_weight:o,max_weight:g})))).then(()=>{le({title:"Weight range updated",variant:"default"})}).catch(j=>{le({title:"Failed to update weight range",description:j==null?void 0:j.message,variant:"destructive"}),B(null)})}else Zt(v=>{const j={...v};for(const[U,F]of Object.entries(j))j[U]=F.map(k=>k.min_weight===o&&k.max_weight===m?{...k,max_weight:g}:k);return j}),le({title:"Weight range updated",variant:"default"});else f(x=>x.map(v=>v.min_weight===o&&v.max_weight===m?{...v,max_weight:g}:v)),le({title:"Weight range updated",variant:"default"})},Kt=async(o,m)=>{if(_&&s){if(!Q)return;Zt(g=>{const x=g[Q]||[];return x.some(j=>j.min_weight===o&&j.max_weight===m)?g:{...g,[Q]:[...x,{min_weight:o,max_weight:m}]}}),le({title:"Weight range added",variant:"default"})}else{const g=T.find(x=>x.id===Q);if(g){const v=(g.zone_ids||[]).map(j=>({service_id:g.id,zone_id:j,rate:0,min_weight:o,max_weight:m}));v.length>0&&f(j=>[...j,...v])}le({title:"Weight range added",variant:"default"})}},Ei=(o,m)=>{Nt({min_weight:o,max_weight:m}),nt(!0)},Ni=()=>{if(Me)if(_&&s){const{min_weight:o,max_weight:m}=Me;if(De.some(x=>x.service_id===Q&&x.min_weight===o&&x.max_weight===m)){const x=De.filter(v=>v.service_id===Q&&v.min_weight===o&&v.max_weight===m);B(v=>(v??(K==null?void 0:K.service_rates)??[]).filter(U=>!(U.service_id===Q&&U.min_weight===o&&U.max_weight===m))),nt(!1),Nt(null),Promise.all(x.map(v=>Re.deleteServiceRate.mutateAsync({rate_sheet_id:s,service_id:v.service_id,zone_id:v.zone_id,min_weight:v.min_weight,max_weight:v.max_weight}))).then(()=>{le({title:"Weight range removed",variant:"default"})}).catch(v=>{le({title:"Failed to remove weight range",description:v==null?void 0:v.message,variant:"destructive"}),B(null)})}else Zt(x=>{if(!Q)return x;const v=x[Q]||[];return{...x,[Q]:v.filter(j=>!(j.min_weight===o&&j.max_weight===m))}}),nt(!1),Nt(null),le({title:"Weight range removed",variant:"default"})}else{const{min_weight:o,max_weight:m}=Me;f(g=>g.filter(x=>!(x.service_id===Q&&x.min_weight===o&&x.max_weight===m))),nt(!1),Nt(null),le({title:"Weight range removed",variant:"default"})}},Ci=(o,m,g,x)=>{_&&s?(B(v=>(v??(K==null?void 0:K.service_rates)??[]).filter(U=>!(U.service_id===o&&U.zone_id===m&&U.min_weight===g&&U.max_weight===x))),Re.deleteServiceRate.mutate({rate_sheet_id:s,service_id:o,zone_id:m,min_weight:g,max_weight:x},{onError:v=>{le({title:"Failed to delete rate",description:v==null?void 0:v.message,variant:"destructive"}),B(null)}})):f(v=>v.filter(j=>!(j.service_id===o&&j.zone_id===m&&j.min_weight===g&&j.max_weight===x)))},Ai=(o,m,g,x,v)=>{_&&s?(B(j=>{const U=j??(K==null?void 0:K.service_rates)??[],F=U.findIndex(k=>k.service_id===o&&k.zone_id===m&&k.min_weight===g&&k.max_weight===x);if(F>=0){const k=[...U];return k[F]={...k[F],rate:v},k}return[...U,{service_id:o,zone_id:m,rate:v,min_weight:g,max_weight:x}]}),Re.updateServiceRate.mutate({rate_sheet_id:s,service_id:o,zone_id:m,rate:v,min_weight:g,max_weight:x},{onError:j=>{le({title:"Failed to update rate",description:j==null?void 0:j.message,variant:"destructive"})}})):f(j=>{const U=j.findIndex(F=>F.service_id===o&&F.zone_id===m&&F.min_weight===g&&F.max_weight===x);if(U>=0){const F=[...j];return F[U]={...F[U],rate:v},F}return[...j,{service_id:o,zone_id:m,rate:v,min_weight:g,max_weight:x}]})},Ri=()=>{const o=[];return w.trim()||o.push("Rate sheet name is required"),h||o.push("Carrier is required"),T.length===0&&o.push("At least one service is required"),{isValid:o.length===0,errors:o}},Di=async()=>{const o=Ri();if(!o.isValid){le({title:"Validation Error",description:o.errors.join(", "),variant:"destructive"});return}P(!0);try{const g=(()=>{const k=new Map;let L=0;return I.forEach(J=>{var ee;const N=J.label||`Zone ${L+1}`;if(!k.has(N)){const M=(ee=J.id)!=null&&ee.startsWith("temp-")?`zone_${L}`:J.id||`zone_${L}`;k.set(N,{id:M,label:N,country_codes:J.country_codes||[],postal_codes:J.postal_codes||[],cities:J.cities||[],transit_days:J.transit_days??null,transit_time:J.transit_time??null,min_weight:J.min_weight??null,max_weight:J.max_weight??null,weight_unit:J.weight_unit??null}),L++}}),T.forEach(J=>{(J.zones||[]).forEach(N=>{var M;const ee=N.label||`Zone ${L+1}`;if(!k.has(ee)){const A=(M=N.id)!=null&&M.startsWith("temp-")?`zone_${L}`:N.id||`zone_${L}`;k.set(ee,{id:A,label:ee,country_codes:N.country_codes||[],postal_codes:N.postal_codes||[],cities:N.cities||[],transit_days:N.transit_days??null,transit_time:N.transit_time??null,min_weight:N.min_weight??null,max_weight:N.max_weight??null,weight_unit:N.weight_unit??null}),L++}})}),k})(),x=new Map;g.forEach((k,L)=>x.set(L,k.id));const v=Array.from(g.values()).map(k=>({id:k.id,label:k.label,country_codes:k.country_codes.length>0?k.country_codes:void 0,postal_codes:k.postal_codes.length>0?k.postal_codes:void 0,cities:k.cities.length>0?k.cities:void 0,transit_days:k.transit_days,transit_time:k.transit_time,min_weight:k.min_weight,max_weight:k.max_weight,weight_unit:k.weight_unit})),j=[],U=new Map,F=V.map((k,L)=>{var N;const J=(N=k.id)!=null&&N.startsWith("temp-")?`surcharge_${L}`:k.id||`surcharge_${L}`;return U.set(k.id,J),{id:J,name:k.name||"",amount:k.amount||0,surcharge_type:k.surcharge_type||"fixed",cost:k.cost??null,active:k.active??!0}});if(_){const k=T.map((L,J)=>{var A,be;const N=(A=L.id)!=null&&A.startsWith("temp-")?`temp-${J}`:L.id,ee=(L.zones||[]).map(X=>x.get(X.label||"")).filter(Boolean);(L.zones||[]).forEach(X=>{const Ce=x.get(X.label||"");Ce&&j.push({service_id:N,zone_id:Ce,rate:X.rate||0,cost:X.cost??null,min_weight:X.min_weight??null,max_weight:X.max_weight??null,transit_days:X.transit_days??null,transit_time:X.transit_time??null})});const M=(L.surcharge_ids||[]).map(X=>U.get(X)||X).filter(X=>F.some(Ce=>Ce.id===X));return{id:(be=L.id)!=null&&be.startsWith("temp-")?null:L.id,service_name:L.service_name||"",service_code:L.service_code||"",currency:L.currency||"USD",carrier_service_code:L.carrier_service_code,description:L.description,active:L.active,transit_days:L.transit_days,transit_time:L.transit_time,max_width:L.max_width,max_height:L.max_height,max_length:L.max_length,dimension_unit:L.dimension_unit,max_weight:L.max_weight,weight_unit:L.weight_unit,domicile:L.domicile,international:L.international,use_volumetric:L.use_volumetric,dim_factor:L.dim_factor,zone_ids:ee,surcharge_ids:M,features:Is(L.features)}});await Re.updateRateSheet.mutateAsync({id:s,name:w,origin_countries:S,services:k,zones:v,surcharges:F,service_rates:j}),le({title:"Rate sheet updated",description:`"${w}" has been updated successfully`})}else{const k=new Map;T.forEach((N,ee)=>k.set(N.id,`temp-${ee}`));const L=new Map;I.forEach(N=>{const ee=x.get(N.label||"");ee&&L.set(N.id,ee)});for(const N of r){const ee=k.get(N.service_id),M=L.get(N.zone_id);ee&&M&&j.push({service_id:ee,zone_id:M,rate:N.rate,cost:N.cost??null,min_weight:N.min_weight??null,max_weight:N.max_weight??null})}const J=T.map(N=>{const ee=(N.zone_ids||[]).map(A=>L.get(A)||A).filter(A=>v.some(be=>be.id===A)),M=(N.surcharge_ids||[]).map(A=>U.get(A)||A).filter(A=>F.some(be=>be.id===A));return{service_name:N.service_name||"",service_code:N.service_code||"",currency:N.currency||"USD",carrier_service_code:N.carrier_service_code,description:N.description,active:N.active,transit_days:N.transit_days,transit_time:N.transit_time,max_width:N.max_width,max_height:N.max_height,max_length:N.max_length,dimension_unit:N.dimension_unit,max_weight:N.max_weight,weight_unit:N.weight_unit,domicile:N.domicile,international:N.international,use_volumetric:N.use_volumetric,dim_factor:N.dim_factor,zone_ids:ee,surcharge_ids:M,features:Is(N.features)}});await Re.createRateSheet.mutateAsync({name:w,carrier_name:h,origin_countries:S,services:J,zones:v,surcharges:F,service_rates:j}),le({title:"Rate sheet created",description:`"${w}" has been created successfully`})}i()}catch(m){le({title:_?"Failed to update rate sheet":"Failed to create rate sheet",description:(m==null?void 0:m.message)||"An unexpected error occurred",variant:"destructive"})}finally{P(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(Hs,{open:!0,onOpenChange:()=>i(),children:e.jsxs(Ls,{side:"right",className:"w-full sm:max-w-full p-0",hideCloseButton:!0,children:[e.jsx(Us,{className:"px-4 sm:px-6 py-4 border-b border-border bg-background",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("button",{onClick:()=>as(!it),className:"lg:hidden p-2 -ml-2 text-muted-foreground hover:text-foreground hover:bg-accent rounded-md","aria-label":it?"Close settings":"Open settings",disabled:lt,children:it?e.jsx(tt,{className:"h-5 w-5"}):e.jsx(aa,{className:"h-5 w-5"})}),e.jsx(Ws,{className:"text-lg sm:text-xl font-semibold flex-1",children:lt?"Loading...":_?"Edit Rate Sheet":"Create Rate Sheet"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{onClick:Di,disabled:z||lt,children:z?e.jsxs(e.Fragment,{children:[e.jsx(kt,{className:"h-4 w-4 animate-spin mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Saving..."})]}):"Save"}),e.jsx("button",{onClick:()=>rs(!0),className:"p-2 rounded-md text-muted-foreground hover:text-foreground hover:bg-accent transition-colors","aria-label":"Preview as spreadsheet",title:"Preview as spreadsheet",disabled:lt,children:e.jsx(ra,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>i(),className:"p-2 rounded-md text-muted-foreground hover:text-foreground hover:bg-accent transition-colors","aria-label":"Close",children:e.jsx(tt,{className:"h-5 w-5"})})]})]})}),lt?e.jsxs("div",{className:"flex h-[calc(100vh-73px)] flex-col items-center justify-center gap-3 text-muted-foreground",children:[e.jsx(kt,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm",children:"Loading rate sheet..."})]}):e.jsxs("div",{className:"flex h-[calc(100vh-73px)] overflow-hidden relative",children:[it&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:()=>as(!1)}),e.jsx("div",{className:se("fixed lg:relative inset-y-0 left-0 z-50 lg:z-auto","w-full lg:w-80 border-r border-border bg-background lg:bg-muted/30 overflow-y-auto","transform transition-transform duration-200 ease-in-out lg:transform-none","top-[73px] lg:top-0 h-[calc(100vh-73px)]",it?"translate-x-0":"-translate-x-full lg:translate-x-0"),children:e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs(W,{className:"mb-2 block",children:["Carrier ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(ye,{value:h,onValueChange:y,disabled:_,children:[e.jsx(je,{className:"w-full",children:e.jsx(we,{placeholder:"Select a carrier"})}),e.jsx(Se,{className:"z-[100]",children:Be.length>0?Be.map(o=>e.jsx(Ee,{value:o.id,children:o.name},o.id)):e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"No carriers available"})})]})]}),e.jsxs("div",{children:[e.jsxs(W,{className:"mb-2 block",children:["Rate Sheet Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{value:w,onChange:o=>b(o.target.value),placeholder:"e.g., Standard Rates 2024"})]}),_&&Gt.length>0&&e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Connected Carriers"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",Gt.length,")"]})]})}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-1 pb-1",children:Gt.map(o=>e.jsx("div",{className:"p-3 bg-background border border-border rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:o.display_name||o.carrier_id}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:o.carrier_id})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${o.active?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:o.active?"Active":"Inactive"}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${o.test_mode?"bg-yellow-100 text-yellow-700":"bg-blue-100 text-blue-700"}`,children:o.test_mode?"Test":"Live"})]})]})},o.id))})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-border",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Default Settings"}),e.jsxs("div",{children:[e.jsx(W,{className:"text-xs mb-1 block",children:"Currency"}),e.jsxs(ye,{value:Kn,onValueChange:o=>{E(m=>m.map(g=>({...g,currency:o})))},disabled:T.length===0,children:[e.jsx(je,{className:"w-full",children:e.jsx(we,{placeholder:"Select currency"})}),e.jsx(Se,{className:"z-[100] max-h-60",children:Gn.map(o=>e.jsx(Ee,{value:o,children:o},o))})]})]}),e.jsxs("div",{children:[e.jsx(W,{className:"text-xs mb-1 block",children:"Origin Countries"}),e.jsx(Ht,{options:ds,value:S,onValueChange:$,placeholder:"Select countries..."})]}),e.jsxs("div",{children:[e.jsx(W,{className:"text-xs mb-1 block",children:"Weight Unit"}),e.jsxs(ye,{value:qe,onValueChange:o=>{E(m=>m.map(g=>({...g,weight_unit:o})))},disabled:T.length===0,children:[e.jsx(je,{className:"w-full",children:e.jsx(we,{placeholder:"Select weight unit"})}),e.jsx(Se,{className:"z-[100]",children:Bn.map(o=>e.jsx(Ee,{value:o,children:o},o))})]})]}),e.jsxs("div",{children:[e.jsx(W,{className:"text-xs mb-1 block",children:"Dimension Unit"}),e.jsxs(ye,{value:Yn,onValueChange:o=>{E(m=>m.map(g=>({...g,dimension_unit:o})))},disabled:T.length===0,children:[e.jsx(je,{className:"w-full",children:e.jsx(we,{placeholder:"Select dimension unit"})}),e.jsx(Se,{className:"z-[100]",children:qn.map(o=>e.jsx(Ee,{value:o,children:o},o))})]})]})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden bg-background w-full lg:w-auto",children:[e.jsx("div",{className:"border-b border-border px-4 sm:px-6 overflow-x-auto",children:e.jsx("div",{className:"flex items-center min-w-min",children:[{id:"rate_sheet",label:"Rate Sheet"},{id:"surcharges",label:"Surcharges"}].map(o=>e.jsx("button",{onClick:()=>Y(o.id),className:se("py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap px-4",G===o.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"),children:o.label},o.id))})}),e.jsxs("div",{className:"flex-1 p-4 sm:p-6 overflow-hidden",children:[G==="rate_sheet"&&e.jsxs("div",{className:"h-full flex flex-col",children:[T.length>0&&e.jsxs("div",{className:"flex items-center gap-1 mb-3 overflow-x-auto pb-1 border-b border-border",style:{scrollbarWidth:"none"},children:[T.map(o=>e.jsxs("button",{onClick:()=>Lt(o.id),className:se("px-3 py-1.5 text-xs font-medium rounded-md whitespace-nowrap transition-colors flex items-center gap-1.5 group/svc",Q===o.id?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-accent"),children:[o.service_name||o.service_code||"Unnamed",Q===o.id&&e.jsxs("span",{className:"flex items-center gap-0",children:[e.jsx("span",{className:"p-0.5 rounded-sm hover:bg-primary-foreground/20",onClick:m=>{m.stopPropagation(),ei(o)},title:"Edit service",children:e.jsx(Mt,{className:"h-3 w-3"})}),e.jsx("span",{className:"p-0.5 rounded-sm hover:bg-primary-foreground/20",onClick:m=>{m.stopPropagation(),si(o)},title:"Delete service",children:e.jsx($t,{className:"h-3 w-3"})})]})]},o.id)),e.jsx(Ts,{services:T,onAddService:ms,servicePresets:Bt,onAddServiceFromPreset:hs,onCloneService:xs,iconOnly:!0,align:"end"})]}),e.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[!_&&!h&&e.jsx("div",{className:"absolute inset-0 z-10 bg-background/80 backdrop-blur-[1px] flex items-center justify-center rounded-md",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a carrier to get started"})}),T.length===0?e.jsx("div",{className:"flex-1 flex items-center justify-center text-muted-foreground bg-muted/50 rounded border-2 border-dashed h-full",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-sm",children:"No services configured"}),e.jsx("div",{className:"mt-2",children:e.jsx(Ts,{services:T,onAddService:ms,servicePresets:Bt,onAddServiceFromPreset:hs,onCloneService:xs})})]})}):(()=>{const o=T.find(m=>m.id===Q);return o?e.jsx(Br,{service:o,sharedZones:I,serviceRates:De,weightRanges:Le,weightUnit:qe,onCellEdit:Ai,onDeleteRate:Ci,onAddWeightRange:()=>ie(!0),onRemoveWeightRange:Ei,onAssignZoneToService:ai,onCreateNewZone:ri,onRemoveZoneFromService:li,serviceFilteredWeightRanges:qt(o.id),onEditWeightRange:wi,onEditZone:ui,onDeleteZone:ci,missingRanges:ji(o.id),onAddMissingRange:Kt,weightRangePresets:yi,onAddFromPreset:Kt}):null})()]})]}),G==="surcharges"&&e.jsx(Qr,{surcharges:V,services:T,onEditSurcharge:mi,onAddSurcharge:pi,onRemoveSurcharge:vi,surchargePresets:Qn,onAddSurchargeFromPreset:Xn,onCloneSurcharge:Jn})]})]})]})]})}),e.jsx(kr,{isOpen:xe,onClose:()=>me(!1),service:Ne,onSubmit:ti,availableSurcharges:V,servicePresets:Bt}),e.jsx(Tt,{open:ge,onOpenChange:he,children:e.jsxs(ct,{children:[e.jsxs(dt,{children:[e.jsx(mt,{children:"Delete Service"}),e.jsxs(ht,{children:['Are you sure you want to delete "',ne==null?void 0:ne.service_name,'"? This action cannot be undone.']})]}),e.jsxs(ut,{children:[e.jsx(gt,{disabled:p,children:"Cancel"}),e.jsx(xt,{onClick:ni,disabled:p,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:p?e.jsxs(e.Fragment,{children:[e.jsx(kt,{className:"h-4 w-4 animate-spin mr-2"}),"Deleting..."]}):"Delete"})]})]})}),e.jsx(Tt,{open:Ze,onOpenChange:He,children:e.jsxs(ct,{children:[e.jsxs(dt,{children:[e.jsx(mt,{children:"Delete Zone"}),e.jsxs(ht,{children:['Are you sure you want to delete "',Ae,'"? This will remove it from all services. This action cannot be undone.']})]}),e.jsxs(ut,{children:[e.jsx(gt,{children:"Cancel"}),e.jsx(xt,{onClick:di,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(qr,{open:ue,onOpenChange:ie,existingRanges:Le,weightUnit:qe,onAdd:Kt}),e.jsx(Kr,{open:Wn,onOpenChange:ls,weightRange:zn,existingRanges:Le,weightUnit:qe,onSave:Si}),e.jsx(Tt,{open:Mn,onOpenChange:nt,children:e.jsxs(ct,{children:[e.jsxs(dt,{children:[e.jsx(mt,{children:"Remove Weight Range"}),e.jsxs(ht,{children:["Are you sure you want to remove the weight range"," ",(Me==null?void 0:Me.min_weight)??0," â€“"," ",(Me==null?void 0:Me.max_weight)??0,"? All rates in this range will be deleted."]})]}),e.jsxs(ut,{children:[e.jsx(gt,{children:"Cancel"}),e.jsx(xt,{onClick:Ni,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove"})]})]})}),e.jsx(Xr,{open:$n,onOpenChange:o=>{Ut(o),o||(!zt.current&&fe&&!I.some(m=>m.id===fe.id)&&E(m=>m.map(g=>({...g,zones:(g.zones||[]).filter(x=>x.id!==fe.id),zone_ids:(g.zone_ids||[]).filter(x=>x!==fe.id)}))),zt.current=!1,Wt(null),cs(null))},zone:fe,onSave:hi,countryOptions:ds,services:T,onToggleServiceZone:fi}),e.jsx(el,{open:On,onOpenChange:o=>{at(o),o||(!Vt.current&&$e&&!V.some(m=>m.id===$e.id)&&E(m=>m.map(g=>({...g,surcharge_ids:(g.surcharge_ids||[]).filter(x=>x!==$e.id)}))),Vt.current=!1,rt(null))},surcharge:$e,onSave:xi,services:T,onToggleServiceSurcharge:bi}),e.jsx(tl,{open:Fn,onOpenChange:Pn,serviceRate:Hn,onSave:gi,services:T,sharedZones:I,weightUnit:qe}),e.jsx(rl,{open:Ln,onOpenChange:rs,name:w,carrierName:h,originCountries:S,services:T,sharedZones:I,serviceRates:De,weightRanges:Le,surcharges:V,weightUnit:qe})]})};function ol({config:s}){const i=()=>{window.parent.postMessage({source:"karrio-embed",type:"EVENT",event:"close"},"*")};return e.jsx(oa,{host:s.host,token:s.token,admin:s.admin,children:e.jsxs(ca,{children:[e.jsx(ll,{rateSheetId:s.rateSheetId||"new",onClose:i,preloadCarrier:s.carrier,linkConnectionId:s.connectionId,isAdmin:s.admin,useRateSheet:Fa,useRateSheetMutation:Pa}),e.jsx(da,{})]})})}function cl(){const[s,i]=c.useState(null);return c.useEffect(()=>{const t=a=>{const{data:n}=a;(n==null?void 0:n.source)==="karrio-host"&&n.type==="INIT"&&i({host:n.host,token:n.token,rateSheetId:n.rateSheetId,carrier:n.carrier,connectionId:n.connectionId,admin:n.admin??!1})};return window.addEventListener("message",t),window.parent.postMessage({source:"karrio-embed",type:"READY"},"*"),()=>window.removeEventListener("message",t)},[]),c.useEffect(()=>{const t=new ResizeObserver(a=>{for(const n of a)window.parent.postMessage({source:"karrio-embed",type:"RESIZE",height:n.contentRect.height},"*")});return t.observe(document.body),()=>t.disconnect()},[]),s?e.jsx(ol,{config:s}):e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-400"})})}const dl=la(document.getElementById("root"));dl.render(e.jsx(cl,{}));
