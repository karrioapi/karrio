import{a1 as Ei,aj as as,a2 as ce,R as Te,b3 as Si,b8 as Ni,b9 as Ci,ba as Ri,bb as Ai,bc as ki,bd as Di,be as Ti,bf as Ii,bg as Oi,bh as Mi,bi as $i,bj as Pi,bk as Fi,bl as Hi,bm as Li,bn as Ui,bo as Wi,bp as zi,bq as Vi,o as le,n as oe,m as Zi,r as c,j as e,t as et,v as Gi,P as Fs,B as Bi,x as Hs,z as Ls,M as qi,H as Ki,y as ut,F as Yi,I as Qi,J as Xi,L as Ji,X as er,V as tr,Y as Ve,C as Ie,E as Us,W as sr,s as de,br as nr,a5 as pe,a8 as ws,au as Es,aO as ir,a6 as W,aa as ye,ab as je,ac as we,ad as Ee,ae as Se,a7 as te,bs as Ws,bt as zs,bu as Vs,bv as tt,aI as rr,bw as Fe,bx as $t,by as Pt,u as ar,aB as lr,bz as or,bA as cr}from"./globals-C95u6hwq.js";import{I as dr,J as ur,K as mr,M as hr,N as xr,Q as fr,V as gr,W as pr,X as _r,Y as vr,Z as br,_ as yr,$ as jr,a0 as wr,a1 as Er,a2 as Sr,a3 as Nr,a4 as Cr,a5 as Rr,R as Ar,P as kr,O as Dr,C as Tr,t as Ir,h as mt,k as ht,l as xt,m as ft,o as ze,x as gt,p as Or,q as Ss,r as Ns,s as Cs,A as Nt,a as Ct,b as Rt,c as At,d as kt,e as Dt,f as Tt,g as It,n as Ft,a6 as Ht,y as Zs,B as Gs,S as Bs,v as qs,L as Ot}from"./tooltip-s8H3r4o5.js";function Ks(){const{admin:s}=as();return{queries:s?{GET_RATE_SHEET:Rr,CREATE_RATE_SHEET:Cr,UPDATE_RATE_SHEET:Nr,DELETE_RATE_SHEET:Sr,DELETE_RATE_SHEET_SERVICE:Er,ADD_SHARED_ZONE:wr,UPDATE_SHARED_ZONE:jr,DELETE_SHARED_ZONE:yr,ADD_SHARED_SURCHARGE:br,UPDATE_SHARED_SURCHARGE:vr,DELETE_SHARED_SURCHARGE:_r,BATCH_UPDATE_SURCHARGES:pr,UPDATE_SERVICE_RATE:gr,BATCH_UPDATE_SERVICE_RATES:fr,UPDATE_SERVICE_ZONE_IDS:xr,UPDATE_SERVICE_SURCHARGE_IDS:hr,ADD_WEIGHT_RANGE:mr,REMOVE_WEIGHT_RANGE:ur,DELETE_SERVICE_RATE:dr}:{GET_RATE_SHEET:Vi,CREATE_RATE_SHEET:zi,UPDATE_RATE_SHEET:Wi,DELETE_RATE_SHEET:Ui,DELETE_RATE_SHEET_SERVICE:Li,ADD_SHARED_ZONE:Hi,UPDATE_SHARED_ZONE:Fi,DELETE_SHARED_ZONE:Pi,ADD_SHARED_SURCHARGE:$i,UPDATE_SHARED_SURCHARGE:Mi,DELETE_SHARED_SURCHARGE:Oi,BATCH_UPDATE_SURCHARGES:Ii,UPDATE_SERVICE_RATE:Ti,BATCH_UPDATE_SERVICE_RATES:Di,UPDATE_SERVICE_ZONE_IDS:ki,UPDATE_SERVICE_SURCHARGE_IDS:Ai,ADD_WEIGHT_RANGE:Ri,REMOVE_WEIGHT_RANGE:Ci,DELETE_SERVICE_RATE:Ni},wrapVars:i=>s?{variables:{input:i}}:{data:i},admin:s}}function xl({id:s}={}){const{graphqlRequest:r,admin:t}=as(),{queries:i}=Ks(),[n,o]=Te.useState(s||"new"),a=Si({queryKey:[t?"admin_rate_sheet":"rate-sheets",n],queryFn:()=>r(oe(i.GET_RATE_SHEET),{variables:{id:n}}),enabled:n!=="new",onError:le});function _(m){o(m)}return{query:a,rateSheetId:n,setRateSheetId:_}}function fl(){const s=Ei(),{graphqlRequest:r,admin:t}=as(),{queries:i,wrapVars:n}=Ks(),o=t?"admin_rate_sheet":"rate-sheets",u=()=>{s.invalidateQueries([o]),s.invalidateQueries(t?["admin_account_carrier_connections"]:["user-connections"])},a=ce($=>r(oe(i.CREATE_RATE_SHEET),n($)),{onSuccess:u,onError:le}),_=ce($=>r(oe(i.UPDATE_RATE_SHEET),n($)),{onSuccess:u,onError:le}),m=ce($=>r(oe(i.DELETE_RATE_SHEET),n($)),{onSuccess:u,onError:le}),y=ce($=>r(oe(i.DELETE_RATE_SHEET_SERVICE),n($)),{onSuccess:u,onError:le}),j=ce($=>r(oe(i.ADD_SHARED_ZONE),n($)),{onSuccess:u,onError:le}),v=ce($=>r(oe(i.UPDATE_SHARED_ZONE),n($)),{onSuccess:u,onError:le}),E=ce($=>r(oe(i.DELETE_SHARED_ZONE),n($)),{onSuccess:u,onError:le}),M=ce($=>r(oe(i.ADD_SHARED_SURCHARGE),n($)),{onSuccess:u,onError:le}),T=ce($=>r(oe(i.UPDATE_SHARED_SURCHARGE),n($)),{onSuccess:u,onError:le}),S=ce($=>r(oe(i.DELETE_SHARED_SURCHARGE),n($)),{onSuccess:u,onError:le}),V=ce($=>r(oe(i.BATCH_UPDATE_SURCHARGES),n($)),{onSuccess:u,onError:le}),Z=ce($=>r(oe(i.UPDATE_SERVICE_RATE),n($)),{onSuccess:u,onError:le}),I=ce($=>r(oe(i.BATCH_UPDATE_SERVICE_RATES),n($)),{onSuccess:u,onError:le}),C=ce($=>r(oe(i.ADD_WEIGHT_RANGE),n($)),{onSuccess:u,onError:le}),l=ce($=>r(oe(i.REMOVE_WEIGHT_RANGE),n($)),{onSuccess:u,onError:le}),g=ce($=>r(oe(i.DELETE_SERVICE_RATE),n($)),{onSuccess:u,onError:le}),A=ce($=>r(oe(i.UPDATE_SERVICE_ZONE_IDS),n($)),{onSuccess:u,onError:le}),B=ce($=>r(oe(i.UPDATE_SERVICE_SURCHARGE_IDS),n($)),{onSuccess:u,onError:le});return{createRateSheet:a,updateRateSheet:_,deleteRateSheet:m,deleteRateSheetService:y,addSharedZone:j,updateSharedZone:v,deleteSharedZone:E,addSharedSurcharge:M,updateSharedSurcharge:T,deleteSharedSurcharge:S,batchUpdateSurcharges:V,updateServiceRate:Z,batchUpdateServiceRates:I,addWeightRange:C,removeWeightRange:l,deleteServiceRate:g,updateServiceZoneIds:A,updateServiceSurchargeIds:B}}/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],$r=Zi("chevron-down",Mr);function Pr(s){const r=Fr(s),t=c.forwardRef((i,n)=>{const{children:o,...u}=i,a=c.Children.toArray(o),_=a.find(Lr);if(_){const m=_.props.children,y=a.map(j=>j===_?c.Children.count(m)>1?c.Children.only(null):c.isValidElement(m)?m.props.children:null:j);return e.jsx(r,{...u,ref:n,children:c.isValidElement(m)?c.cloneElement(m,void 0,y):null})}return e.jsx(r,{...u,ref:n,children:o})});return t.displayName=`${s}.Slot`,t}function Fr(s){const r=c.forwardRef((t,i)=>{const{children:n,...o}=t;if(c.isValidElement(n)){const u=Wr(n),a=Ur(o,n.props);return n.type!==c.Fragment&&(a.ref=i?et(i,u):u),c.cloneElement(n,a)}return c.Children.count(n)>1?c.Children.only(null):null});return r.displayName=`${s}.SlotClone`,r}var Hr=Symbol("radix.slottable");function Lr(s){return c.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===Hr}function Ur(s,r){const t={...r};for(const i in r){const n=s[i],o=r[i];/^on[A-Z]/.test(i)?n&&o?t[i]=(...a)=>{const _=o(...a);return n(...a),_}:n&&(t[i]=n):i==="style"?t[i]={...n,...o}:i==="className"&&(t[i]=[n,o].filter(Boolean).join(" "))}return{...s,...t}}function Wr(s){var i,n;let r=(i=Object.getOwnPropertyDescriptor(s.props,"ref"))==null?void 0:i.get,t=r&&"isReactWarning"in r&&r.isReactWarning;return t?s.ref:(r=(n=Object.getOwnPropertyDescriptor(s,"ref"))==null?void 0:n.get,t=r&&"isReactWarning"in r&&r.isReactWarning,t?s.props.ref:s.props.ref||s.ref)}var Lt="Popover",[Ys]=Gi(Lt,[Hs]),pt=Hs(),[zr,We]=Ys(Lt),Qs=s=>{const{__scopePopover:r,children:t,open:i,defaultOpen:n,onOpenChange:o,modal:u=!1}=s,a=pt(r),_=c.useRef(null),[m,y]=c.useState(!1),[j,v]=er({prop:i,defaultProp:n??!1,onChange:o,caller:Lt});return e.jsx(tr,{...a,children:e.jsx(zr,{scope:r,contentId:Ve(),triggerRef:_,open:j,onOpenChange:v,onOpenToggle:c.useCallback(()=>v(E=>!E),[v]),hasCustomAnchor:m,onCustomAnchorAdd:c.useCallback(()=>y(!0),[]),onCustomAnchorRemove:c.useCallback(()=>y(!1),[]),modal:u,children:t})})};Qs.displayName=Lt;var Xs="PopoverAnchor",Js=c.forwardRef((s,r)=>{const{__scopePopover:t,...i}=s,n=We(Xs,t),o=pt(t),{onCustomAnchorAdd:u,onCustomAnchorRemove:a}=n;return c.useEffect(()=>(u(),()=>a()),[u,a]),e.jsx(Us,{...o,...i,ref:r})});Js.displayName=Xs;var en="PopoverTrigger",tn=c.forwardRef((s,r)=>{const{__scopePopover:t,...i}=s,n=We(en,t),o=pt(t),u=Ls(r,n.triggerRef),a=e.jsx(Ie.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":ln(n.open),...i,ref:u,onClick:ut(s.onClick,n.onOpenToggle)});return n.hasCustomAnchor?a:e.jsx(Us,{asChild:!0,...o,children:a})});tn.displayName=en;var ls="PopoverPortal",[Vr,Zr]=Ys(ls,{forceMount:void 0}),sn=s=>{const{__scopePopover:r,forceMount:t,children:i,container:n}=s,o=We(ls,r);return e.jsx(Vr,{scope:r,forceMount:t,children:e.jsx(Fs,{present:t||o.open,children:e.jsx(Bi,{asChild:!0,container:n,children:i})})})};sn.displayName=ls;var st="PopoverContent",nn=c.forwardRef((s,r)=>{const t=Zr(st,s.__scopePopover),{forceMount:i=t.forceMount,...n}=s,o=We(st,s.__scopePopover);return e.jsx(Fs,{present:i||o.open,children:o.modal?e.jsx(Br,{...n,ref:r}):e.jsx(qr,{...n,ref:r})})});nn.displayName=st;var Gr=Pr("PopoverContent.RemoveScroll"),Br=c.forwardRef((s,r)=>{const t=We(st,s.__scopePopover),i=c.useRef(null),n=Ls(r,i),o=c.useRef(!1);return c.useEffect(()=>{const u=i.current;if(u)return qi(u)},[]),e.jsx(Ki,{as:Gr,allowPinchZoom:!0,children:e.jsx(rn,{...s,ref:n,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ut(s.onCloseAutoFocus,u=>{var a;u.preventDefault(),o.current||(a=t.triggerRef.current)==null||a.focus()}),onPointerDownOutside:ut(s.onPointerDownOutside,u=>{const a=u.detail.originalEvent,_=a.button===0&&a.ctrlKey===!0,m=a.button===2||_;o.current=m},{checkForDefaultPrevented:!1}),onFocusOutside:ut(s.onFocusOutside,u=>u.preventDefault(),{checkForDefaultPrevented:!1})})})}),qr=c.forwardRef((s,r)=>{const t=We(st,s.__scopePopover),i=c.useRef(!1),n=c.useRef(!1);return e.jsx(rn,{...s,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var u,a;(u=s.onCloseAutoFocus)==null||u.call(s,o),o.defaultPrevented||(i.current||(a=t.triggerRef.current)==null||a.focus(),o.preventDefault()),i.current=!1,n.current=!1},onInteractOutside:o=>{var _,m;(_=s.onInteractOutside)==null||_.call(s,o),o.defaultPrevented||(i.current=!0,o.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const u=o.target;((m=t.triggerRef.current)==null?void 0:m.contains(u))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&n.current&&o.preventDefault()}})}),rn=c.forwardRef((s,r)=>{const{__scopePopover:t,trapFocus:i,onOpenAutoFocus:n,onCloseAutoFocus:o,disableOutsidePointerEvents:u,onEscapeKeyDown:a,onPointerDownOutside:_,onFocusOutside:m,onInteractOutside:y,...j}=s,v=We(st,t),E=pt(t);return Yi(),e.jsx(Qi,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:n,onUnmountAutoFocus:o,children:e.jsx(Xi,{asChild:!0,disableOutsidePointerEvents:u,onInteractOutside:y,onEscapeKeyDown:a,onPointerDownOutside:_,onFocusOutside:m,onDismiss:()=>v.onOpenChange(!1),children:e.jsx(Ji,{"data-state":ln(v.open),role:"dialog",id:v.contentId,...E,...j,ref:r,style:{...j.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),an="PopoverClose",Kr=c.forwardRef((s,r)=>{const{__scopePopover:t,...i}=s,n=We(an,t);return e.jsx(Ie.button,{type:"button",...i,ref:r,onClick:ut(s.onClick,()=>n.onOpenChange(!1))})});Kr.displayName=an;var Yr="PopoverArrow",Qr=c.forwardRef((s,r)=>{const{__scopePopover:t,...i}=s,n=pt(t);return e.jsx(sr,{...n,...i,ref:r})});Qr.displayName=Yr;function ln(s){return s?"open":"closed"}var Xr=Qs,Jr=Js,ea=tn,ta=sn,on=nn;const _t=Xr,vt=ea,gl=Jr,nt=c.forwardRef(({className:s,align:r="center",sideOffset:t=4,...i},n)=>e.jsx(ta,{children:e.jsx(on,{ref:n,align:r,sideOffset:t,className:de("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})}));nt.displayName=on.displayName;var Rs=1,sa=.9,na=.8,ia=.17,es=.1,ts=.999,ra=.9999,aa=.99,la=/[\\\/_+.#"@\[\(\{&]/,oa=/[\\\/_+.#"@\[\(\{&]/g,ca=/[\s-]/,cn=/[\s-]/g;function is(s,r,t,i,n,o,u){if(o===r.length)return n===s.length?Rs:aa;var a=`${n},${o}`;if(u[a]!==void 0)return u[a];for(var _=i.charAt(o),m=t.indexOf(_,n),y=0,j,v,E,M;m>=0;)j=is(s,r,t,i,m+1,o+1,u),j>y&&(m===n?j*=Rs:la.test(s.charAt(m-1))?(j*=na,E=s.slice(n,m-1).match(oa),E&&n>0&&(j*=Math.pow(ts,E.length))):ca.test(s.charAt(m-1))?(j*=sa,M=s.slice(n,m-1).match(cn),M&&n>0&&(j*=Math.pow(ts,M.length))):(j*=ia,n>0&&(j*=Math.pow(ts,m-n))),s.charAt(m)!==r.charAt(o)&&(j*=ra)),(j<es&&t.charAt(m-1)===i.charAt(o+1)||i.charAt(o+1)===i.charAt(o)&&t.charAt(m-1)!==i.charAt(o))&&(v=is(s,r,t,i,m+1,o+2,u),v*es>j&&(j=v*es)),j>y&&(y=j),m=t.indexOf(_,m+1);return u[a]=y,y}function As(s){return s.toLowerCase().replace(cn," ")}function da(s,r,t){return s=t&&t.length>0?`${s+" "+t.join(" ")}`:s,is(s,r,As(s),As(r),0,0,{})}var dt='[cmdk-group=""]',ss='[cmdk-group-items=""]',ua='[cmdk-group-heading=""]',dn='[cmdk-item=""]',ks=`${dn}:not([aria-disabled="true"])`,rs="cmdk-item-select",Xe="data-value",ma=(s,r,t)=>da(s,r,t),un=c.createContext(void 0),bt=()=>c.useContext(un),mn=c.createContext(void 0),os=()=>c.useContext(mn),hn=c.createContext(void 0),xn=c.forwardRef((s,r)=>{let t=Je(()=>{var p,k;return{search:"",value:(k=(p=s.value)!=null?p:s.defaultValue)!=null?k:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),i=Je(()=>new Set),n=Je(()=>new Map),o=Je(()=>new Map),u=Je(()=>new Set),a=fn(s),{label:_,children:m,value:y,onValueChange:j,filter:v,shouldFilter:E,loop:M,disablePointerSelection:T=!1,vimBindings:S=!0,...V}=s,Z=Ve(),I=Ve(),C=Ve(),l=c.useRef(null),g=wa();Ze(()=>{if(y!==void 0){let p=y.trim();t.current.value=p,A.emit()}},[y]),Ze(()=>{g(6,ve)},[]);let A=c.useMemo(()=>({subscribe:p=>(u.current.add(p),()=>u.current.delete(p)),snapshot:()=>t.current,setState:(p,k,z)=>{var F,G,Y,ue;if(!Object.is(t.current[p],k)){if(t.current[p]=k,p==="search")Ne(),xe(),g(1,me);else if(p==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let ne=document.getElementById(C);ne?ne.focus():(F=document.getElementById(Z))==null||F.focus()}if(g(7,()=>{var ne;t.current.selectedItemId=(ne=fe())==null?void 0:ne.id,A.emit()}),z||g(5,ve),((G=a.current)==null?void 0:G.value)!==void 0){let ne=k??"";(ue=(Y=a.current).onValueChange)==null||ue.call(Y,ne);return}}A.emit()}},emit:()=>{u.current.forEach(p=>p())}}),[]),B=c.useMemo(()=>({value:(p,k,z)=>{var F;k!==((F=o.current.get(p))==null?void 0:F.value)&&(o.current.set(p,{value:k,keywords:z}),t.current.filtered.items.set(p,$(k,z)),g(2,()=>{xe(),A.emit()}))},item:(p,k)=>(i.current.add(p),k&&(n.current.has(k)?n.current.get(k).add(p):n.current.set(k,new Set([p]))),g(3,()=>{Ne(),xe(),t.current.value||me(),A.emit()}),()=>{o.current.delete(p),i.current.delete(p),t.current.filtered.items.delete(p);let z=fe();g(4,()=>{Ne(),(z==null?void 0:z.getAttribute("id"))===p&&me(),A.emit()})}),group:p=>(n.current.has(p)||n.current.set(p,new Set),()=>{o.current.delete(p),n.current.delete(p)}),filter:()=>a.current.shouldFilter,label:_||s["aria-label"],getDisablePointerSelection:()=>a.current.disablePointerSelection,listId:Z,inputId:C,labelId:I,listInnerRef:l}),[]);function $(p,k){var z,F;let G=(F=(z=a.current)==null?void 0:z.filter)!=null?F:ma;return p?G(p,t.current.search,k):0}function xe(){if(!t.current.search||a.current.shouldFilter===!1)return;let p=t.current.filtered.items,k=[];t.current.filtered.groups.forEach(F=>{let G=n.current.get(F),Y=0;G.forEach(ue=>{let ne=p.get(ue);Y=Math.max(ne,Y)}),k.push([F,Y])});let z=l.current;he().sort((F,G)=>{var Y,ue;let ne=F.getAttribute("id"),Q=G.getAttribute("id");return((Y=p.get(Q))!=null?Y:0)-((ue=p.get(ne))!=null?ue:0)}).forEach(F=>{let G=F.closest(ss);G?G.appendChild(F.parentElement===G?F:F.closest(`${ss} > *`)):z.appendChild(F.parentElement===z?F:F.closest(`${ss} > *`))}),k.sort((F,G)=>G[1]-F[1]).forEach(F=>{var G;let Y=(G=l.current)==null?void 0:G.querySelector(`${dt}[${Xe}="${encodeURIComponent(F[0])}"]`);Y==null||Y.parentElement.appendChild(Y)})}function me(){let p=he().find(z=>z.getAttribute("aria-disabled")!=="true"),k=p==null?void 0:p.getAttribute(Xe);A.setState("value",k||void 0)}function Ne(){var p,k,z,F;if(!t.current.search||a.current.shouldFilter===!1){t.current.filtered.count=i.current.size;return}t.current.filtered.groups=new Set;let G=0;for(let Y of i.current){let ue=(k=(p=o.current.get(Y))==null?void 0:p.value)!=null?k:"",ne=(F=(z=o.current.get(Y))==null?void 0:z.keywords)!=null?F:[],Q=$(ue,ne);t.current.filtered.items.set(Y,Q),Q>0&&G++}for(let[Y,ue]of n.current)for(let ne of ue)if(t.current.filtered.items.get(ne)>0){t.current.filtered.groups.add(Y);break}t.current.filtered.count=G}function ve(){var p,k,z;let F=fe();F&&(((p=F.parentElement)==null?void 0:p.firstChild)===F&&((z=(k=F.closest(dt))==null?void 0:k.querySelector(ua))==null||z.scrollIntoView({block:"nearest"})),F.scrollIntoView({block:"nearest"}))}function fe(){var p;return(p=l.current)==null?void 0:p.querySelector(`${dn}[aria-selected="true"]`)}function he(){var p;return Array.from(((p=l.current)==null?void 0:p.querySelectorAll(ks))||[])}function se(p){let k=he()[p];k&&A.setState("value",k.getAttribute(Xe))}function ie(p){var k;let z=fe(),F=he(),G=F.findIndex(ue=>ue===z),Y=F[G+p];(k=a.current)!=null&&k.loop&&(Y=G+p<0?F[F.length-1]:G+p===F.length?F[0]:F[G+p]),Y&&A.setState("value",Y.getAttribute(Xe))}function Re(p){let k=fe(),z=k==null?void 0:k.closest(dt),F;for(;z&&!F;)z=p>0?ya(z,dt):ja(z,dt),F=z==null?void 0:z.querySelector(ks);F?A.setState("value",F.getAttribute(Xe)):ie(p)}let Oe=()=>se(he().length-1),Ge=p=>{p.preventDefault(),p.metaKey?Oe():p.altKey?Re(1):ie(1)},He=p=>{p.preventDefault(),p.metaKey?se(0):p.altKey?Re(-1):ie(-1)};return c.createElement(Ie.div,{ref:r,tabIndex:-1,...V,"cmdk-root":"",onKeyDown:p=>{var k;(k=V.onKeyDown)==null||k.call(V,p);let z=p.nativeEvent.isComposing||p.keyCode===229;if(!(p.defaultPrevented||z))switch(p.key){case"n":case"j":{S&&p.ctrlKey&&Ge(p);break}case"ArrowDown":{Ge(p);break}case"p":case"k":{S&&p.ctrlKey&&He(p);break}case"ArrowUp":{He(p);break}case"Home":{p.preventDefault(),se(0);break}case"End":{p.preventDefault(),Oe();break}case"Enter":{p.preventDefault();let F=fe();if(F){let G=new Event(rs);F.dispatchEvent(G)}}}}},c.createElement("label",{"cmdk-label":"",htmlFor:B.inputId,id:B.labelId,style:Sa},_),Ut(s,p=>c.createElement(mn.Provider,{value:A},c.createElement(un.Provider,{value:B},p))))}),ha=c.forwardRef((s,r)=>{var t,i;let n=Ve(),o=c.useRef(null),u=c.useContext(hn),a=bt(),_=fn(s),m=(i=(t=_.current)==null?void 0:t.forceMount)!=null?i:u==null?void 0:u.forceMount;Ze(()=>{if(!m)return a.item(n,u==null?void 0:u.id)},[m]);let y=gn(n,o,[s.value,s.children,o],s.keywords),j=os(),v=Ue(g=>g.value&&g.value===y.current),E=Ue(g=>m||a.filter()===!1?!0:g.search?g.filtered.items.get(n)>0:!0);c.useEffect(()=>{let g=o.current;if(!(!g||s.disabled))return g.addEventListener(rs,M),()=>g.removeEventListener(rs,M)},[E,s.onSelect,s.disabled]);function M(){var g,A;T(),(A=(g=_.current).onSelect)==null||A.call(g,y.current)}function T(){j.setState("value",y.current,!0)}if(!E)return null;let{disabled:S,value:V,onSelect:Z,forceMount:I,keywords:C,...l}=s;return c.createElement(Ie.div,{ref:et(o,r),...l,id:n,"cmdk-item":"",role:"option","aria-disabled":!!S,"aria-selected":!!v,"data-disabled":!!S,"data-selected":!!v,onPointerMove:S||a.getDisablePointerSelection()?void 0:T,onClick:S?void 0:M},s.children)}),xa=c.forwardRef((s,r)=>{let{heading:t,children:i,forceMount:n,...o}=s,u=Ve(),a=c.useRef(null),_=c.useRef(null),m=Ve(),y=bt(),j=Ue(E=>n||y.filter()===!1?!0:E.search?E.filtered.groups.has(u):!0);Ze(()=>y.group(u),[]),gn(u,a,[s.value,s.heading,_]);let v=c.useMemo(()=>({id:u,forceMount:n}),[n]);return c.createElement(Ie.div,{ref:et(a,r),...o,"cmdk-group":"",role:"presentation",hidden:j?void 0:!0},t&&c.createElement("div",{ref:_,"cmdk-group-heading":"","aria-hidden":!0,id:m},t),Ut(s,E=>c.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":t?m:void 0},c.createElement(hn.Provider,{value:v},E))))}),fa=c.forwardRef((s,r)=>{let{alwaysRender:t,...i}=s,n=c.useRef(null),o=Ue(u=>!u.search);return!t&&!o?null:c.createElement(Ie.div,{ref:et(n,r),...i,"cmdk-separator":"",role:"separator"})}),ga=c.forwardRef((s,r)=>{let{onValueChange:t,...i}=s,n=s.value!=null,o=os(),u=Ue(m=>m.search),a=Ue(m=>m.selectedItemId),_=bt();return c.useEffect(()=>{s.value!=null&&o.setState("search",s.value)},[s.value]),c.createElement(Ie.input,{ref:r,...i,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":_.listId,"aria-labelledby":_.labelId,"aria-activedescendant":a,id:_.inputId,type:"text",value:n?s.value:u,onChange:m=>{n||o.setState("search",m.target.value),t==null||t(m.target.value)}})}),pa=c.forwardRef((s,r)=>{let{children:t,label:i="Suggestions",...n}=s,o=c.useRef(null),u=c.useRef(null),a=Ue(m=>m.selectedItemId),_=bt();return c.useEffect(()=>{if(u.current&&o.current){let m=u.current,y=o.current,j,v=new ResizeObserver(()=>{j=requestAnimationFrame(()=>{let E=m.offsetHeight;y.style.setProperty("--cmdk-list-height",E.toFixed(1)+"px")})});return v.observe(m),()=>{cancelAnimationFrame(j),v.unobserve(m)}}},[]),c.createElement(Ie.div,{ref:et(o,r),...n,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":a,"aria-label":i,id:_.listId},Ut(s,m=>c.createElement("div",{ref:et(u,_.listInnerRef),"cmdk-list-sizer":""},m)))}),_a=c.forwardRef((s,r)=>{let{open:t,onOpenChange:i,overlayClassName:n,contentClassName:o,container:u,...a}=s;return c.createElement(Ar,{open:t,onOpenChange:i},c.createElement(kr,{container:u},c.createElement(Dr,{"cmdk-overlay":"",className:n}),c.createElement(Tr,{"aria-label":s.label,"cmdk-dialog":"",className:o},c.createElement(xn,{ref:r,...a}))))}),va=c.forwardRef((s,r)=>Ue(t=>t.filtered.count===0)?c.createElement(Ie.div,{ref:r,...s,"cmdk-empty":"",role:"presentation"}):null),ba=c.forwardRef((s,r)=>{let{progress:t,children:i,label:n="Loading...",...o}=s;return c.createElement(Ie.div,{ref:r,...o,"cmdk-loading":"",role:"progressbar","aria-valuenow":t,"aria-valuemin":0,"aria-valuemax":100,"aria-label":n},Ut(s,u=>c.createElement("div",{"aria-hidden":!0},u)))}),_e=Object.assign(xn,{List:pa,Item:ha,Input:ga,Group:xa,Separator:fa,Dialog:_a,Empty:va,Loading:ba});function ya(s,r){let t=s.nextElementSibling;for(;t;){if(t.matches(r))return t;t=t.nextElementSibling}}function ja(s,r){let t=s.previousElementSibling;for(;t;){if(t.matches(r))return t;t=t.previousElementSibling}}function fn(s){let r=c.useRef(s);return Ze(()=>{r.current=s}),r}var Ze=typeof window>"u"?c.useEffect:c.useLayoutEffect;function Je(s){let r=c.useRef();return r.current===void 0&&(r.current=s()),r}function Ue(s){let r=os(),t=()=>s(r.snapshot());return c.useSyncExternalStore(r.subscribe,t,t)}function gn(s,r,t,i=[]){let n=c.useRef(),o=bt();return Ze(()=>{var u;let a=(()=>{var m;for(let y of t){if(typeof y=="string")return y.trim();if(typeof y=="object"&&"current"in y)return y.current?(m=y.current.textContent)==null?void 0:m.trim():n.current}})(),_=i.map(m=>m.trim());o.value(s,a,_),(u=r.current)==null||u.setAttribute(Xe,a),n.current=a}),n}var wa=()=>{let[s,r]=c.useState(),t=Je(()=>new Map);return Ze(()=>{t.current.forEach(i=>i()),t.current=new Map},[s]),(i,n)=>{t.current.set(i,n),r({})}};function Ea(s){let r=s.type;return typeof r=="function"?r(s.props):"render"in r?r.render(s.props):s}function Ut({asChild:s,children:r},t){return s&&c.isValidElement(r)?c.cloneElement(Ea(r),{ref:r.ref},t(r.props.children)):t(r)}var Sa={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const pn=c.forwardRef(({className:s,...r},t)=>e.jsx(_e,{ref:t,className:de("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s),...r}));pn.displayName=_e.displayName;const _n=c.forwardRef(({className:s,...r},t)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(nr,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(_e.Input,{ref:t,className:de("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s),...r})]}));_n.displayName=_e.Input.displayName;const vn=c.forwardRef(({className:s,...r},t)=>e.jsx(_e.List,{ref:t,className:de("max-h-[300px] overflow-y-auto overflow-x-hidden",s),...r}));vn.displayName=_e.List.displayName;const bn=c.forwardRef((s,r)=>e.jsx(_e.Empty,{ref:r,className:"py-6 text-center text-sm",...s}));bn.displayName=_e.Empty.displayName;const yn=c.forwardRef(({className:s,...r},t)=>e.jsx(_e.Group,{ref:t,className:de("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",s),...r}));yn.displayName=_e.Group.displayName;const Na=c.forwardRef(({className:s,...r},t)=>e.jsx(_e.Separator,{ref:t,className:de("-mx-1 h-px bg-border",s),...r}));Na.displayName=_e.Separator.displayName;const jn=c.forwardRef(({className:s,...r},t)=>e.jsx(_e.Item,{ref:t,className:de("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s),...r}));jn.displayName=_e.Item.displayName;const Wt=({value:s,onValueChange:r,options:t,placeholder:i="Select options",disabled:n=!1,className:o,maxBadges:u=3})=>{const[a,_]=c.useState(!1),[m,y]=c.useState(""),[j,v]=c.useState(!1),E=c.useMemo(()=>new Set(s),[s]),M=c.useMemo(()=>{const l=m.trim().toLowerCase();return l?t.filter(g=>`${g.label} ${g.value}`.toLowerCase().includes(l)):t},[t,m]),T=c.useMemo(()=>{const l=M;return j?l.filter(g=>E.has(g.value)):l},[M,j,E]),S=l=>{E.has(l)?r(s.filter(g=>g!==l)):r([...s,l])},V=l=>{l==null||l.stopPropagation(),r([])},Z=s.slice(0,u),I=Math.max(0,s.length-Z.length),C=c.useMemo(()=>{const l=new Map(t.map(g=>[g.value,g.label]));return g=>l.get(g)||g},[t]);return e.jsxs(_t,{open:a,onOpenChange:_,children:[e.jsx(vt,{asChild:!0,children:e.jsxs(pe,{type:"button",variant:"outline",role:"combobox","aria-expanded":a,disabled:n,className:de("w-full justify-between h-8",s.length===0&&"text-muted-foreground",o),children:[e.jsx("div",{className:"flex flex-wrap gap-1 items-center",children:s.length===0?e.jsx("span",{className:"truncate",children:i}):e.jsxs(e.Fragment,{children:[Z.map(l=>e.jsxs(ws,{variant:"secondary",className:"px-2 py-0.5 flex items-center gap-1",children:[C(l),e.jsx("span",{role:"button",tabIndex:0,"aria-label":`Remove ${C(l)}`,onClick:g=>{g.stopPropagation(),g.preventDefault(),r(s.filter(A=>A!==l))},onKeyDown:g=>{(g.key==="Enter"||g.key===" ")&&(g.stopPropagation(),g.preventDefault(),r(s.filter(A=>A!==l)))},className:"hover:text-foreground text-muted-foreground cursor-pointer",children:e.jsx(Es,{className:"h-3 w-3"})})]},l)),I>0&&e.jsxs(ws,{variant:"secondary",className:"px-2 py-0.5",children:["+",I]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.length>0&&e.jsx("span",{role:"button",tabIndex:0,onClick:V,onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&V(l)},className:"cursor-pointer",children:e.jsx(Es,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"})}),e.jsx($r,{className:"h-4 w-4 opacity-60"})]})]})}),e.jsx(nt,{className:"w-[var(--radix-popover-trigger-width)] p-0",align:"start",onOpenAutoFocus:l=>l.preventDefault(),children:e.jsxs(pn,{shouldFilter:!1,children:[e.jsx(_n,{placeholder:"Search...",value:m,onValueChange:y}),e.jsxs(vn,{className:"max-h-72 overflow-y-auto overscroll-contain",onWheelCapture:l=>l.stopPropagation(),children:[e.jsx(bn,{children:"No results found."}),e.jsx(yn,{children:T.map(l=>{const g=E.has(l.value);return e.jsxs(jn,{onSelect:()=>S(l.value),className:"cursor-pointer",children:[e.jsx(Ir,{className:de("mr-2 h-4 w-4",g?"opacity-100":"opacity-0")}),e.jsx("span",{className:"flex-1 truncate",children:l.label}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",l.value,")"]})]},l.value)})})]}),e.jsxs("div",{className:"flex justify-between p-2 border-t",children:[e.jsx(pe,{variant:"ghost",size:"sm",onClick:()=>v(l=>!l),disabled:s.length===0&&!j,children:j?"All Countries":"Selected"}),s.length>0&&e.jsx(pe,{variant:"ghost",size:"sm",onClick:V,children:"Clear"})]})]})})]})};Wt.displayName="MultiSelect";const wn=[{value:"tracked",label:"Tracked"},{value:"b2c",label:"B2C"},{value:"b2b",label:"B2B"},{value:"signature",label:"Signature Required"},{value:"insurance",label:"Insurance"},{value:"express",label:"Express"},{value:"dangerous_goods",label:"Dangerous Goods"},{value:"saturday_delivery",label:"Saturday Delivery"},{value:"sunday_delivery",label:"Sunday Delivery"},{value:"multicollo",label:"Multicollo"}],it="__none__",Ca=[{value:it,label:"Not required"},{value:"16",label:"16+"},{value:"18",label:"18+"}],Ra=[{value:it,label:"Not specified"},{value:"pick_up",label:"Pick Up"},{value:"drop_off",label:"Drop Off"},{value:"pick_up_and_drop_off",label:"Pick Up & Drop Off"}],Aa=[{value:it,label:"Not specified"},{value:"home_delivery",label:"Home Delivery"},{value:"service_point",label:"Service Point"},{value:"mailbox",label:"Mailbox"}],ka=[{value:it,label:"Not specified"},{value:"parcel",label:"Parcel"},{value:"envelope",label:"Envelope"},{value:"pallet",label:"Pallet"}],wt=s=>s&&s.trim()!==""?s:it,Et=s=>!s||s===it||s.trim()===""?"":s.trim(),Mt={service_name:"",service_code:"",carrier_service_code:"",description:"",active:!0,currency:"USD",transit_days:null,transit_time:null,max_width:null,max_height:null,max_length:null,dimension_unit:"CM",min_weight:null,max_weight:null,weight_unit:"KG",domicile:!0,international:!1,zones:[],surcharge_ids:[],features:[],first_mile:"",last_mile:"",form_factor:"",age_check:""};function Da(s){return s?Array.isArray(s)?s:wn.filter(r=>s[r.value]===!0).map(r=>r.value):[]}function Ta(s){const r=s==null?void 0:s.features,t=Da(r),i=r&&typeof r=="object"&&!Array.isArray(r)?r.first_mile||"":(s==null?void 0:s.first_mile)||"",n=r&&typeof r=="object"&&!Array.isArray(r)?r.last_mile||"":(s==null?void 0:s.last_mile)||"",o=r&&typeof r=="object"&&!Array.isArray(r)?r.form_factor||"":(s==null?void 0:s.form_factor)||"",u=r&&typeof r=="object"&&!Array.isArray(r)?r.age_check||"":(s==null?void 0:s.age_check)||"";return{...Mt,...s,surcharge_ids:(s==null?void 0:s.surcharge_ids)||[],features:t,first_mile:i,last_mile:n,form_factor:o,age_check:u}}const Ia=({service:s,isOpen:r,onClose:t,onSubmit:i,trigger:n,availableSurcharges:o=[],servicePresets:u=[]})=>{const[a,_]=Te.useState(s||Mt),[m,y]=Te.useState(!1),[j,v]=Te.useState("general"),[E,M]=Te.useState({}),T=Te.useMemo(()=>{const l=[{id:"general",label:"General"},{id:"transit",label:"Transit"},{id:"features",label:"Features"},{id:"logistics",label:"Logistics"},{id:"limits",label:"Limits"}];return o.length>0&&l.push({id:"surcharges",label:"Surcharges"}),l},[o.length]);Te.useEffect(()=>{_(s?Ta(s):Mt),v("general"),M({})},[s]);const S=(l,g)=>{_(A=>({...A,[l]:g})),E[l]&&M(A=>{const B={...A};return delete B[l],B})},V=()=>{var g,A;const l={};return(g=a.service_name)!=null&&g.trim()||(l.service_name="Required"),(A=a.service_code)!=null&&A.trim()?/^[a-z0-9_]+$/.test(a.service_code)||(l.service_code="Only lowercase letters, numbers, and underscores"):l.service_code="Required",M(l),Object.keys(l).length>0?(v("general"),!1):!0},Z=async l=>{if(l.preventDefault(),!!V()){y(!0);try{const g={...a},A=B=>!B||B.trim()===""?null:B.trim();g.features={tracked:a.features.includes("tracked"),b2c:a.features.includes("b2c"),b2b:a.features.includes("b2b"),signature:a.features.includes("signature"),insurance:a.features.includes("insurance"),express:a.features.includes("express"),dangerous_goods:a.features.includes("dangerous_goods"),saturday_delivery:a.features.includes("saturday_delivery"),sunday_delivery:a.features.includes("sunday_delivery"),multicollo:a.features.includes("multicollo"),age_check:A(a.age_check),first_mile:A(a.first_mile),last_mile:A(a.last_mile),form_factor:A(a.form_factor),shipment_type:null},delete g.first_mile,delete g.last_mile,delete g.form_factor,delete g.age_check,await i(g),t()}catch(g){console.error("Failed to save service:",g)}finally{y(!1)}}},I=!!(s!=null&&s.id),C=!ir(a,s||Mt);return e.jsx(mt,{open:r,onOpenChange:t,children:e.jsxs(ht,{className:"max-w-xl max-h-[90vh] p-0 flex flex-col",children:[e.jsxs(xt,{className:"px-4 py-3 border-b bg-background shrink-0",children:[e.jsx(ft,{className:"text-base",children:I?"Edit Service":"Add Service"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Configure service details and settings"})]}),e.jsx("div",{className:"border-b border-border px-4 shrink-0",children:e.jsx("div",{className:"flex",children:T.map(l=>e.jsx("button",{type:"button",onClick:()=>v(l.id),className:de("flex-1 py-2 text-xs font-medium border-b-2 transition-colors",j===l.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"),children:l.label},l.id))})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3 min-h-0",children:e.jsxs("form",{onSubmit:Z,className:"space-y-3",children:[j==="general"&&e.jsxs("div",{className:"space-y-3",children:[!I&&u.length>0&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Prefill from carrier service"}),e.jsxs(ye,{value:"",onValueChange:l=>{const g=u.find(A=>A.code===l);g&&(S("service_name",g.name),S("service_code",l),S("carrier_service_code",l))},children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{placeholder:"Select a preset..."})}),e.jsx(Ee,{children:u.map(l=>e.jsx(Se,{value:l.code,children:l.name},l.code))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(W,{htmlFor:"service_name",className:"text-xs",children:["Service Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"service_name",value:a.service_name,onChange:l=>S("service_name",l.target.value),placeholder:"Standard Service",className:de("h-9",E.service_name&&"border-destructive")}),E.service_name&&e.jsx("p",{className:"text-xs text-destructive",children:E.service_name})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(W,{htmlFor:"service_code",className:"text-xs",children:["Service Code ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"service_code",value:a.service_code,onChange:l=>S("service_code",l.target.value),placeholder:"standard_service",className:de("h-9",E.service_code&&"border-destructive")}),E.service_code&&e.jsx("p",{className:"text-xs text-destructive",children:E.service_code})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"carrier_service_code",className:"text-xs",children:"Carrier Service Code"}),e.jsx(te,{id:"carrier_service_code",value:a.carrier_service_code||"",onChange:l=>S("carrier_service_code",l.target.value),placeholder:"Optional",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(W,{htmlFor:"currency",className:"text-xs",children:["Currency ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(ye,{value:a.currency,onValueChange:l=>S("currency",l),children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{})}),e.jsx(Ee,{children:Ws.map(l=>e.jsx(Se,{value:l,children:l},l))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"description",className:"text-xs",children:"Description"}),e.jsx(te,{id:"description",value:a.description||"",onChange:l=>S("description",l.target.value),placeholder:"Optional service description",className:"h-9"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 pt-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ze,{id:"domicile",checked:a.domicile,onCheckedChange:l=>S("domicile",l)}),e.jsx(W,{htmlFor:"domicile",className:"text-xs cursor-pointer",children:"National/Domestic"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ze,{id:"international",checked:a.international,onCheckedChange:l=>S("international",l)}),e.jsx(W,{htmlFor:"international",className:"text-xs cursor-pointer",children:"International"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ze,{id:"active",checked:a.active,onCheckedChange:l=>S("active",l)}),e.jsx(W,{htmlFor:"active",className:"text-xs cursor-pointer",children:"Active"})]})]})]}),j==="transit"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"transit_days",className:"text-xs",children:"Transit Days"}),e.jsx(te,{id:"transit_days",type:"number",min:"0",value:a.transit_days||"",onChange:l=>S("transit_days",l.target.value?parseInt(l.target.value):null),placeholder:"e.g., 3",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"transit_time",className:"text-xs",children:"Transit Time (hours)"}),e.jsx(te,{id:"transit_time",type:"number",step:"0.1",min:"0",value:a.transit_time||"",onChange:l=>S("transit_time",l.target.value?parseFloat(l.target.value):null),placeholder:"e.g., 72",className:"h-9"})]})]}),j==="features"&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Service Features"}),e.jsx(Wt,{options:wn,value:a.features||[],onValueChange:l=>S("features",l),placeholder:"Select features..."})]})}),j==="logistics"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"first_mile",className:"text-xs",children:"First Mile"}),e.jsxs(ye,{value:wt(a.first_mile),onValueChange:l=>S("first_mile",Et(l)),children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{placeholder:"Not specified"})}),e.jsx(Ee,{children:Ra.map(l=>e.jsx(Se,{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"last_mile",className:"text-xs",children:"Last Mile"}),e.jsxs(ye,{value:wt(a.last_mile),onValueChange:l=>S("last_mile",Et(l)),children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{placeholder:"Not specified"})}),e.jsx(Ee,{children:Aa.map(l=>e.jsx(Se,{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"form_factor",className:"text-xs",children:"Form Factor"}),e.jsxs(ye,{value:wt(a.form_factor),onValueChange:l=>S("form_factor",Et(l)),children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{placeholder:"Not specified"})}),e.jsx(Ee,{children:ka.map(l=>e.jsx(Se,{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"age_check",className:"text-xs",children:"Age Check"}),e.jsxs(ye,{value:wt(a.age_check),onValueChange:l=>S("age_check",Et(l)),children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{placeholder:"Not required"})}),e.jsx(Ee,{children:Ca.map(l=>e.jsx(Se,{value:l.value,children:l.label},l.value))})]})]})]}),j==="limits"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Weight"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"min_weight",className:"text-xs",children:"Min Weight"}),e.jsx(te,{id:"min_weight",type:"number",step:"0.1",min:"0",value:a.min_weight||"",onChange:l=>S("min_weight",l.target.value?parseFloat(l.target.value):null),placeholder:"0",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"max_weight",className:"text-xs",children:"Max Weight"}),e.jsx(te,{id:"max_weight",type:"number",step:"0.1",min:"0",value:a.max_weight||"",onChange:l=>S("max_weight",l.target.value?parseFloat(l.target.value):null),placeholder:"No limit",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"weight_unit",className:"text-xs",children:"Weight Unit"}),e.jsxs(ye,{value:a.weight_unit,onValueChange:l=>S("weight_unit",l),children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{})}),e.jsx(Ee,{children:zs.map(l=>e.jsx(Se,{value:l,children:l},l))})]})]})]}),e.jsxs("div",{className:"border-t border-border pt-4 space-y-3",children:[e.jsx("h4",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Dimensions"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"max_length",className:"text-xs",children:"Max Length"}),e.jsx(te,{id:"max_length",type:"number",step:"0.1",min:"0",value:a.max_length||"",onChange:l=>S("max_length",l.target.value?parseFloat(l.target.value):null),placeholder:"No limit",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"max_width",className:"text-xs",children:"Max Width"}),e.jsx(te,{id:"max_width",type:"number",step:"0.1",min:"0",value:a.max_width||"",onChange:l=>S("max_width",l.target.value?parseFloat(l.target.value):null),placeholder:"No limit",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"max_height",className:"text-xs",children:"Max Height"}),e.jsx(te,{id:"max_height",type:"number",step:"0.1",min:"0",value:a.max_height||"",onChange:l=>S("max_height",l.target.value?parseFloat(l.target.value):null),placeholder:"No limit",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{htmlFor:"dimension_unit",className:"text-xs",children:"Dimension Unit"}),e.jsxs(ye,{value:a.dimension_unit,onValueChange:l=>S("dimension_unit",l),children:[e.jsx(je,{className:"h-9",children:e.jsx(we,{})}),e.jsx(Ee,{children:Vs.map(l=>e.jsx(Se,{value:l,children:l},l))})]})]})]})]}),j==="surcharges"&&o.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"border border-border rounded-md p-2 space-y-1.5 max-h-32 overflow-y-auto",children:o.map(l=>{const g=(a.surcharge_ids||[]).includes(l.id);return e.jsxs("div",{className:"flex items-center justify-between gap-2 py-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(ze,{id:`surcharge-${l.id}`,checked:g,onCheckedChange:A=>{const B=A?[...a.surcharge_ids||[],l.id]:(a.surcharge_ids||[]).filter($=>$!==l.id);S("surcharge_ids",B)}}),e.jsx(W,{htmlFor:`surcharge-${l.id}`,className:"text-xs font-medium text-foreground cursor-pointer truncate",children:l.name||"Unnamed surcharge"})]}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:l.surcharge_type==="percentage"?`${l.amount}%`:`${l.amount}`})]},l.id)})}),(a.surcharge_ids||[]).length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:(a.surcharge_ids||[]).map(l=>{const g=o.find(A=>A.id===l);return g?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium bg-primary/10 text-primary rounded-full",children:[g.name||"Unnamed",e.jsx("button",{type:"button",onClick:()=>S("surcharge_ids",(a.surcharge_ids||[]).filter(A=>A!==l)),className:"hover:bg-primary/20 rounded-full p-0.5",children:e.jsx(tt,{className:"h-2.5 w-2.5"})})]},l):null})})]})]})}),e.jsxs(gt,{className:"px-4 py-3 border-t bg-background shrink-0",children:[e.jsx(pe,{type:"button",variant:"outline",size:"sm",onClick:t,children:"Cancel"}),e.jsxs(pe,{type:"submit",size:"sm",disabled:m||!C||!a.service_name||!a.service_code,onClick:l=>(l.preventDefault(),Z(l)),children:[m?"Saving...":I?"Update":"Add"," Service"]})]})]})})};function Qe(s,r,t){let i=t.initialDeps??[],n,o=!0;function u(){var a,_,m;let y;t.key&&((a=t.debug)!=null&&a.call(t))&&(y=Date.now());const j=s();if(!(j.length!==i.length||j.some((M,T)=>i[T]!==M)))return n;i=j;let E;if(t.key&&((_=t.debug)!=null&&_.call(t))&&(E=Date.now()),n=r(...j),t.key&&((m=t.debug)!=null&&m.call(t))){const M=Math.round((Date.now()-y)*100)/100,T=Math.round((Date.now()-E)*100)/100,S=T/16,V=(Z,I)=>{for(Z=String(Z);Z.length<I;)Z=" "+Z;return Z};console.info(`%câ± ${V(T,5)} /${V(M,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*S,120))}deg 100% 31%);`,t==null?void 0:t.key)}return t!=null&&t.onChange&&!(o&&t.skipInitialOnChange)&&t.onChange(n),o=!1,n}return u.updateDeps=a=>{i=a},u}function Ds(s,r){if(s===void 0)throw new Error("Unexpected undefined");return s}const Oa=(s,r)=>Math.abs(s-r)<1.01,Ma=(s,r,t)=>{let i;return function(...n){s.clearTimeout(i),i=s.setTimeout(()=>r.apply(this,n),t)}},Ts=s=>{const{offsetWidth:r,offsetHeight:t}=s;return{width:r,height:t}},$a=s=>s,Pa=s=>{const r=Math.max(s.startIndex-s.overscan,0),t=Math.min(s.endIndex+s.overscan,s.count-1),i=[];for(let n=r;n<=t;n++)i.push(n);return i},Fa=(s,r)=>{const t=s.scrollElement;if(!t)return;const i=s.targetWindow;if(!i)return;const n=u=>{const{width:a,height:_}=u;r({width:Math.round(a),height:Math.round(_)})};if(n(Ts(t)),!i.ResizeObserver)return()=>{};const o=new i.ResizeObserver(u=>{const a=()=>{const _=u[0];if(_!=null&&_.borderBoxSize){const m=_.borderBoxSize[0];if(m){n({width:m.inlineSize,height:m.blockSize});return}}n(Ts(t))};s.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(a):a()});return o.observe(t,{box:"border-box"}),()=>{o.unobserve(t)}},Is={passive:!0},Os=typeof window>"u"?!0:"onscrollend"in window,Ha=(s,r)=>{const t=s.scrollElement;if(!t)return;const i=s.targetWindow;if(!i)return;let n=0;const o=s.options.useScrollendEvent&&Os?()=>{}:Ma(i,()=>{r(n,!1)},s.options.isScrollingResetDelay),u=y=>()=>{const{horizontal:j,isRtl:v}=s.options;n=j?t.scrollLeft*(v&&-1||1):t.scrollTop,o(),r(n,y)},a=u(!0),_=u(!1);_(),t.addEventListener("scroll",a,Is);const m=s.options.useScrollendEvent&&Os;return m&&t.addEventListener("scrollend",_,Is),()=>{t.removeEventListener("scroll",a),m&&t.removeEventListener("scrollend",_)}},La=(s,r,t)=>{if(r!=null&&r.borderBoxSize){const i=r.borderBoxSize[0];if(i)return Math.round(i[t.options.horizontal?"inlineSize":"blockSize"])}return s[t.options.horizontal?"offsetWidth":"offsetHeight"]},Ua=(s,{adjustments:r=0,behavior:t},i)=>{var n,o;const u=s+r;(o=(n=i.scrollElement)==null?void 0:n.scrollTo)==null||o.call(n,{[i.options.horizontal?"left":"top"]:u,behavior:t})};class Wa{constructor(r){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const i=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(n=>{n.forEach(o=>{const u=()=>{this._measureElement(o.target,o)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(u):u()})}));return{disconnect:()=>{var n;(n=i())==null||n.disconnect(),t=null},observe:n=>{var o;return(o=i())==null?void 0:o.observe(n,{box:"border-box"})},unobserve:n=>{var o;return(o=i())==null?void 0:o.unobserve(n)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([i,n])=>{typeof n>"u"&&delete t[i]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:$a,rangeExtractor:Pa,onChange:()=>{},measureElement:La,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...t}},this.notify=t=>{var i,n;(n=(i=this.options).onChange)==null||n.call(i,this,t)},this.maybeNotify=Qe(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const i=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==i){if(this.cleanup(),!i){this.maybeNotify();return}this.scrollElement=i,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(n=>{this.observer.observe(n)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,n=>{this.scrollRect=n,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(n,o)=>{this.scrollAdjustments=0,this.scrollDirection=o?this.getScrollOffset()<n?"forward":"backward":null,this.scrollOffset=n,this.isScrolling=o,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,i)=>{const n=new Map,o=new Map;for(let u=i-1;u>=0;u--){const a=t[u];if(n.has(a.lane))continue;const _=o.get(a.lane);if(_==null||a.end>_.end?o.set(a.lane,a):a.end<_.end&&n.set(a.lane,!0),n.size===this.options.lanes)break}return o.size===this.options.lanes?Array.from(o.values()).sort((u,a)=>u.end===a.end?u.index-a.index:u.end-a.end)[0]:void 0},this.getMeasurementOptions=Qe(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(t,i,n,o,u,a)=>(this.prevLanes!==void 0&&this.prevLanes!==a&&(this.lanesChangedFlag=!0),this.prevLanes=a,this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:i,scrollMargin:n,getItemKey:o,enabled:u,lanes:a}),{key:!1,skipInitialOnChange:!0,onChange:()=>{this.notify(this.isScrolling)}}),this.getMeasurements=Qe(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:i,scrollMargin:n,getItemKey:o,enabled:u,lanes:a},_)=>{if(!u)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>t)for(const v of this.laneAssignments.keys())v>=t&&this.laneAssignments.delete(v);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(v=>{this.itemSizeCache.set(v.key,v.size)}));const m=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===t&&(this.lanesSettling=!1);const y=this.measurementsCache.slice(0,m),j=new Array(a).fill(void 0);for(let v=0;v<m;v++){const E=y[v];E&&(j[E.lane]=v)}for(let v=m;v<t;v++){const E=o(v),M=this.laneAssignments.get(v);let T,S;if(M!==void 0&&this.options.lanes>1){T=M;const C=j[T],l=C!==void 0?y[C]:void 0;S=l?l.end+this.options.gap:i+n}else{const C=this.options.lanes===1?y[v-1]:this.getFurthestMeasurement(y,v);S=C?C.end+this.options.gap:i+n,T=C?C.lane:v%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(v,T)}const V=_.get(E),Z=typeof V=="number"?V:this.options.estimateSize(v),I=S+Z;y[v]={index:v,start:S,size:Z,end:I,key:E,lane:T},j[T]=v}return this.measurementsCache=y,y},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Qe(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(t,i,n,o)=>this.range=t.length>0&&i>0?za({measurements:t,outerSize:i,scrollOffset:n,lanes:o}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Qe(()=>{let t=null,i=null;const n=this.calculateRange();return n&&(t=n.startIndex,i=n.endIndex),this.maybeNotify.updateDeps([this.isScrolling,t,i]),[this.options.rangeExtractor,this.options.overscan,this.options.count,t,i]},(t,i,n,o,u)=>o===null||u===null?[]:t({startIndex:o,endIndex:u,overscan:i,count:n}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=t=>{const i=this.options.indexAttribute,n=t.getAttribute(i);return n?parseInt(n,10):(console.warn(`Missing attribute name '${i}={index}' on measured element.`),-1)},this._measureElement=(t,i)=>{const n=this.indexFromElement(t),o=this.measurementsCache[n];if(!o)return;const u=o.key,a=this.elementsCache.get(u);a!==t&&(a&&this.observer.unobserve(a),this.observer.observe(t),this.elementsCache.set(u,t)),t.isConnected&&this.resizeItem(n,this.options.measureElement(t,i,this))},this.resizeItem=(t,i)=>{const n=this.measurementsCache[t];if(!n)return;const o=this.itemSizeCache.get(n.key)??n.size,u=i-o;u!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(n,u,this):n.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=u,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(n.index),this.itemSizeCache=new Map(this.itemSizeCache.set(n.key,i)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((i,n)=>{i.isConnected||(this.observer.unobserve(i),this.elementsCache.delete(n))});return}this._measureElement(t,void 0)},this.getVirtualItems=Qe(()=>[this.getVirtualIndexes(),this.getMeasurements()],(t,i)=>{const n=[];for(let o=0,u=t.length;o<u;o++){const a=t[o],_=i[a];n.push(_)}return n},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const i=this.getMeasurements();if(i.length!==0)return Ds(i[En(0,i.length-1,n=>Ds(i[n]).start,t)])},this.getOffsetForAlignment=(t,i,n=0)=>{const o=this.getSize(),u=this.getScrollOffset();i==="auto"&&(i=t>=u+o?"end":"start"),i==="center"?t+=(n-o)/2:i==="end"&&(t-=o);const a=this.getTotalSize()+this.options.scrollMargin-o;return Math.max(Math.min(a,t),0)},this.getOffsetForIndex=(t,i="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const n=this.measurementsCache[t];if(!n)return;const o=this.getSize(),u=this.getScrollOffset();if(i==="auto")if(n.end>=u+o-this.options.scrollPaddingEnd)i="end";else if(n.start<=u+this.options.scrollPaddingStart)i="start";else return[u,i];const a=i==="end"?n.end+this.options.scrollPaddingEnd:n.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,i,n.size),i]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(t,{align:i="start",behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,i),{adjustments:void 0,behavior:n})},this.scrollToIndex=(t,{align:i="auto",behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),t=Math.max(0,Math.min(t,this.options.count-1));let o=0;const u=10,a=m=>{if(!this.targetWindow)return;const y=this.getOffsetForIndex(t,m);if(!y){console.warn("Failed to get offset for index:",t);return}const[j,v]=y;this._scrollToOffset(j,{adjustments:void 0,behavior:n}),this.targetWindow.requestAnimationFrame(()=>{const E=this.getScrollOffset(),M=this.getOffsetForIndex(t,v);if(!M){console.warn("Failed to get offset for index:",t);return}Oa(M[0],E)||_(v)})},_=m=>{this.targetWindow&&(o++,o<u?this.targetWindow.requestAnimationFrame(()=>a(m)):console.warn(`Failed to scroll to index ${t} after ${u} attempts.`))};a(i)},this.scrollBy=(t,{behavior:i}={})=>{i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:i})},this.getTotalSize=()=>{var t;const i=this.getMeasurements();let n;if(i.length===0)n=this.options.paddingStart;else if(this.options.lanes===1)n=((t=i[i.length-1])==null?void 0:t.end)??0;else{const o=Array(this.options.lanes).fill(null);let u=i.length-1;for(;u>=0&&o.some(a=>a===null);){const a=i[u];o[a.lane]===null&&(o[a.lane]=a.end),u--}n=Math.max(...o.filter(a=>a!==null))}return Math.max(n-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:i,behavior:n})=>{this.options.scrollToFn(t,{behavior:n,adjustments:i},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(r)}}const En=(s,r,t,i)=>{for(;s<=r;){const n=(s+r)/2|0,o=t(n);if(o<i)s=n+1;else if(o>i)r=n-1;else return n}return s>0?s-1:0};function za({measurements:s,outerSize:r,scrollOffset:t,lanes:i}){const n=s.length-1,o=_=>s[_].start;if(s.length<=i)return{startIndex:0,endIndex:n};let u=En(0,n,o,t),a=u;if(i===1)for(;a<n&&s[a].end<t+r;)a++;else if(i>1){const _=Array(i).fill(0);for(;a<n&&_.some(y=>y<t+r);){const y=s[a];_[y.lane]=y.end,a++}const m=Array(i).fill(t+r);for(;u>=0&&m.some(y=>y>=t);){const y=s[u];m[y.lane]=y.start,u--}u=Math.max(0,u-u%i),a=Math.min(n,a+(i-1-a%i))}return{startIndex:u,endIndex:a}}const Ms=typeof document<"u"?c.useLayoutEffect:c.useEffect;function Va(s){const r=c.useReducer(()=>({}),{})[1],t={...s,onChange:(n,o)=>{var u;o?rr.flushSync(r):r(),(u=s.onChange)==null||u.call(s,n,o)}},[i]=c.useState(()=>new Wa(t));return i.setOptions(t),Ms(()=>i._didMount(),[]),Ms(()=>i._willUpdate()),i}function Sn(s){return Va({observeElementRect:Fa,observeElementOffset:Ha,scrollToFn:Ua,...s})}function Za(s){const r=new Map;for(const t of s){const i=`${t.service_id}:${t.zone_id}:${t.min_weight??0}:${t.max_weight??0}`;r.set(i,{rate:t.rate,cost:t.cost})}return r}function Ga(s){const r=new Set,t=[];for(const i of s){const n=i.min_weight??0,o=i.max_weight??0;if(n===0&&o===0)continue;const u=`${n}:${o}`;r.has(u)||(r.add(u),t.push({min_weight:n,max_weight:o}))}return t.sort((i,n)=>i.max_weight-n.max_weight)}const Ba=Te.memo(({value:s,onSave:r,disabled:t=!1})=>{const[i,n]=c.useState(!1),[o,u]=c.useState((s==null?void 0:s.toString())||""),[a,_]=c.useState((s==null?void 0:s.toString())||""),m=c.useRef(null);c.useEffect(()=>{_((s==null?void 0:s.toString())||""),i||u((s==null?void 0:s.toString())||"")},[s,i]),c.useEffect(()=>{i&&m.current&&(m.current.focus(),m.current.select())},[i]);const y=()=>{o!==a&&(r(o),_(o)),n(!1)},j=v=>{v.key==="Enter"?y():v.key==="Escape"&&(u(a),n(!1))};return i?e.jsx("input",{ref:m,type:"number",step:"any",min:"0",value:o,onChange:v=>u(v.target.value),onBlur:y,onKeyDown:j,disabled:t,className:"w-full h-full p-0 border-none outline-none ring-0 text-center text-sm text-foreground relative z-20 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary bg-background"}):e.jsx("div",{className:de("w-full h-full px-2 py-2 text-center text-sm text-muted-foreground cursor-pointer hover:bg-accent flex items-center justify-center",t&&"cursor-not-allowed opacity-50"),onClick:()=>!t&&n(!0),title:t?"Read only":"Click to edit",children:e.jsx("span",{children:a!==""&&!isNaN(Number(a))?Number(a).toFixed(2):"-"})})});Ba.displayName="EditableCell";const St=(s,r,t)=>s===0?`Up to ${r} ${t}`:`${s} â€“ ${r} ${t}`;function qa({onAddWeightRange:s,weightUnit:r,weightRangePresets:t,onAddFromPreset:i,missingRanges:n,onAddMissingRange:o,align:u="start"}){return e.jsxs(_t,{children:[e.jsx(vt,{asChild:!0,children:e.jsxs("button",{className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-primary hover:bg-accent rounded-md transition-colors",children:[e.jsx(Fe,{className:"h-3 w-3"}),"Add Weight Range"]})}),e.jsx(nt,{align:u,className:"w-60 p-2",sideOffset:8,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground px-2 py-1",children:"Add weight range"}),n&&n.length>0&&o&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-muted-foreground px-2 py-0.5",children:"Missing from this service"}),e.jsx("div",{className:"max-h-32 overflow-y-auto space-y-0.5",children:n.map(a=>e.jsx("button",{onClick:()=>o(a.min_weight,a.max_weight),className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors truncate text-amber-600 dark:text-amber-400",title:St(a.min_weight,a.max_weight,r),children:St(a.min_weight,a.max_weight,r)},`${a.min_weight}-${a.max_weight}`))}),e.jsx("div",{className:"border-t border-border my-1"})]}),t&&t.length>0&&i&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-muted-foreground px-2 py-0.5",children:"Carrier presets"}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-0.5",children:t.map(a=>e.jsx("button",{onClick:()=>i(a.min_weight,a.max_weight),className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors truncate",title:St(a.min_weight,a.max_weight,r),children:St(a.min_weight,a.max_weight,r)},`${a.min_weight}-${a.max_weight}`))}),e.jsx("div",{className:"border-t border-border my-1"})]}),e.jsxs("button",{onClick:s,className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors flex items-center gap-1.5 text-primary font-medium",children:[e.jsx(Fe,{className:"h-3.5 w-3.5"}),"Custom range"]})]})})]})}const Nn=Te.memo(({value:s,onSave:r})=>{const[t,i]=c.useState(!1),[n,o]=c.useState((s==null?void 0:s.toString())||""),[u,a]=c.useState((s==null?void 0:s.toString())||""),_=c.useRef(null);c.useEffect(()=>{a((s==null?void 0:s.toString())||""),t||o((s==null?void 0:s.toString())||"")},[s,t]),c.useEffect(()=>{t&&_.current&&(_.current.focus(),_.current.select())},[t]);const m=()=>{const j=n.trim(),v=parseFloat(j);j===""||isNaN(v)?o(u):n!==u&&(r(n),a(n)),i(!1)},y=j=>{j.key==="Enter"?m():j.key==="Escape"&&(o(u),i(!1))};return t?e.jsx("input",{ref:_,type:"number",step:"any",min:"0",value:n,onChange:j=>o(j.target.value),onBlur:m,onKeyDown:y,className:"w-full h-full p-0 border-none outline-none ring-0 text-center text-sm text-foreground relative z-20 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary bg-background"}):e.jsx("div",{className:"w-full h-full px-2 py-2 text-center text-sm text-muted-foreground cursor-pointer hover:bg-accent flex items-center justify-center",onClick:()=>i(!0),title:"Click to edit",children:e.jsx("span",{children:u!==""&&!isNaN(Number(u))?Number(u).toFixed(2):"-"})})});Nn.displayName="EditableCell";function Ka({service:s,sharedZones:r,serviceRates:t,weightRanges:i,serviceFilteredWeightRanges:n,weightUnit:o,onCellEdit:u,onDeleteRate:a,onAddWeightRange:_,onRemoveWeightRange:m,onEditWeightRange:y,onEditZone:j,onDeleteZone:v,onAssignZoneToService:E,onCreateNewZone:M,onRemoveZoneFromService:T,missingRanges:S,onAddMissingRange:V,weightRangePresets:Z,onAddFromPreset:I}){const C=c.useRef(null),[l,g]=c.useState(!1),A=s.zone_ids||[],B=c.useMemo(()=>r.filter(p=>A.includes(p.id)),[r,A]),$=c.useMemo(()=>r.filter(p=>!A.includes(p.id)),[r,A]),xe=c.useMemo(()=>Za(t),[t]),me=n??i,Ne=c.useMemo(()=>me.length===0?[{min_weight:0,max_weight:0}]:me,[me]),ve=Sn({count:Ne.length,getScrollElement:()=>C.current,estimateSize:()=>40,overscan:10}),fe=!!(E||M),he=200,se=140,ie=40,Re=he+B.length*se+(fe?ie:0),Oe=p=>{var z;const k=[];return(z=p.country_codes)!=null&&z.length&&k.push(`Countries: ${p.country_codes.join(", ")}`),p.transit_days!=null&&k.push(`Transit: ${p.transit_days} days`),k.length>0?k.join(`
`):p.label||""},Ge=p=>{const k=t.filter(G=>G.service_id===s.id&&G.min_weight===p.min_weight&&G.max_weight===p.max_weight&&G.rate!=null&&G.rate>0),z=k.length;if(z===0)return"No rates set";const F=k.reduce((G,Y)=>G+(Y.rate??0),0)/z;return`${z} rate${z!==1?"s":""}, avg ${F.toFixed(2)}`};if(B.length===0)return e.jsx("div",{className:"flex-1 flex items-center justify-center text-muted-foreground bg-muted/50 rounded border-2 border-dashed",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-sm",children:"No zones assigned to this service"}),fe&&e.jsx("button",{onClick:()=>M?M(s.id):E==null?void 0:E(s.id,""),className:"mt-2 text-xs text-primary hover:underline",children:"+ Add zone"})]})});const He=(p,k)=>k?"Flat rate":p.min_weight===0?`Up to ${p.max_weight} ${o}`:`${p.min_weight} â€“ ${p.max_weight} ${o}`;return e.jsx(Or,{delayDuration:300,children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex-1 flex flex-col border border-border rounded-md bg-background overflow-hidden",children:e.jsx("div",{ref:C,className:"flex-1 overflow-auto",children:e.jsxs("div",{style:{minWidth:`${Re}px`},children:[e.jsxs("div",{className:"flex border-b border-border bg-muted font-medium text-sm text-foreground sticky top-0 z-30 shadow-sm",children:[e.jsxs("div",{className:"p-3 border-r border-border flex-shrink-0 bg-muted sticky left-0 z-40 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",style:{width:`${he}px`},children:["Weight (",o,")"]}),B.map((p,k)=>e.jsx("div",{className:"p-3 border-r border-border flex-shrink-0 bg-muted group/zone",style:{width:`${se}px`},children:e.jsxs("div",{className:"flex items-center justify-center gap-0.5",children:[e.jsxs(Ss,{children:[e.jsx(Ns,{asChild:!0,children:e.jsx("span",{className:"truncate text-center flex-1 min-w-0 cursor-default",children:p.label||`Zone ${k+1}`})}),e.jsx(Cs,{side:"bottom",className:"max-w-xs text-xs whitespace-pre-line",children:Oe(p)})]}),e.jsxs("div",{className:"flex items-center gap-0 opacity-0 group-hover/zone:opacity-100 transition-all flex-shrink-0 bg-muted",children:[j&&e.jsx("button",{onClick:()=>j(p),className:"p-0.5 rounded-sm text-muted-foreground hover:text-primary hover:bg-accent/50",title:`Edit ${p.label||"zone"}`,children:e.jsx($t,{className:"h-3 w-3"})}),v&&e.jsx("button",{onClick:()=>v(p.label),className:"p-0.5 rounded-sm text-muted-foreground hover:text-destructive hover:bg-destructive/10",title:`Delete ${p.label||"zone"}`,children:e.jsx(Pt,{className:"h-3 w-3"})}),T&&e.jsx("button",{onClick:()=>T(s.id,p.id),className:"p-0.5 rounded-sm text-muted-foreground hover:text-destructive hover:bg-destructive/10",title:`Remove ${p.label||"zone"} from this service`,children:e.jsx(tt,{className:"h-3 w-3"})})]})]})},p.id||k)),fe&&e.jsx("div",{className:"flex-shrink-0 bg-muted flex items-center justify-center border-r border-border",style:{width:`${ie}px`},children:e.jsxs(_t,{open:l,onOpenChange:g,children:[e.jsx(vt,{asChild:!0,children:e.jsx("button",{className:"p-1 text-muted-foreground hover:text-primary transition-colors",title:"Add zone to this service",children:e.jsx(Fe,{className:"h-3.5 w-3.5"})})}),e.jsx(nt,{align:"start",className:"w-56 p-2",sideOffset:8,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground px-2 py-1",children:"Add zone"}),$.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-0.5",children:$.map(p=>e.jsx("button",{onClick:()=>{E==null||E(s.id,p.id),g(!1)},className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors truncate",title:p.label,children:p.label||p.id},p.id))}),e.jsx("div",{className:"border-t border-border my-1"})]}),M&&e.jsxs("button",{onClick:()=>{M(s.id),g(!1)},className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors flex items-center gap-1.5 text-primary font-medium",children:[e.jsx(Fe,{className:"h-3.5 w-3.5"}),"Create new zone"]})]})})]})})]}),e.jsx("div",{style:{height:`${ve.getTotalSize()}px`,position:"relative"},children:ve.getVirtualItems().map(p=>{const k=Ne[p.index],z=k.min_weight===0&&k.max_weight===0;return e.jsxs("div",{className:"absolute top-0 left-0 w-full flex border-b border-border group hover:bg-muted/50 transition-colors",style:{height:`${p.size}px`,transform:`translateY(${p.start}px)`},children:[e.jsxs("div",{className:"px-3 py-2 border-r border-border flex-shrink-0 bg-background sticky left-0 z-20 flex items-center justify-between shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",style:{width:`${he}px`},children:[e.jsxs(Ss,{children:[e.jsx(Ns,{asChild:!0,children:e.jsx("span",{className:"text-sm text-foreground cursor-default",children:He(k,z)})}),!z&&e.jsx(Cs,{side:"right",className:"text-xs",children:Ge(k)})]}),e.jsxs("div",{className:"flex items-center gap-0 opacity-0 group-hover:opacity-100 transition-opacity",children:[y&&!z&&e.jsx("button",{onClick:()=>y(k),className:"p-0.5 text-muted-foreground hover:text-primary",title:"Edit weight range",children:e.jsx($t,{className:"h-3 w-3"})}),m&&!z&&e.jsx("button",{onClick:()=>m(k.min_weight,k.max_weight),className:"p-0.5 text-muted-foreground hover:text-destructive",title:"Remove weight range",children:e.jsx(Pt,{className:"h-3 w-3"})})]})]}),B.map(F=>{const G=`${s.id}:${F.id}:${k.min_weight}:${k.max_weight}`,Y=xe.get(G),ue=(Y==null?void 0:Y.rate)!=null&&Y.rate>0;return e.jsxs("div",{className:"border-r border-border flex-shrink-0 relative group/cell",style:{width:`${se}px`},children:[e.jsx(Nn,{value:(Y==null?void 0:Y.rate)??null,onSave:ne=>{const Q=parseFloat(ne);isNaN(Q)||u(s.id,F.id,k.min_weight,k.max_weight,Q)}}),a&&ue&&e.jsx("button",{onClick:ne=>{ne.stopPropagation(),a(s.id,F.id,k.min_weight,k.max_weight)},className:"absolute inset-y-0 right-px my-auto h-4 w-4 flex items-center justify-center opacity-0 group-hover/cell:opacity-100 text-muted-foreground hover:text-destructive transition-opacity z-10",title:"Delete rate",children:e.jsx(tt,{className:"h-2.5 w-2.5"})})]},F.id)}),fe&&e.jsx("div",{className:"flex-shrink-0",style:{width:`${ie}px`}})]},p.key)})})]})})}),_&&e.jsx("div",{className:"flex items-center gap-2 mt-2 pt-2 border-t border-border",children:e.jsx(qa,{onAddWeightRange:_,weightUnit:o,weightRangePresets:Z,onAddFromPreset:I,missingRanges:S,onAddMissingRange:V})})]})})}function Ya({open:s,onOpenChange:r,existingRanges:t,weightUnit:i,onAdd:n,isLoading:o=!1}){const[u,a]=c.useState(""),[_,m]=c.useState(null),y=t.length>0?Math.max(...t.map(v=>v.max_weight)):0,j=()=>{m(null);const v=parseFloat(u);if(isNaN(v)||v<=0){m("Max weight must be a positive number");return}if(v<=y){m(`Max weight must be greater than ${y} ${i}`);return}if(t.some(M=>y<M.max_weight&&v>M.min_weight)){m("This weight range overlaps with an existing range");return}n(y,v),a(""),m(null),r(!1)};return e.jsx(Nt,{open:s,onOpenChange:r,children:e.jsxs(Ct,{children:[e.jsxs(Rt,{children:[e.jsx(At,{children:"Add Weight Range"}),e.jsx(kt,{children:"Add a new weight bracket to the rate grid. Rates will be initialized to 0 for all service-zone combinations."})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{children:[e.jsxs(W,{children:["Min Weight (",i,")"]}),e.jsx(te,{value:y,disabled:!0,className:"mt-1"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Auto-derived from the previous range"})]}),e.jsxs("div",{children:[e.jsxs(W,{children:["Max Weight (",i,")"]}),e.jsx(te,{type:"number",step:"any",min:y+.01,value:u,onChange:v=>a(v.target.value),onKeyDown:v=>{v.key==="Enter"&&(v.preventDefault(),j())},placeholder:`e.g., ${y+5}`,className:"mt-1",autoFocus:!0}),_&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:_})]})]}),e.jsxs(Dt,{children:[e.jsx(Tt,{children:"Cancel"}),e.jsx(It,{onClick:j,disabled:o||!u,children:o?"Adding...":"Add Range"})]})]})})}function $s({services:s,onAddService:r,servicePresets:t,onAddServiceFromPreset:i,onCloneService:n,align:o="end",iconOnly:u=!1}){return e.jsxs(_t,{children:[e.jsx(vt,{asChild:!0,children:u?e.jsx("button",{className:"p-1.5 text-muted-foreground hover:text-primary hover:bg-accent rounded-md transition-colors",title:"Add service",children:e.jsx(Fe,{className:"h-4 w-4"})}):e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 rounded-md transition-colors",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Add Service"]})}),e.jsx(nt,{align:o,className:"w-56 p-2",sideOffset:8,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground px-2 py-1",children:"Add service"}),t&&t.length>0&&i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-0.5",children:t.map(a=>e.jsx("button",{onClick:()=>i(a.code),className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors truncate",title:a.name,children:a.name||a.code},a.code))}),e.jsx("div",{className:"border-t border-border my-1"})]}),s.length>0&&n&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-muted-foreground px-2 py-0.5",children:"Clone existing"}),e.jsx("div",{className:"max-h-32 overflow-y-auto space-y-0.5",children:s.map(a=>e.jsx("button",{onClick:()=>n(a),className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors truncate text-muted-foreground",title:`Clone ${a.service_name}`,children:a.service_name||a.service_code},a.id))}),e.jsx("div",{className:"border-t border-border my-1"})]}),e.jsxs("button",{onClick:r,className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors flex items-center gap-1.5 text-primary font-medium",children:[e.jsx(Fe,{className:"h-3.5 w-3.5"}),"Create new service"]})]})})]})}function Qa({open:s,onOpenChange:r,weightRange:t,existingRanges:i,weightUnit:n,onSave:o,isLoading:u=!1}){const[a,_]=c.useState(""),[m,y]=c.useState(null);if(c.useEffect(()=>{s&&t&&(_(t.max_weight.toString()),y(null))},[s,t]),!t)return null;const j=E=>{E==null||E.preventDefault(),y(null);const M=parseFloat(a);if(isNaN(M)||M<=0){y("Max weight must be a positive number");return}if(M<=t.min_weight){y(`Max weight must be greater than ${t.min_weight} ${n}`);return}if(i.filter(V=>!(V.min_weight===t.min_weight&&V.max_weight===t.max_weight)).some(V=>t.min_weight<V.max_weight&&M>V.min_weight)){y("This weight range would overlap with an existing range");return}o(t.min_weight,t.max_weight,M),r(!1)},v=E=>{E.key==="Enter"&&(E.preventDefault(),j())};return e.jsx(mt,{open:s,onOpenChange:r,children:e.jsxs(ht,{className:"max-w-sm",children:[e.jsxs(xt,{children:[e.jsx(ft,{children:"Edit Weight Range"}),e.jsx(Ft,{children:"Modify the max weight for this bracket. Existing rates will be re-keyed automatically."})]}),e.jsx(Ht,{children:e.jsxs("form",{id:"edit-weight-range-form",onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(W,{className:"text-xs",children:["Min Weight (",n,")"]}),e.jsx(te,{type:"number",value:t.min_weight,disabled:!0,className:"h-9 bg-muted text-muted-foreground"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(W,{className:"text-xs",children:["Max Weight (",n,")"]}),e.jsx(te,{type:"number",step:"any",min:t.min_weight+.01,value:a,onChange:E=>_(E.target.value),onKeyDown:v,className:"h-9",autoFocus:!0}),m&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:m})]})]})}),e.jsxs(gt,{children:[e.jsx(pe,{type:"button",variant:"outline",size:"sm",onClick:()=>r(!1),children:"Cancel"}),e.jsx(pe,{type:"submit",size:"sm",form:"edit-weight-range-form",disabled:u||!a,children:u?"Saving...":"Save"})]})]})})}function Xa(...s){return s.filter(Boolean).join(" ")}function Ja({surcharges:s,services:r,onEditSurcharge:t,onAddSurcharge:i,onRemoveSurcharge:n,surchargePresets:o,onAddSurchargeFromPreset:u,onCloneSurcharge:a}){const _=v=>r.filter(E=>{var M;return(M=E.surcharge_ids)==null?void 0:M.includes(v)}).length,m=v=>v.surcharge_type==="percentage"?`${v.amount??0}%`:`${v.amount??0}`,y=v=>v.surcharge_type==="percentage"?"Percentage":"Fixed Amount",j=({align:v="end"})=>e.jsxs(_t,{children:[e.jsx(vt,{asChild:!0,children:e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 rounded-md transition-colors",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Add Surcharge"]})}),e.jsx(nt,{align:v,className:"w-56 p-2",sideOffset:8,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground px-2 py-1",children:"Add surcharge"}),o&&o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-0.5",children:o.map(E=>e.jsx("button",{onClick:()=>u==null?void 0:u(E.id),className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors truncate",title:`${E.name} (${E.surcharge_type==="percentage"?`${E.amount}%`:E.amount})`,children:E.name},E.id))}),e.jsx("div",{className:"border-t border-border my-1"})]}),s.length>0&&a&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-muted-foreground px-2 py-0.5",children:"Clone existing"}),e.jsx("div",{className:"max-h-32 overflow-y-auto space-y-0.5",children:s.map(E=>e.jsx("button",{onClick:()=>a(E),className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors truncate text-muted-foreground",title:`Clone ${E.name}`,children:E.name||"Unnamed"},E.id))}),e.jsx("div",{className:"border-t border-border my-1"})]}),e.jsxs("button",{onClick:i,className:"w-full text-left px-2 py-1.5 text-sm rounded-md hover:bg-accent transition-colors flex items-center gap-1.5 text-primary font-medium",children:[e.jsx(Fe,{className:"h-3.5 w-3.5"}),"Create new surcharge"]})]})})]});return s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground p-8",children:[e.jsx("p",{className:"mb-4",children:"No surcharges configured yet."}),e.jsx(j,{align:"center"})]}):e.jsxs("div",{className:"space-y-4 h-full overflow-y-auto pr-2",children:[e.jsxs("div",{className:"flex items-center justify-between sticky top-0 bg-background z-10 py-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Surcharge Configuration"}),e.jsx(j,{})]}),s.map((v,E)=>{const M=_(v.id);return e.jsx("div",{className:"bg-card border border-border rounded-lg shadow-sm hover:border-primary/50 transition-colors",children:e.jsxs("div",{className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-semibold text-foreground text-base",children:v.name||`Surcharge ${E+1}`}),e.jsx("span",{className:Xa("inline-flex items-center px-2.5 py-1 rounded-md text-xs font-semibold",v.active?"bg-green-500 text-white dark:bg-green-600 dark:text-white":"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300"),children:v.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>t(v),className:"p-1.5 text-muted-foreground hover:text-foreground hover:bg-accent rounded transition-colors",title:"Edit Surcharge",children:e.jsx($t,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>n(v.id),className:"p-1.5 text-muted-foreground hover:text-destructive hover:bg-destructive/10 rounded transition-colors",title:"Delete Surcharge",children:e.jsx(Pt,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground whitespace-nowrap",children:"Type:"}),e.jsx("div",{className:"text-sm font-semibold text-foreground",children:y(v)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground whitespace-nowrap",children:"Amount:"}),e.jsx("div",{className:"text-sm font-semibold text-foreground",children:m(v)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground whitespace-nowrap",children:"Cost (COGS):"}),e.jsx("div",{className:"text-sm font-semibold text-foreground",children:v.cost!=null?v.cost:"â€”"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground whitespace-nowrap",children:"Linked Services:"}),e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[M," of ",r.length]})]})]})]})},v.id)})]})}function el({open:s,onOpenChange:r,zone:t,onSave:i,countryOptions:n,services:o,onToggleServiceZone:u}){const[a,_]=c.useState(""),[m,y]=c.useState([]),[j,v]=c.useState(""),[E,M]=c.useState(""),[T,S]=c.useState("");c.useEffect(()=>{var C,l,g;t&&s&&(_(t.label||""),y(t.country_codes||[]),v(((C=t.cities)==null?void 0:C.join(", "))||""),M(((l=t.postal_codes)==null?void 0:l.join(", "))||""),S(((g=t.transit_days)==null?void 0:g.toString())||""))},[t,s]);const V=C=>{const l=o.find(g=>g.id===C);return!l||!t?!1:(l.zones||[]).some(g=>g.id===t.id||g.label===t.label)},Z=()=>t?o.filter(C=>(C.zones||[]).some(l=>l.id===t.id||l.label===t.label)).length:0,I=C=>{if(C.preventDefault(),!t)return;const l=t.label||t.id,g=j.split(",").map(xe=>xe.trim()).filter(Boolean),A=E.split(",").map(xe=>xe.trim()).filter(Boolean),B=T?parseInt(T,10):null,$=B!==null&&B<0?0:B;i(l,{label:a,country_codes:Array.from(new Set(m.map(xe=>xe.toUpperCase()))),cities:g,postal_codes:A,transit_days:$}),r(!1)};return e.jsx(mt,{open:s,onOpenChange:r,children:e.jsxs(ht,{className:"max-w-lg",children:[e.jsxs(xt,{children:[e.jsx(ft,{children:"Edit Zone"}),e.jsx(Ft,{children:"Configure zone details and linked services"})]}),e.jsx(Ht,{children:e.jsxs("form",{id:"zone-form",onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Label"}),e.jsx(te,{value:a,onChange:C=>_(C.target.value),placeholder:"Zone 1",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Transit Days"}),e.jsx(te,{type:"number",min:0,value:T,onChange:C=>S(C.target.value),placeholder:"2",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Country Codes"}),e.jsx(Wt,{options:n,value:m,onValueChange:y,placeholder:"Select countries"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Cities (comma separated)"}),e.jsx(te,{value:j,onChange:C=>v(C.target.value),placeholder:"New York, Toronto",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Postal Codes (comma separated)"}),e.jsx(te,{value:E,onChange:C=>M(C.target.value),placeholder:"10001, 94105",className:"h-9"})]}),o.length>0&&u&&t&&e.jsxs("div",{className:"pt-3 border-t border-border",children:[e.jsxs(W,{className:"text-xs text-muted-foreground block mb-2",children:["Linked Services (",Z()," of ",o.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:o.map(C=>{const l=V(C.id),g=`zone-svc-${C.id}`;return e.jsxs("label",{htmlFor:g,className:"flex items-center gap-2.5 px-2 py-1.5 rounded-md hover:bg-accent cursor-pointer transition-colors",children:[e.jsx(ze,{id:g,checked:l,onCheckedChange:A=>u(C.id,t.id,A===!0)}),e.jsx("span",{className:"text-sm text-foreground",children:C.service_name||C.service_code})]},C.id)})})]})]})}),e.jsxs(gt,{children:[e.jsx(pe,{type:"button",variant:"outline",size:"sm",onClick:()=>r(!1),children:"Cancel"}),e.jsx(pe,{type:"submit",size:"sm",form:"zone-form",children:"Save"})]})]})})}const tl=[{value:"fixed",label:"Fixed Amount"},{value:"percentage",label:"Percentage"}];function sl({open:s,onOpenChange:r,surcharge:t,onSave:i,services:n,onToggleServiceSurcharge:o}){const[u,a]=c.useState(""),[_,m]=c.useState("fixed"),[y,j]=c.useState("0"),[v,E]=c.useState(""),[M,T]=c.useState(!0);c.useEffect(()=>{var I,C;t&&s&&(a(t.name||""),m(t.surcharge_type||"fixed"),j(((I=t.amount)==null?void 0:I.toString())||"0"),E(((C=t.cost)==null?void 0:C.toString())||""),T(t.active??!0))},[t,s]);const S=I=>{var l;if(!t)return!1;const C=n.find(g=>g.id===I);return((l=C==null?void 0:C.surcharge_ids)==null?void 0:l.includes(t.id))??!1},V=()=>t?n.filter(I=>{var C;return(C=I.surcharge_ids)==null?void 0:C.includes(t.id)}).length:0,Z=I=>{I.preventDefault(),t&&(i(t.id,{name:u,surcharge_type:_,amount:parseFloat(y)||0,cost:v?parseFloat(v):null,active:M}),r(!1))};return e.jsx(mt,{open:s,onOpenChange:r,children:e.jsxs(ht,{className:"max-w-lg",children:[e.jsxs(xt,{children:[e.jsx(ft,{children:"Edit Surcharge"}),e.jsx(Ft,{children:"Configure surcharge details and linked services"})]}),e.jsx(Ht,{children:e.jsxs("form",{id:"surcharge-form",onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Name"}),e.jsx(te,{value:u,onChange:I=>a(I.target.value),placeholder:"Fuel Surcharge",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Type"}),e.jsxs(ye,{value:_,onValueChange:m,children:[e.jsx(je,{className:"w-full h-9",children:e.jsx(we,{placeholder:"Select type"})}),e.jsx(Ee,{children:tl.map(I=>e.jsx(Se,{value:I.value,children:I.label},I.value))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(W,{className:"text-xs",children:["Amount ",_==="percentage"?"(%)":""]}),e.jsx(te,{type:"number",step:"0.01",value:y,onChange:I=>j(I.target.value),placeholder:"0.00",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Cost (COGS)"}),e.jsx(te,{type:"number",step:"0.01",value:v,onChange:I=>E(I.target.value),placeholder:"0.00",className:"h-9"})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-1",children:[e.jsx(ze,{id:"surcharge-active",checked:M,onCheckedChange:I=>T(I===!0)}),e.jsx(W,{htmlFor:"surcharge-active",className:"text-xs cursor-pointer",children:"Active"})]}),n.length>0&&t&&e.jsxs("div",{className:"pt-3 border-t border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(W,{className:"text-xs text-muted-foreground",children:["Linked Services (",V()," of ",n.length,")"]}),e.jsx("button",{type:"button",onClick:()=>{const I=V()===n.length;n.forEach(C=>{const l=S(C.id);I&&l?o(C.id,t.id,!1):!I&&!l&&o(C.id,t.id,!0)})},className:"text-xs text-primary hover:text-primary/80 font-medium",children:V()===n.length?"Deselect All":"Select All"})]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:n.map(I=>{const C=S(I.id),l=`surch-svc-${I.id}`;return e.jsxs("label",{htmlFor:l,className:"flex items-center gap-2.5 px-2 py-1.5 rounded-md hover:bg-accent cursor-pointer transition-colors",children:[e.jsx(ze,{id:l,checked:C,onCheckedChange:g=>o(I.id,t.id,g===!0)}),e.jsx("span",{className:"text-sm text-foreground",children:I.service_name||I.service_code})]},I.id)})})]})]})}),e.jsxs(gt,{children:[e.jsx(pe,{type:"button",variant:"outline",size:"sm",onClick:()=>r(!1),children:"Cancel"}),e.jsx(pe,{type:"submit",size:"sm",form:"surcharge-form",children:"Save"})]})]})})}function nl({open:s,onOpenChange:r,serviceRate:t,onSave:i,services:n,sharedZones:o,weightUnit:u}){var I,C;const[a,_]=c.useState(""),[m,y]=c.useState(""),[j,v]=c.useState(""),[E,M]=c.useState("");c.useEffect(()=>{var l,g,A,B;t&&s&&(_(((l=t.rate)==null?void 0:l.toString())||"0"),y(((g=t.cost)==null?void 0:g.toString())||""),v(((A=t.transit_days)==null?void 0:A.toString())||""),M(((B=t.transit_time)==null?void 0:B.toString())||""))},[t,s]);const T=t?((I=n.find(l=>l.id===t.service_id))==null?void 0:I.service_name)||t.service_id:"",S=t?((C=o.find(l=>l.id===t.zone_id))==null?void 0:C.label)||t.zone_id:"",V=t?t.min_weight===0&&t.max_weight===0?"Flat rate":t.min_weight===0?`Up to ${t.max_weight} ${u}`:`${t.min_weight} â€“ ${t.max_weight} ${u}`:"",Z=l=>{if(l.preventDefault(),!t)return;const g=j?parseInt(j,10):null,A=E?parseFloat(E):null;i({...t,rate:parseFloat(a)||0,cost:m?parseFloat(m):null,transit_days:g!==null&&!isNaN(g)?g:null,transit_time:A!==null&&!isNaN(A)?A:null}),r(!1)};return e.jsx(mt,{open:s,onOpenChange:r,children:e.jsxs(ht,{className:"max-w-lg",children:[e.jsxs(xt,{children:[e.jsx(ft,{children:"Edit Service Rate"}),e.jsx(Ft,{children:"Update rate details for this service-zone-weight combination"})]}),e.jsx(Ht,{children:e.jsxs("form",{id:"service-rate-form",onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground w-20",children:"Service:"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:T})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground w-20",children:"Zone:"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:S})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground w-20",children:"Weight:"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:V})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Rate (Sell Price)"}),e.jsx(te,{type:"number",step:"0.01",value:a,onChange:l=>_(l.target.value),placeholder:"0.00",className:"h-9",autoFocus:!0})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Cost (COGS)"}),e.jsx(te,{type:"number",step:"0.01",value:m,onChange:l=>y(l.target.value),placeholder:"0.00",className:"h-9"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Transit Days"}),e.jsx(te,{type:"number",min:0,step:"1",value:j,onChange:l=>v(l.target.value),placeholder:"e.g., 3",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(W,{className:"text-xs",children:"Transit Time (hours)"}),e.jsx(te,{type:"number",min:0,step:"0.5",value:E,onChange:l=>M(l.target.value),placeholder:"e.g., 48",className:"h-9"})]})]})]})}),e.jsxs(gt,{children:[e.jsx(pe,{type:"button",variant:"outline",size:"sm",onClick:()=>r(!1),children:"Cancel"}),e.jsx(pe,{type:"submit",size:"sm",form:"service-rate-form",children:"Save"})]})]})})}const il=[{key:"type",label:"Type",width:100},{key:"fromCountry",label:"From",width:60},{key:"zone",label:"Zone",width:120},{key:"carrierCode",label:"Carrier",width:100},{key:"serviceCode",label:"Service Code",width:140},{key:"serviceName",label:"Service Name",width:200},{key:"minWeight",label:"Min Weight",width:90},{key:"maxWeight",label:"Max Weight",width:90},{key:"maxLength",label:"Max Length",width:90},{key:"maxWidth",label:"Max Width",width:90},{key:"maxHeight",label:"Max Height",width:90},{key:"rate",label:"Base Rate",width:90},{key:"currency",label:"Currency",width:70}],rl=[];function al(s,r){var t,i,n;switch(r){case"type":return s.type;case"fromCountry":return s.fromCountry;case"zone":return s.zone;case"carrierCode":return s.carrierCode;case"serviceCode":return s.serviceCode;case"serviceName":return s.serviceName;case"minWeight":return s.minWeight.toString();case"maxWeight":return s.maxWeight.toString();case"maxLength":return((t=s.maxLength)==null?void 0:t.toString())||"";case"maxWidth":return((i=s.maxWidth)==null?void 0:i.toString())||"";case"maxHeight":return((n=s.maxHeight)==null?void 0:n.toString())||"";case"rate":return s.rate!=null?s.rate.toFixed(2):"";case"currency":return s.currency;default:return s.surcharges[r]!=null?s.surcharges[r].toFixed(2):""}}const ll=Te.memo(function({row:r,rowIndex:t,columns:i,height:n,start:o}){return e.jsxs("div",{className:de("absolute top-0 left-0 w-full flex border-b border-border text-xs",t%2===0?"bg-background":"bg-muted/30"),style:{height:`${n}px`,transform:`translateY(${o}px)`},children:[e.jsx("div",{className:"w-10 px-2 py-1.5 border-r border-border flex-shrink-0 bg-background text-center text-muted-foreground sticky left-0 z-10",children:t+1}),i.map(u=>{const a=al(r,u.key);return e.jsx("div",{className:"px-2 py-1.5 border-r border-border flex-shrink-0 truncate text-foreground",style:{width:`${u.width}px`},title:a,children:a},u.key)})]})});function ol({open:s,onOpenChange:r,name:t,carrierName:i,originCountries:n,services:o,sharedZones:u,serviceRates:a,weightRanges:_,surcharges:m,weightUnit:y}){const j=c.useRef(null),v=c.useMemo(()=>{if(!s)return new Map;const g=new Map;for(const A of a){const B=`${A.service_id}:${A.zone_id}:${A.min_weight??0}:${A.max_weight??0}`;g.set(B,A.rate)}return g},[s,a]),E=c.useMemo(()=>s?m.filter(g=>g.name).map(g=>({key:g.id,label:g.name,width:100})):[],[s,m]),M=c.useMemo(()=>{if(!s)return new Map;const g=new Map;for(const A of m)g.set(A.id,A.amount);return g},[s,m]),T=c.useMemo(()=>{if(!s)return rl;const g=[],A=n.join(", ")||"â€”",B=_.length>0?_:[{min_weight:0,max_weight:0}];for(const $ of o){const me=($.zone_ids||[]).map(se=>u.find(ie=>ie.id===se)).filter(Boolean),Ne=new Set($.surcharge_ids||[]),ve={};M.forEach((se,ie)=>{Ne.has(ie)&&(ve[ie]=se)});const he=($.features||[]).includes("returns")||/\breturn/i.test($.service_name||"")||/\breturn/i.test($.service_code||"")?"RETURN":"SHIPPING";if(me.length!==0)for(const se of me)for(const ie of B){const Re=`${$.id}:${se.id}:${ie.min_weight}:${ie.max_weight}`,Oe=v.get(Re)??null;g.push({type:he,fromCountry:A,zone:se.label||"â€”",carrierCode:i,serviceCode:$.service_code,serviceName:$.service_name,minWeight:ie.min_weight,maxWeight:ie.max_weight,maxLength:$.max_length??null,maxWidth:$.max_width??null,maxHeight:$.max_height??null,rate:Oe,currency:$.currency||"USD",weightUnit:$.weight_unit||y,surcharges:ve})}}return g},[s,o,u,_,M,i,n,y,v]),S=c.useDeferredValue(T),V=S!==T,Z=c.useMemo(()=>[...il,...E],[E]),I=c.useMemo(()=>Z.reduce((g,A)=>g+A.width,0),[Z]),C=Sn({count:S.length,getScrollElement:()=>j.current,estimateSize:()=>32,overscan:5}),l=c.useCallback(()=>r(!1),[r]);return e.jsx(Zs,{open:s,onOpenChange:r,children:e.jsxs(Gs,{side:"right",className:"w-full sm:max-w-full p-0",hideCloseButton:!0,children:[e.jsx(Bs,{className:"px-4 sm:px-6 py-4 border-b border-border bg-background",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs(qs,{className:"text-lg font-semibold flex-1",children:[t||"Rate Sheet"," â€” Preview"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[T.length," rows"]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:[Z.length," columns"]})]}),e.jsx("button",{onClick:l,className:"p-2 rounded-md text-muted-foreground hover:text-foreground hover:bg-accent transition-colors","aria-label":"Close preview",children:e.jsx(tt,{className:"h-5 w-5"})})]})}),e.jsx("div",{className:"flex-1 h-[calc(100vh-73px)] overflow-hidden",children:T.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-sm",children:"No data to preview"}),e.jsx("p",{className:"text-xs mt-1",children:"Add services and configure rates to see the preview"})]})}):e.jsxs("div",{className:"relative h-full",children:[V&&e.jsx("div",{className:"absolute inset-0 z-30 flex items-center justify-center bg-background/60",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Ot,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Loading preview..."})]})}),e.jsx("div",{ref:j,className:de("h-full overflow-auto transition-opacity duration-150",V&&"opacity-60"),children:e.jsxs("div",{style:{minWidth:`${I}px`},children:[e.jsxs("div",{className:"flex border-b border-border bg-muted font-medium text-xs text-foreground sticky top-0 z-10",children:[e.jsx("div",{className:"w-10 px-2 py-2 border-r border-border flex-shrink-0 bg-muted text-center text-muted-foreground sticky left-0 z-20",children:"#"}),Z.map(g=>e.jsx("div",{className:"px-2 py-2 border-r border-border flex-shrink-0 bg-muted truncate",style:{width:`${g.width}px`},title:g.label,children:g.label},g.key))]}),e.jsx("div",{style:{height:`${C.getTotalSize()}px`,position:"relative"},children:C.getVirtualItems().map(g=>e.jsx(ll,{row:S[g.index],rowIndex:g.index,columns:Z,height:g.size,start:g.start},g.key))})]})})]})})]})})}const De=(s="temp")=>`${s}-${crypto.randomUUID()}`,Ps=s=>{if(s){if(!Array.isArray(s)){const r={};for(const[t,i]of Object.entries(s))if(typeof i=="string"){const n=i.trim();n===""?r[t]=null:r[t]=n}else i!=null&&(r[t]=i);return Object.keys(r).length>0?r:void 0}if(s.length!==0)return Object.fromEntries(s.map(r=>[r,!0]))}},ns=s=>!s||typeof s!="object"?[]:Object.entries(s).filter(([r,t])=>t===!0).map(([r])=>r),pl=({rateSheetId:s,onClose:r,preloadCarrier:t,linkConnectionId:i,isAdmin:n=!1,useRateSheet:o,useRateSheetMutation:u})=>{var vs,bs,ys,js;const _=!(s==="new"),[m,y]=c.useState(t||""),[j,v]=c.useState(""),[E,M]=c.useState([]),[T,S]=c.useState([]),[V,Z]=c.useState([]),[I,C]=c.useState([]),[l,g]=c.useState([]),[A,B]=c.useState(null),$=c.useRef(null),[xe,me]=c.useState(!1),[Ne,ve]=c.useState(null),[fe,he]=c.useState(!1),[se,ie]=c.useState(null),[Re,Oe]=c.useState(null),[Ge,He]=c.useState(!1),[p,k]=c.useState(!1),[z,F]=c.useState(!1),[G,Y]=c.useState("rate_sheet"),[ue,ne]=c.useState(!1),[Q,zt]=c.useState(null),[Cn,rt]=c.useState(!1),[Me,yt]=c.useState(null),[at,cs]=c.useState(!1),[Rn,Vt]=c.useState(!1),[ge,Zt]=c.useState(null),[An,lt]=c.useState(!1),[$e,ot]=c.useState(null),[kn,Dn]=c.useState(!1),[Tn,cl]=c.useState(null),[In,ds]=c.useState(!1),[dl,On]=c.useState(!1),[Mn,us]=c.useState(!1),[$n,Pn]=c.useState(null),Gt=c.useRef(!1),Bt=c.useRef(!1),[ms,hs]=c.useState(null),[jt,qt]=c.useState({}),{references:H,metadata:ul}=ar(),{toast:ae}=lr(),{query:Be}=o({id:_?s:void 0}),Ae=u(),K=(vs=Be==null?void 0:Be.data)==null?void 0:vs.rate_sheet,Fn=Be==null?void 0:Be.isLoading,qe=c.useMemo(()=>{const d=(H==null?void 0:H.carriers)||{},h=(H==null?void 0:H.ratesheets)||{};return Object.entries(d).filter(([f])=>h[f]).map(([f,x])=>({id:f,name:String(x)}))},[H==null?void 0:H.carriers,H==null?void 0:H.ratesheets]),xs=c.useMemo(()=>{const d=(H==null?void 0:H.countries)||{};return Object.entries(d).map(([h,f])=>({value:h.toUpperCase(),label:String(f)})).sort((h,f)=>h.label.localeCompare(f.label))},[H==null?void 0:H.countries]),Hn=Ws,Ln=zs,Un=Vs,Wn=((bs=T[0])==null?void 0:bs.currency)??"USD",Ke=((ys=T[0])==null?void 0:ys.weight_unit)??"KG",zn=((js=T[0])==null?void 0:js.dimension_unit)??"CM",Kt=(K==null?void 0:K.carriers)??[],Yt=c.useMemo(()=>{var h,f;if(!m||!((f=(h=H==null?void 0:H.ratesheets)==null?void 0:h[m])!=null&&f.services))return[];const d=new Set(T.map(x=>x.service_code));return H.ratesheets[m].services.filter(x=>!d.has(x.service_code)).map(x=>({code:x.service_code,name:x.service_name})).sort((x,b)=>x.name.localeCompare(b.name))},[m,H==null?void 0:H.ratesheets,T]);c.useMemo(()=>{var h,f;if(!m||!((f=(h=H==null?void 0:H.ratesheets)==null?void 0:h[m])!=null&&f.zones))return[];const d=new Set(I.map(x=>x.label));return H.ratesheets[m].zones.filter(x=>x.label&&!d.has(x.label)).map(x=>({id:x.id,label:x.label,countries:(x.country_codes||[]).length})).sort((x,b)=>x.label.localeCompare(b.label))},[m,H==null?void 0:H.ratesheets,I]);const Vn=c.useMemo(()=>{var h,f;if(!m||!((f=(h=H==null?void 0:H.ratesheets)==null?void 0:h[m])!=null&&f.surcharges))return[];const d=new Set(V.map(x=>x.name));return H.ratesheets[m].surcharges.filter(x=>x.name&&!d.has(x.name)).map(x=>({id:x.id,name:x.name,amount:x.amount,surcharge_type:x.surcharge_type})).sort((x,b)=>x.name.localeCompare(b.name))},[m,H==null?void 0:H.ratesheets,V]),ct=_&&Fn&&!K;c.useEffect(()=>{T.length>0?Q&&T.some(h=>h.id===Q)||zt(T[0].id):zt(null)},[T]),c.useEffect(()=>{A!==null&&B(null)},[K==null?void 0:K.service_rates]),c.useEffect(()=>{if(K&&_){y(K.carrier_name||""),v(K.name||""),M(K.origin_countries||[]);const d=K.zones||[],h=K.service_rates||[],f=K.services||[],x=new Map(d.map(O=>[O.id,O])),b=new Map(h.map(O=>[`${O.service_id}:${O.zone_id}`,O])),w=new Set,U=f.map(O=>{const be=(O.zone_ids||[]).map((Ce,Jt)=>{const q=x.get(Ce),re=b.get(`${O.id}:${Ce}`);return w.add(Ce),{id:Ce,label:(q==null?void 0:q.label)||`Zone ${Jt+1}`,rate:(re==null?void 0:re.rate)??0,cost:(re==null?void 0:re.cost)??null,min_weight:(re==null?void 0:re.min_weight)??(q==null?void 0:q.min_weight)??null,max_weight:(re==null?void 0:re.max_weight)??(q==null?void 0:q.max_weight)??null,weight_unit:(q==null?void 0:q.weight_unit)??null,transit_days:(re==null?void 0:re.transit_days)??(q==null?void 0:q.transit_days)??null,transit_time:(re==null?void 0:re.transit_time)??(q==null?void 0:q.transit_time)??null,country_codes:(q==null?void 0:q.country_codes)||[],postal_codes:(q==null?void 0:q.postal_codes)||[],cities:(q==null?void 0:q.cities)||[]}}),X=O.features;return{...O,zones:be,features:ns(O.features),first_mile:(X==null?void 0:X.first_mile)||"",last_mile:(X==null?void 0:X.last_mile)||"",form_factor:(X==null?void 0:X.form_factor)||"",age_check:(X==null?void 0:X.age_check)||""}}),P=d.map(O=>({id:O.id,label:O.label||"",rate:0,cost:null,min_weight:O.min_weight??null,max_weight:O.max_weight??null,weight_unit:O.weight_unit??null,transit_days:O.transit_days??null,transit_time:O.transit_time??null,country_codes:O.country_codes||[],postal_codes:O.postal_codes||[],cities:O.cities||[]}));S(U),C(P),Z(K.surcharges||[]);const D=new Map;d.forEach(O=>{D.set(O.id,{id:O.id,label:O.label||"",rate:0,country_codes:O.country_codes||[],postal_codes:O.postal_codes||[],cities:O.cities||[],transit_days:O.transit_days??null,transit_time:O.transit_time??null})});const L=new Map;(K.surcharges||[]).forEach(O=>{L.set(O.id,{...O})});const J=new Map;h.forEach(O=>{J.set(`${O.service_id}:${O.zone_id}`,{rate:O.rate,cost:O.cost})});const N=new Map,ee=new Map;f.forEach(O=>{N.set(O.id,[...O.zone_ids||[]]),ee.set(O.id,[...O.surcharge_ids||[]])}),$.current={name:K.name||"",zones:D,surcharges:L,serviceRates:J,serviceZoneIds:N,serviceSurchargeIds:ee}}},[K,_]),c.useEffect(()=>{if(!_){if(t){y(t);const d=qe.find(h=>h.id===t);d&&v(`${d.name} - sheet`)}else y(""),v("");M([]),S([]),C([]),Z([]),g([]),$.current=null}},[_,t,qe]);const fs=c.useRef("");c.useEffect(()=>{var d,h;if(!_&&m){const f=qe.find(x=>x.id===m);if(f&&v(`${f.name} - sheet`),fs.current!==m){const x=(d=H==null?void 0:H.ratesheets)==null?void 0:d[m];if(((h=x==null?void 0:x.services)==null?void 0:h.length)>0){const{zones:b,services:w,surcharges:U,service_rates:P}=x,D=new Map((b||[]).map(R=>[R.id,R])),L=new Map;for(const R of P||[]){const be=`${R.service_id}:${R.zone_id}:${R.min_weight??0}:${R.max_weight??0}`;L.set(be,{rate:R.rate??0,cost:R.cost??null})}const J=(b||[]).map(R=>({id:R.id,label:R.label||"",rate:0,cost:null,min_weight:R.min_weight??null,max_weight:R.max_weight??null,weight_unit:R.weight_unit??null,transit_days:R.transit_days??null,transit_time:R.transit_time??null,country_codes:R.country_codes||[],postal_codes:R.postal_codes||[],cities:R.cities||[]})),N=(U||[]).map(R=>({id:R.id||De("surcharge"),name:R.name||"",amount:R.amount??0,surcharge_type:R.surcharge_type||"fixed",cost:R.cost??null,active:R.active??!0})),ee=[],O=w.map(R=>{const be=De("service"),X=R.id,Ce=R.zone_ids||[],Jt=Ce.map((q,re)=>{const Pe=D.get(q)||{label:`Zone ${re+1}`},Ye=L.get(`${X}:${q}:0:0`);return{id:q,label:Pe.label||`Zone ${re+1}`,rate:(Ye==null?void 0:Ye.rate)??0,cost:(Ye==null?void 0:Ye.cost)??null,min_weight:Pe.min_weight??null,max_weight:Pe.max_weight??null,weight_unit:Pe.weight_unit??null,transit_days:Pe.transit_days??null,transit_time:Pe.transit_time??null,country_codes:Pe.country_codes||[],postal_codes:Pe.postal_codes||[],cities:Pe.cities||[]}});for(const q of P||[])String(q.service_id)===String(X)&&ee.push({service_id:be,zone_id:q.zone_id,rate:q.rate??0,cost:q.cost??null,min_weight:q.min_weight??null,max_weight:q.max_weight??null});return{id:be,object_type:"service_level",service_name:R.service_name||"",service_code:R.service_code||"",carrier_service_code:R.carrier_service_code??null,description:R.description??null,active:R.active??!0,currency:R.currency??"USD",transit_days:R.transit_days??null,transit_time:R.transit_time??null,max_width:R.max_width??null,max_height:R.max_height??null,max_length:R.max_length??null,dimension_unit:R.dimension_unit??null,max_weight:R.max_weight??null,weight_unit:R.weight_unit??null,domicile:R.domicile??null,international:R.international??null,zones:Jt,zone_ids:Ce,surcharge_ids:R.surcharge_ids||[],features:ns(R.features),...R.features?{first_mile:R.features.first_mile||"",last_mile:R.features.last_mile||"",form_factor:R.features.form_factor||"",age_check:R.features.age_check||""}:{}}});S(O),C(J),Z(N),g(ee)}else S([]),C([]),Z([]),g([])}}fs.current=m},[m,_,qe]);const gs=()=>{ve(null),me(!0)},ps=d=>{var J;if(!m||!((J=H==null?void 0:H.ratesheets)!=null&&J[m]))return;const h=H.ratesheets[m],f=(h.services||[]).find(N=>N.service_code===d);if(!f)return;const x=De("service"),b=f.id,w=f.zone_ids||[],U=h.service_rates||[],P=w.map(N=>{const ee=I.find(R=>R.id===N);if(!ee)return null;const O=U.find(R=>String(R.service_id)===String(b)&&R.zone_id===N);return{...ee,rate:(O==null?void 0:O.rate)??0,cost:(O==null?void 0:O.cost)??null}}).filter(Boolean),D=U.filter(N=>String(N.service_id)===String(b)).map(N=>({service_id:x,zone_id:N.zone_id,rate:N.rate??0,cost:N.cost??null,min_weight:N.min_weight??null,max_weight:N.max_weight??null})),L={id:x,object_type:"service_level",service_name:f.service_name||"",service_code:f.service_code||"",carrier_service_code:f.carrier_service_code??null,description:f.description??null,active:f.active??!0,currency:f.currency??"USD",transit_days:f.transit_days??null,transit_time:f.transit_time??null,max_width:f.max_width??null,max_height:f.max_height??null,max_length:f.max_length??null,dimension_unit:f.dimension_unit??null,max_weight:f.max_weight??null,weight_unit:f.weight_unit??null,domicile:f.domicile??null,international:f.international??null,zones:P,zone_ids:w,surcharge_ids:f.surcharge_ids||[],features:ns(f.features),...f.features?{first_mile:f.features.first_mile||"",last_mile:f.features.last_mile||"",form_factor:f.features.form_factor||"",age_check:f.features.age_check||""}:{}};S(N=>[...N,L]),g(N=>[...N,...D]),On(!1)},Zn=d=>{var b;if(!m||!((b=H==null?void 0:H.ratesheets)!=null&&b[m]))return;const f=(H.ratesheets[m].surcharges||[]).find(w=>w.id===d);if(!f)return;const x={id:De("surcharge"),name:f.name||"",amount:f.amount??0,surcharge_type:f.surcharge_type||"fixed",active:!0,cost:f.cost??null};ot(x),lt(!0)},Gn=d=>{const h={...d,id:De("surcharge"),name:`${d.name} (copy)`};ot(h),lt(!0)},_s=d=>{const h=De("service"),f={...d,id:h,service_name:`${d.service_name} (copy)`};S(b=>[...b,f]);const x=l.filter(b=>b.service_id===d.id).map(b=>({...b,service_id:h}));g(b=>[...b,...x]),ve(f),me(!0)},Bn=d=>{ve(d),me(!0)},qn=d=>{if(Ne)S(h=>h.map(f=>f.service_code===Ne.service_code?{...f,...d}:f));else{const h={id:De("service"),object_type:"service_level",service_name:d.service_name||"",service_code:d.service_code||"",currency:d.currency??"USD",carrier_service_code:d.carrier_service_code??null,description:d.description??null,transit_days:d.transit_days??null,transit_time:null,zones:[{id:De("zone"),rate:0,label:"Zone 1",min_weight:null,max_weight:null,weight_unit:null,transit_days:null,transit_time:null,cities:[],postal_codes:[],country_codes:[]}],active:d.active??!0,domicile:d.domicile??null,international:d.international??null,max_weight:d.max_weight??null,weight_unit:d.weight_unit??null,max_width:d.max_width??null,max_height:d.max_height??null,max_length:d.max_length??null,dimension_unit:d.dimension_unit??null,features:d.features??[]};S(f=>[...f,h])}me(!1),ve(null)},Kn=d=>{ie(d),he(!0)},Yn=async()=>{if(se){if(se.id&&!se.id.startsWith("temp-")&&s&&Ae.deleteRateSheetService){k(!0);try{await Ae.deleteRateSheetService.mutateAsync({rate_sheet_id:s,service_id:se.id}),ae({title:"Service deleted",description:"Service has been removed from the rate sheet"})}catch{ae({title:"Failed to delete service",description:"An error occurred while deleting the service",variant:"destructive"}),ie(null),he(!1),k(!1);return}finally{k(!1)}}S(h=>h.filter(f=>f.service_code!==se.service_code)),ie(null),he(!1)}},Qn=()=>{const d=new Set;return I.filter(h=>h.label).forEach(h=>d.add(h.label)),T.flatMap(h=>h.zones||[]).filter(h=>h.label).forEach(h=>d.add(h.label)),d},Xn=(d,h)=>{const f=I.find(x=>x.id===h);f&&S(x=>x.map(b=>{if(b.id!==d)return b;const w=b.zone_ids||[];return w.includes(h)?b:{...b,zones:[...b.zones||[],f],zone_ids:[...w,h]}}))},Jn=d=>{const h=Qn();let f=1;for(;h.has(`Zone ${f}`);)f++;const x={id:De("zone"),rate:0,label:`Zone ${f}`,min_weight:null,max_weight:null,weight_unit:null,transit_days:null,transit_time:null,cities:[],postal_codes:[],country_codes:[]};hs(d),Zt(x),Vt(!0)},ei=(d,h)=>{S(f=>f.map(x=>x.id!==d?x:{...x,zones:(x.zones||[]).filter(b=>b.id!==h),zone_ids:(x.zone_ids||[]).filter(b=>b!==h)}))},ti=(d,h)=>{d&&(C(f=>f.map(x=>(x.label||x.id)===d?{...x,...h}:x)),S(f=>f.map(x=>{const b=(x.zones||[]).map(w=>(w.label||w.id)===d?{...w,...h}:w);return{...x,zones:b}})))},si=d=>{Oe(d),He(!0)},ni=()=>{Re!==null&&(C(d=>d.filter(h=>(h.label||h.id)!==Re)),S(d=>d.map(h=>({...h,zones:(h.zones||[]).filter(f=>(f.label||f.id)!==Re)}))),Oe(null),He(!1))},ii=d=>{Zt(d),Vt(!0)},ri=d=>{ot(d),lt(!0)},ai=(d,h)=>{Gt.current=!0;const f=ge&&I.some(x=>x.id===ge.id);if(ge&&f)ti(d,h);else if(ge){const x={...ge,...h};C(b=>b.some(w=>w.id===x.id)?b:[...b,x]),ms&&S(b=>b.map(w=>{if(w.id!==ms)return w;const U=w.zone_ids||[];return U.includes(x.id)?w:{...w,zones:[...w.zones||[],x],zone_ids:[...U,x.id]}}))}},li=(d,h)=>{Bt.current=!0;const f=$e&&V.some(x=>x.id===$e.id);if($e&&f)ui(d,h);else if($e){const x={...$e,...h};Z(b=>b.some(w=>w.id===x.id)?b:[...b,x])}},oi=async d=>{if(_)try{await Ae.updateServiceRate.mutateAsync({rate_sheet_id:s,service_id:d.service_id,zone_id:d.zone_id,rate:d.rate,cost:d.cost,min_weight:d.min_weight??0,max_weight:d.max_weight??0,transit_days:d.transit_days,transit_time:d.transit_time})}catch(h){ae({title:"Failed to update rate",description:h==null?void 0:h.message,variant:"destructive"})}},ci=(d,h,f)=>{S(x=>x.map(b=>{if(b.id!==d)return b;const w=b.zones||[],U=b.zone_ids||[];if(f){const P=I.find(D=>D.id===h)||T.flatMap(D=>D.zones||[]).find(D=>D.id===h)||((ge==null?void 0:ge.id)===h?ge:void 0);return!P||U.includes(h)?b:{...b,zones:[...w,P],zone_ids:[...U,h]}}else return{...b,zones:w.filter(P=>P.id!==h),zone_ids:U.filter(P=>P!==h)}}))},di=()=>{const d={id:De("surcharge"),name:"",amount:0,surcharge_type:"fixed",active:!0,cost:null};ot(d),lt(!0)},ui=(d,h)=>{Z(f=>f.map(x=>x.id===d?{...x,...h}:x))},mi=d=>{Z(h=>h.filter(f=>f.id!==d))},hi=(d,h,f)=>{S(x=>x.map(b=>{if(b.id!==d)return b;const w=b.surcharge_ids||[],U=f?[...w,h]:w.filter(P=>P!==h);return{...b,surcharge_ids:U}}))},ke=c.useMemo(()=>_?A??(K==null?void 0:K.service_rates)??[]:l,[_,A,K==null?void 0:K.service_rates,l]),Le=c.useMemo(()=>Ga(ke),[ke]),xi=c.useMemo(()=>{var w,U;if(!m||!((U=(w=H==null?void 0:H.ratesheets)==null?void 0:w[m])!=null&&U.service_rates))return[];const d=H.ratesheets[m].service_rates,h=new Set(Le.map(P=>`${P.min_weight}:${P.max_weight}`)),f=Q?jt[Q]||[]:[];for(const P of f)h.add(`${P.min_weight}:${P.max_weight}`);const x=new Set,b=[];for(const P of d){if(P.min_weight==null||P.max_weight==null)continue;const D=`${P.min_weight}:${P.max_weight}`;x.has(D)||h.has(D)||(x.add(D),b.push({min_weight:P.min_weight,max_weight:P.max_weight}))}return b.sort((P,D)=>P.min_weight-D.min_weight||P.max_weight-D.max_weight)},[m,H==null?void 0:H.ratesheets,Le,Q,jt]),Qt=c.useCallback(d=>{const h=ke.filter(w=>w.service_id===d),f=new Set,x=[];for(const w of h){const U=w.min_weight??0,P=w.max_weight??0;if(U===0&&P===0)continue;const D=`${U}:${P}`;f.has(D)||(f.add(D),x.push({min_weight:U,max_weight:P}))}const b=jt[d]||[];for(const w of b){const U=`${w.min_weight}:${w.max_weight}`;f.has(U)||(f.add(U),x.push(w))}return x.sort((w,U)=>w.min_weight-U.min_weight)},[ke,jt]),fi=c.useCallback(d=>{const h=Qt(d),f=new Set(h.map(x=>`${x.min_weight}:${x.max_weight}`));return Le.filter(x=>!f.has(`${x.min_weight}:${x.max_weight}`))},[Le,Qt]),gi=d=>{Pn(d),us(!0)},pi=(d,h,f)=>{if(_&&s&&Q)if(ke.some(b=>b.min_weight===d&&b.max_weight===h)){const b=ke.filter(w=>w.service_id===Q&&w.min_weight===d&&w.max_weight===h);B(w=>(w??(K==null?void 0:K.service_rates)??[]).map(P=>P.service_id===Q&&P.min_weight===d&&P.max_weight===h?{...P,max_weight:f}:P)),Promise.all(b.map(w=>Ae.deleteServiceRate.mutateAsync({rate_sheet_id:s,service_id:w.service_id,zone_id:w.zone_id,min_weight:w.min_weight,max_weight:w.max_weight}))).then(()=>Promise.all(b.map(w=>Ae.updateServiceRate.mutateAsync({rate_sheet_id:s,service_id:w.service_id,zone_id:w.zone_id,rate:w.rate??0,min_weight:d,max_weight:f})))).then(()=>{ae({title:"Weight range updated",variant:"default"})}).catch(w=>{ae({title:"Failed to update weight range",description:w==null?void 0:w.message,variant:"destructive"}),B(null)})}else qt(b=>{const w={...b};for(const[U,P]of Object.entries(w))w[U]=P.map(D=>D.min_weight===d&&D.max_weight===h?{...D,max_weight:f}:D);return w}),ae({title:"Weight range updated",variant:"default"});else g(x=>x.map(b=>b.min_weight===d&&b.max_weight===h?{...b,max_weight:f}:b)),ae({title:"Weight range updated",variant:"default"})},Xt=async(d,h)=>{if(_&&s){if(!Q)return;qt(f=>{const x=f[Q]||[];return x.some(w=>w.min_weight===d&&w.max_weight===h)?f:{...f,[Q]:[...x,{min_weight:d,max_weight:h}]}}),ae({title:"Weight range added",variant:"default"})}else{const f=T.find(x=>x.id===Q);if(f){const b=(f.zone_ids||[]).map(w=>({service_id:f.id,zone_id:w,rate:0,min_weight:d,max_weight:h}));b.length>0&&g(w=>[...w,...b])}ae({title:"Weight range added",variant:"default"})}},_i=(d,h)=>{yt({min_weight:d,max_weight:h}),rt(!0)},vi=()=>{if(Me)if(_&&s){const{min_weight:d,max_weight:h}=Me;if(ke.some(x=>x.service_id===Q&&x.min_weight===d&&x.max_weight===h)){const x=ke.filter(b=>b.service_id===Q&&b.min_weight===d&&b.max_weight===h);B(b=>(b??(K==null?void 0:K.service_rates)??[]).filter(U=>!(U.service_id===Q&&U.min_weight===d&&U.max_weight===h))),rt(!1),yt(null),Promise.all(x.map(b=>Ae.deleteServiceRate.mutateAsync({rate_sheet_id:s,service_id:b.service_id,zone_id:b.zone_id,min_weight:b.min_weight,max_weight:b.max_weight}))).then(()=>{ae({title:"Weight range removed",variant:"default"})}).catch(b=>{ae({title:"Failed to remove weight range",description:b==null?void 0:b.message,variant:"destructive"}),B(null)})}else qt(x=>{if(!Q)return x;const b=x[Q]||[];return{...x,[Q]:b.filter(w=>!(w.min_weight===d&&w.max_weight===h))}}),rt(!1),yt(null),ae({title:"Weight range removed",variant:"default"})}else{const{min_weight:d,max_weight:h}=Me;g(f=>f.filter(x=>!(x.service_id===Q&&x.min_weight===d&&x.max_weight===h))),rt(!1),yt(null),ae({title:"Weight range removed",variant:"default"})}},bi=(d,h,f,x)=>{_&&s?(B(b=>(b??(K==null?void 0:K.service_rates)??[]).filter(U=>!(U.service_id===d&&U.zone_id===h&&U.min_weight===f&&U.max_weight===x))),Ae.deleteServiceRate.mutate({rate_sheet_id:s,service_id:d,zone_id:h,min_weight:f,max_weight:x},{onError:b=>{ae({title:"Failed to delete rate",description:b==null?void 0:b.message,variant:"destructive"}),B(null)}})):g(b=>b.filter(w=>!(w.service_id===d&&w.zone_id===h&&w.min_weight===f&&w.max_weight===x)))},yi=(d,h,f,x,b)=>{_&&s?(B(w=>{const U=w??(K==null?void 0:K.service_rates)??[],P=U.findIndex(D=>D.service_id===d&&D.zone_id===h&&D.min_weight===f&&D.max_weight===x);if(P>=0){const D=[...U];return D[P]={...D[P],rate:b},D}return[...U,{service_id:d,zone_id:h,rate:b,min_weight:f,max_weight:x}]}),Ae.updateServiceRate.mutate({rate_sheet_id:s,service_id:d,zone_id:h,rate:b,min_weight:f,max_weight:x},{onError:w=>{ae({title:"Failed to update rate",description:w==null?void 0:w.message,variant:"destructive"})}})):g(w=>{const U=w.findIndex(P=>P.service_id===d&&P.zone_id===h&&P.min_weight===f&&P.max_weight===x);if(U>=0){const P=[...w];return P[U]={...P[U],rate:b},P}return[...w,{service_id:d,zone_id:h,rate:b,min_weight:f,max_weight:x}]})},ji=()=>{const d=[];return j.trim()||d.push("Rate sheet name is required"),m||d.push("Carrier is required"),T.length===0&&d.push("At least one service is required"),{isValid:d.length===0,errors:d}},wi=async()=>{const d=ji();if(!d.isValid){ae({title:"Validation Error",description:d.errors.join(", "),variant:"destructive"});return}F(!0);try{const f=(()=>{const D=new Map;let L=0;return I.forEach(J=>{var ee;const N=J.label||`Zone ${L+1}`;if(!D.has(N)){const O=(ee=J.id)!=null&&ee.startsWith("temp-")?`zone_${L}`:J.id||`zone_${L}`;D.set(N,{id:O,label:N,country_codes:J.country_codes||[],postal_codes:J.postal_codes||[],cities:J.cities||[],transit_days:J.transit_days??null,transit_time:J.transit_time??null,min_weight:J.min_weight??null,max_weight:J.max_weight??null,weight_unit:J.weight_unit??null}),L++}}),T.forEach(J=>{(J.zones||[]).forEach(N=>{var O;const ee=N.label||`Zone ${L+1}`;if(!D.has(ee)){const R=(O=N.id)!=null&&O.startsWith("temp-")?`zone_${L}`:N.id||`zone_${L}`;D.set(ee,{id:R,label:ee,country_codes:N.country_codes||[],postal_codes:N.postal_codes||[],cities:N.cities||[],transit_days:N.transit_days??null,transit_time:N.transit_time??null,min_weight:N.min_weight??null,max_weight:N.max_weight??null,weight_unit:N.weight_unit??null}),L++}})}),D})(),x=new Map;f.forEach((D,L)=>x.set(L,D.id));const b=Array.from(f.values()).map(D=>({id:D.id,label:D.label,country_codes:D.country_codes.length>0?D.country_codes:void 0,postal_codes:D.postal_codes.length>0?D.postal_codes:void 0,cities:D.cities.length>0?D.cities:void 0,transit_days:D.transit_days,transit_time:D.transit_time,min_weight:D.min_weight,max_weight:D.max_weight,weight_unit:D.weight_unit})),w=[],U=new Map,P=V.map((D,L)=>{var N;const J=(N=D.id)!=null&&N.startsWith("temp-")?`surcharge_${L}`:D.id||`surcharge_${L}`;return U.set(D.id,J),{id:J,name:D.name||"",amount:D.amount||0,surcharge_type:D.surcharge_type||"fixed",cost:D.cost??null,active:D.active??!0}});if(_){const D=T.map((L,J)=>{var R,be;const N=(R=L.id)!=null&&R.startsWith("temp-")?`temp-${J}`:L.id,ee=(L.zones||[]).map(X=>x.get(X.label||"")).filter(Boolean);(L.zones||[]).forEach(X=>{const Ce=x.get(X.label||"");Ce&&w.push({service_id:N,zone_id:Ce,rate:X.rate||0,cost:X.cost??null,min_weight:X.min_weight??null,max_weight:X.max_weight??null,transit_days:X.transit_days??null,transit_time:X.transit_time??null})});const O=(L.surcharge_ids||[]).map(X=>U.get(X)||X).filter(X=>P.some(Ce=>Ce.id===X));return{id:(be=L.id)!=null&&be.startsWith("temp-")?null:L.id,service_name:L.service_name||"",service_code:L.service_code||"",currency:L.currency||"USD",carrier_service_code:L.carrier_service_code,description:L.description,active:L.active,transit_days:L.transit_days,transit_time:L.transit_time,max_width:L.max_width,max_height:L.max_height,max_length:L.max_length,dimension_unit:L.dimension_unit,max_weight:L.max_weight,weight_unit:L.weight_unit,domicile:L.domicile,international:L.international,use_volumetric:L.use_volumetric,dim_factor:L.dim_factor,zone_ids:ee,surcharge_ids:O,features:Ps(L.features)}});await Ae.updateRateSheet.mutateAsync({id:s,name:j,origin_countries:E,services:D,zones:b,surcharges:P,service_rates:w}),ae({title:"Rate sheet updated",description:`"${j}" has been updated successfully`})}else{const D=new Map;T.forEach((N,ee)=>D.set(N.id,`temp-${ee}`));const L=new Map;I.forEach(N=>{const ee=x.get(N.label||"");ee&&L.set(N.id,ee)});for(const N of l){const ee=D.get(N.service_id),O=L.get(N.zone_id);ee&&O&&w.push({service_id:ee,zone_id:O,rate:N.rate,cost:N.cost??null,min_weight:N.min_weight??null,max_weight:N.max_weight??null})}const J=T.map(N=>{const ee=(N.zone_ids||[]).map(R=>L.get(R)||R).filter(R=>b.some(be=>be.id===R)),O=(N.surcharge_ids||[]).map(R=>U.get(R)||R).filter(R=>P.some(be=>be.id===R));return{service_name:N.service_name||"",service_code:N.service_code||"",currency:N.currency||"USD",carrier_service_code:N.carrier_service_code,description:N.description,active:N.active,transit_days:N.transit_days,transit_time:N.transit_time,max_width:N.max_width,max_height:N.max_height,max_length:N.max_length,dimension_unit:N.dimension_unit,max_weight:N.max_weight,weight_unit:N.weight_unit,domicile:N.domicile,international:N.international,use_volumetric:N.use_volumetric,dim_factor:N.dim_factor,zone_ids:ee,surcharge_ids:O,features:Ps(N.features)}});await Ae.createRateSheet.mutateAsync({name:j,carrier_name:m,origin_countries:E,services:J,zones:b,surcharges:P,service_rates:w}),ae({title:"Rate sheet created",description:`"${j}" has been created successfully`})}r()}catch(h){ae({title:_?"Failed to update rate sheet":"Failed to create rate sheet",description:(h==null?void 0:h.message)||"An unexpected error occurred",variant:"destructive"})}finally{F(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(Zs,{open:!0,onOpenChange:()=>r(),children:e.jsxs(Gs,{side:"right",className:"w-full sm:max-w-full p-0",hideCloseButton:!0,children:[e.jsx(Bs,{className:"px-4 sm:px-6 py-4 border-b border-border bg-background",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("button",{onClick:()=>cs(!at),className:"lg:hidden p-2 -ml-2 text-muted-foreground hover:text-foreground hover:bg-accent rounded-md","aria-label":at?"Close settings":"Open settings",disabled:ct,children:at?e.jsx(tt,{className:"h-5 w-5"}):e.jsx(or,{className:"h-5 w-5"})}),e.jsx(qs,{className:"text-lg sm:text-xl font-semibold flex-1",children:ct?"Loading...":_?"Edit Rate Sheet":"Create Rate Sheet"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{onClick:wi,disabled:z||ct,children:z?e.jsxs(e.Fragment,{children:[e.jsx(Ot,{className:"h-4 w-4 animate-spin mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Saving..."})]}):"Save"}),e.jsx("button",{onClick:()=>ds(!0),className:"p-2 rounded-md text-muted-foreground hover:text-foreground hover:bg-accent transition-colors","aria-label":"Preview as spreadsheet",title:"Preview as spreadsheet",disabled:ct,children:e.jsx(cr,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>r(),className:"p-2 rounded-md text-muted-foreground hover:text-foreground hover:bg-accent transition-colors","aria-label":"Close",children:e.jsx(tt,{className:"h-5 w-5"})})]})]})}),ct?e.jsxs("div",{className:"flex h-[calc(100vh-73px)] flex-col items-center justify-center gap-3 text-muted-foreground",children:[e.jsx(Ot,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm",children:"Loading rate sheet..."})]}):e.jsxs("div",{className:"flex h-[calc(100vh-73px)] overflow-hidden relative",children:[at&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:()=>cs(!1)}),e.jsx("div",{className:de("fixed lg:relative inset-y-0 left-0 z-50 lg:z-auto","w-full lg:w-80 border-r border-border bg-background lg:bg-muted/30 overflow-y-auto","transform transition-transform duration-200 ease-in-out lg:transform-none","top-[73px] lg:top-0 h-[calc(100vh-73px)]",at?"translate-x-0":"-translate-x-full lg:translate-x-0"),children:e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs(W,{className:"mb-2 block",children:["Carrier ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(ye,{value:m,onValueChange:y,disabled:_,children:[e.jsx(je,{className:"w-full",children:e.jsx(we,{placeholder:"Select a carrier"})}),e.jsx(Ee,{className:"z-[100]",children:qe.length>0?qe.map(d=>e.jsx(Se,{value:d.id,children:d.name},d.id)):e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"No carriers available"})})]})]}),e.jsxs("div",{children:[e.jsxs(W,{className:"mb-2 block",children:["Rate Sheet Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{value:j,onChange:d=>v(d.target.value),placeholder:"e.g., Standard Rates 2024"})]}),_&&Kt.length>0&&e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Connected Carriers"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",Kt.length,")"]})]})}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-1 pb-1",children:Kt.map(d=>e.jsx("div",{className:"p-3 bg-background border border-border rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:d.display_name||d.carrier_id}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:d.carrier_id})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${d.active?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:d.active?"Active":"Inactive"}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${d.test_mode?"bg-yellow-100 text-yellow-700":"bg-blue-100 text-blue-700"}`,children:d.test_mode?"Test":"Live"})]})]})},d.id))})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-border",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Default Settings"}),e.jsxs("div",{children:[e.jsx(W,{className:"text-xs mb-1 block",children:"Currency"}),e.jsxs(ye,{value:Wn,onValueChange:d=>{S(h=>h.map(f=>({...f,currency:d})))},disabled:T.length===0,children:[e.jsx(je,{className:"w-full",children:e.jsx(we,{placeholder:"Select currency"})}),e.jsx(Ee,{className:"z-[100] max-h-60",children:Hn.map(d=>e.jsx(Se,{value:d,children:d},d))})]})]}),e.jsxs("div",{children:[e.jsx(W,{className:"text-xs mb-1 block",children:"Origin Countries"}),e.jsx(Wt,{options:xs,value:E,onValueChange:M,placeholder:"Select countries..."})]}),e.jsxs("div",{children:[e.jsx(W,{className:"text-xs mb-1 block",children:"Weight Unit"}),e.jsxs(ye,{value:Ke,onValueChange:d=>{S(h=>h.map(f=>({...f,weight_unit:d})))},disabled:T.length===0,children:[e.jsx(je,{className:"w-full",children:e.jsx(we,{placeholder:"Select weight unit"})}),e.jsx(Ee,{className:"z-[100]",children:Ln.map(d=>e.jsx(Se,{value:d,children:d},d))})]})]}),e.jsxs("div",{children:[e.jsx(W,{className:"text-xs mb-1 block",children:"Dimension Unit"}),e.jsxs(ye,{value:zn,onValueChange:d=>{S(h=>h.map(f=>({...f,dimension_unit:d})))},disabled:T.length===0,children:[e.jsx(je,{className:"w-full",children:e.jsx(we,{placeholder:"Select dimension unit"})}),e.jsx(Ee,{className:"z-[100]",children:Un.map(d=>e.jsx(Se,{value:d,children:d},d))})]})]})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden bg-background w-full lg:w-auto",children:[e.jsx("div",{className:"border-b border-border px-4 sm:px-6 overflow-x-auto",children:e.jsx("div",{className:"flex items-center min-w-min",children:[{id:"rate_sheet",label:"Rate Sheet"},{id:"surcharges",label:"Surcharges"}].map(d=>e.jsx("button",{onClick:()=>Y(d.id),className:de("py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap px-4",G===d.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"),children:d.label},d.id))})}),e.jsxs("div",{className:"flex-1 p-4 sm:p-6 overflow-hidden",children:[G==="rate_sheet"&&e.jsxs("div",{className:"h-full flex flex-col",children:[T.length>0&&e.jsxs("div",{className:"flex items-center gap-1 mb-3 overflow-x-auto pb-1 border-b border-border",style:{scrollbarWidth:"none"},children:[T.map(d=>e.jsxs("button",{onClick:()=>zt(d.id),className:de("px-3 py-1.5 text-xs font-medium rounded-md whitespace-nowrap transition-colors flex items-center gap-1.5 group/svc",Q===d.id?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-accent"),children:[d.service_name||d.service_code||"Unnamed",Q===d.id&&e.jsxs("span",{className:"flex items-center gap-0",children:[e.jsx("span",{className:"p-0.5 rounded-sm hover:bg-primary-foreground/20",onClick:h=>{h.stopPropagation(),Bn(d)},title:"Edit service",children:e.jsx($t,{className:"h-3 w-3"})}),e.jsx("span",{className:"p-0.5 rounded-sm hover:bg-primary-foreground/20",onClick:h=>{h.stopPropagation(),Kn(d)},title:"Delete service",children:e.jsx(Pt,{className:"h-3 w-3"})})]})]},d.id)),e.jsx($s,{services:T,onAddService:gs,servicePresets:Yt,onAddServiceFromPreset:ps,onCloneService:_s,iconOnly:!0,align:"end"})]}),e.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[!_&&!m&&e.jsx("div",{className:"absolute inset-0 z-10 bg-background/80 backdrop-blur-[1px] flex items-center justify-center rounded-md",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a carrier to get started"})}),T.length===0?e.jsx("div",{className:"flex-1 flex items-center justify-center text-muted-foreground bg-muted/50 rounded border-2 border-dashed h-full",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-sm",children:"No services configured"}),e.jsx("div",{className:"mt-2",children:e.jsx($s,{services:T,onAddService:gs,servicePresets:Yt,onAddServiceFromPreset:ps,onCloneService:_s})})]})}):(()=>{const d=T.find(h=>h.id===Q);return d?e.jsx(Ka,{service:d,sharedZones:I,serviceRates:ke,weightRanges:Le,weightUnit:Ke,onCellEdit:yi,onDeleteRate:bi,onAddWeightRange:()=>ne(!0),onRemoveWeightRange:_i,onAssignZoneToService:Xn,onCreateNewZone:Jn,onRemoveZoneFromService:ei,serviceFilteredWeightRanges:Qt(d.id),onEditWeightRange:gi,onEditZone:ii,onDeleteZone:si,missingRanges:fi(d.id),onAddMissingRange:Xt,weightRangePresets:xi,onAddFromPreset:Xt}):null})()]})]}),G==="surcharges"&&e.jsx(Ja,{surcharges:V,services:T,onEditSurcharge:ri,onAddSurcharge:di,onRemoveSurcharge:mi,surchargePresets:Vn,onAddSurchargeFromPreset:Zn,onCloneSurcharge:Gn})]})]})]})]})}),e.jsx(Ia,{isOpen:xe,onClose:()=>me(!1),service:Ne,onSubmit:qn,availableSurcharges:V,servicePresets:Yt}),e.jsx(Nt,{open:fe,onOpenChange:he,children:e.jsxs(Ct,{children:[e.jsxs(Rt,{children:[e.jsx(At,{children:"Delete Service"}),e.jsxs(kt,{children:['Are you sure you want to delete "',se==null?void 0:se.service_name,'"? This action cannot be undone.']})]}),e.jsxs(Dt,{children:[e.jsx(Tt,{disabled:p,children:"Cancel"}),e.jsx(It,{onClick:Yn,disabled:p,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:p?e.jsxs(e.Fragment,{children:[e.jsx(Ot,{className:"h-4 w-4 animate-spin mr-2"}),"Deleting..."]}):"Delete"})]})]})}),e.jsx(Nt,{open:Ge,onOpenChange:He,children:e.jsxs(Ct,{children:[e.jsxs(Rt,{children:[e.jsx(At,{children:"Delete Zone"}),e.jsxs(kt,{children:['Are you sure you want to delete "',Re,'"? This will remove it from all services. This action cannot be undone.']})]}),e.jsxs(Dt,{children:[e.jsx(Tt,{children:"Cancel"}),e.jsx(It,{onClick:ni,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(Ya,{open:ue,onOpenChange:ne,existingRanges:Le,weightUnit:Ke,onAdd:Xt}),e.jsx(Qa,{open:Mn,onOpenChange:us,weightRange:$n,existingRanges:Le,weightUnit:Ke,onSave:pi}),e.jsx(Nt,{open:Cn,onOpenChange:rt,children:e.jsxs(Ct,{children:[e.jsxs(Rt,{children:[e.jsx(At,{children:"Remove Weight Range"}),e.jsxs(kt,{children:["Are you sure you want to remove the weight range"," ",(Me==null?void 0:Me.min_weight)??0," â€“"," ",(Me==null?void 0:Me.max_weight)??0,"? All rates in this range will be deleted."]})]}),e.jsxs(Dt,{children:[e.jsx(Tt,{children:"Cancel"}),e.jsx(It,{onClick:vi,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove"})]})]})}),e.jsx(el,{open:Rn,onOpenChange:d=>{Vt(d),d||(!Gt.current&&ge&&!I.some(h=>h.id===ge.id)&&S(h=>h.map(f=>({...f,zones:(f.zones||[]).filter(x=>x.id!==ge.id),zone_ids:(f.zone_ids||[]).filter(x=>x!==ge.id)}))),Gt.current=!1,Zt(null),hs(null))},zone:ge,onSave:ai,countryOptions:xs,services:T,onToggleServiceZone:ci}),e.jsx(sl,{open:An,onOpenChange:d=>{lt(d),d||(!Bt.current&&$e&&!V.some(h=>h.id===$e.id)&&S(h=>h.map(f=>({...f,surcharge_ids:(f.surcharge_ids||[]).filter(x=>x!==$e.id)}))),Bt.current=!1,ot(null))},surcharge:$e,onSave:li,services:T,onToggleServiceSurcharge:hi}),e.jsx(nl,{open:kn,onOpenChange:Dn,serviceRate:Tn,onSave:oi,services:T,sharedZones:I,weightUnit:Ke}),e.jsx(ol,{open:In,onOpenChange:ds,name:j,carrierName:m,originCountries:E,services:T,sharedZones:I,serviceRates:ke,weightRanges:Le,surcharges:V,weightUnit:Ke})]})};export{$r as C,_t as P,pl as R,xl as a,gl as b,nt as c,fl as u};
