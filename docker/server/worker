#!/bin/bash

export SECRET_KEY=${SECRET_KEY:="0/zfUEetNIle3iNekk4npo4T1pLFAWOyBFgbAu0afB4="}
export ADMIN_EMAIL=${ADMIN_EMAIL:="admin@example.com"}
export ADMIN_PASSWORD=${ADMIN_PASSWORD:="demo"}

# Get database configuration
export DATABASE_HOST="${DATABASE_HOST:-db}"
export DATABASE_PORT="${DATABASE_PORT:-5432}"

# Wait for database to be ready
echo "Waiting for database to be ready at ${DATABASE_HOST}:${DATABASE_PORT}..."
while ! nc -z "${DATABASE_HOST}" "${DATABASE_PORT}"; do
  echo "Database is unavailable - sleeping"
  sleep 2
done

echo "Database is up - starting worker"

# Start background worker (using the correct command from karrio)
karrio run_huey -w $BACKGROUND_WORKERS
